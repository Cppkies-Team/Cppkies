(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.Cppkies=b())})(this,function(){'use strict';var p=Math.max;function a(a){return a instanceof Function?a():a}function b(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function c(c,d,e,f){var g,h=c.toString(),i=null===d;i||(d=a(d),g="string"==typeof d?new RegExp(b(d),"g"):d),e=a(e);var j=/(\)[^{]*{)/,k=/(}?)$/;switch(i||g.test(h)||console.warn("Nothing to inject."),f){case"before":h=i?h.replace(j,"$1"+e):h.replace(g,""+e+d);break;case"replace":h=i?""+e:h.replace(g,""+e);break;case"after":h=i?h.replace(k,e+"$1"):h.replace(g,""+d+e);break;default:throw new Error("where Parameter must be \"before\", \"replace\" or \"after\"");}var l=new Function("return ("+h+")")();return l.prototype=c.prototype,l}function d(){R.save.mods={},R.save.foreign=I,R.save.saveVer=0,R.save.exists=!0}function e(a){return R.save.foreign.buildings[a.name]||G}function f(a){var b=a.amount,c=a.bought,d=a.free,e=a.totalCookies,f=a.level,g=a.muted,h=a.minigameSave,i=a.name;R.save.foreign.buildings[i]={amount:b,bought:c,free:d,totalCookies:e,level:f,muted:g,minigameSave:h}}function g(a){return R.save.foreign.upgrades[a.name]||H}function h(a){R.save.foreign.upgrades[a.name]={unlocked:a.unlocked,bought:a.bought}}function i(a,c){function b(){this.constructor=a}J(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function j(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})}function k(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;k;)try{if(e=1,h&&(i=2&c[0]?h["return"]:c[0]?h["throw"]||((i=h["return"])&&i.call(h),0):h.next)&&!(i=i.call(h,c[1])).done)return i;switch((h=0,i)&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return k.label++,{value:c[1],done:!1};case 5:k.label++,h=c[1],c=[0];continue;case 7:c=k.ops.pop(),k.trys.pop();continue;default:if((i=k.trys,!(i=0<i.length&&i[i.length-1]))&&(6===c[0]||2===c[0])){k=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){k.label=c[1];break}if(6===c[0]&&k.label<i[1]){k.label=i[1],i=c;break}if(i&&k.label<i[2]){k.label=i[2],k.ops.push(c);break}i[2]&&k.ops.pop(),k.trys.pop();continue;}c=b.call(a,k)}catch(a){c=[6,a],h=0}finally{e=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,h,i,j,k={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return j={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(j[Symbol.iterator]=function(){return this}),j}function l(a){var b=[new q("tooltip",function(){a.tooltip=c(c(a.tooltip,"return","let ret = ","replace"),null,"\n//Cppkies injection\n\t\tfor(const i in Cppkies.buildingHooks[\""+a.name+"\"].tooltip) {\n\t\t\tconst tempRet = Cppkies.buildingHooks[\""+a.name+"\"].tooltip[i].call(this, ret)\n\t\t\tret = tempRet || ret\n\t\t}\n\t\treturn ret","after")})],d={};b.forEach(function(a){d[a.value]=a.defValue,a.func&&a.func()}),R.buildingHooks[a.name]=d}function m(){}function n(a,b,c,d,e){return new Promise(function(f){c[0]instanceof Array||(c=[c]),c=c;var g={};for(var h in c)for(var i in c[h]){if(c[h][i]=c[h][i].toString().toLowerCase(),!(c[h][i]in b))throw new Error("Invalid icon name");g[c[h][i]]=[parseInt(i),parseInt(h)]}var j=document.createElement("canvas").getContext("2d"),k=new Image;k.src=a,k.crossOrigin="Anonymous",k.addEventListener("load",function(){for(var a in j.canvas.width=e[0],j.canvas.height=e[1],g)j.drawImage(k,g[a][0]*d[0],g[a][1]*d[1],d[0],d[1],b[a][0],b[a][1],d[0],d[1]);j.canvas.toBlob(function(a){f(URL.createObjectURL(a))})})})}function o(){R.hooks.customGetIcon.push(function(a,b,c){return R.customTiers.forEach(function(a){a.keyName===b.toString()&&a.iconLink&&(c[2]=a.iconLink)}),c},function(a,b,c){return R.customBuildings.forEach(function(b){b.name===a&&b.iconLink&&(c[2]=b.iconLink)}),c})}var q=function(){return function(a,b){this.value=a,this.func=b,this.defValue=[]}}(),r={PATH_SEPARATOR:".",TARGET:Symbol("target"),UNSUBSCRIBE:Symbol("unsubscribe")},s=Array.isArray,t=a=>"symbol"==typeof a;const{PATH_SEPARATOR:u}=r;var v={after:(a,b)=>s(a)?a.slice(b.length):""===b?a:a.slice(b.length+1),concat:(a,b)=>s(a)?(a=a.slice(),b&&a.push(b),a):b&&void 0!==b.toString?(""!==a&&(a+=u),t(b)?a+"Symbol("+b.description+")":a+b):a,initial:a=>{if(s(a))return a.slice(0,-1);if(""===a)return a;const b=a.lastIndexOf(u);return-1===b?"":a.slice(0,b)},walk:(a,b)=>{if(s(a))a.forEach(b);else if(""!==a){let c=0,d=a.indexOf(u);if(-1===d)b(a);else for(;c<a.length;)-1===d&&(d=a.length),b(a.slice(c,d)),c=d+1,d=a.indexOf(u,c)}}};const{TARGET:w,UNSUBSCRIBE:x}=r,y=a=>null===a||"object"!=typeof a&&"function"!=typeof a,z=a=>a instanceof RegExp||a instanceof Number,A=a=>a instanceof Date,B=(c,a)=>void 0!==c&&void 0!==a&&Object.is(c.value,a.value)&&(c.writable||!1)===(a.writable||!1)&&(c.enumerable||!1)===(a.enumerable||!1)&&(c.configurable||!1)===(a.configurable||!1),C=a=>s(a)?a.slice():{...a},D=(a,b,c={})=>{const d=Symbol("ProxyTarget");let e,f,g=!1,h=!1,i=!1;const j=c.equals||Object.is;let k=new WeakMap,l=new WeakMap,m=new WeakMap;const n=(a,c,d,j)=>{if(!i){if(!g)return void b(v.concat(a,c),j,d);if(g&&f&&void 0!==d&&void 0!==j&&"length"!==c){let b=f;a!==e&&(a=v.after(a,e),v.walk(a,a=>{b[a]=C(b[a]),b=b[a]})),b[c]=d}h=!0}},o=(a,b)=>{let c=null!==k&&k.get(a);if(c&&(c=c.get(b)),c)return c;c=new Map,k.set(a,c);let d=c.get(b);return d||(d=Reflect.getOwnPropertyDescriptor(a,b),c.set(b,d)),d},p=(a,b)=>{const c=k?k.get(a):void 0;c&&c.delete(b)},q=(a,b)=>{if(i)return a;l.set(a,b);let c=m.get(a);return void 0===c&&(c=new Proxy(a,D),m.set(a,c)),c},r=a=>(i=!0,k=null,l=null,m=null,a),u=a=>i||!0===c.ignoreSymbols&&t(a)||!0===c.ignoreUnderscores&&"_"===a.charAt(0)||void 0!==c.ignoreKeys&&c.ignoreKeys.includes(a),D={get(a,b,e){if(b===d||b===w)return a;if(b===x&&null!==l&&""===l.get(a))return r(a);const f=Reflect.get(a,b,e);if(y(f)||z(f)||"constructor"===b||!0===c.isShallow||u(b))return f;const g=o(a,b);if(g&&!g.configurable){if(g.set&&!g.get)return;if(!1===g.writable)return f}return q(f,v.concat(l.get(a),b))},set(a,b,c,e){c&&void 0!==c[d]&&(c=c[d]);const f=u(b),g=f?null:Reflect.get(a,b,e),h=!(b in a)||!j(g,c);let i=!0;return h&&(i=Reflect.set(a[d]||a,b,c),!f&&i&&n(l.get(a),b,g,c)),i},defineProperty(a,b,c){let d=!0;return B(c,o(a,b))||(d=Reflect.defineProperty(a,b,c),d&&!u(b)&&!B()&&(p(a,b),n(l.get(a),b,void 0,c.value))),d},deleteProperty(a,b){if(!Reflect.has(a,b))return!0;const c=u(b),d=c?null:Reflect.get(a,b),e=Reflect.deleteProperty(a,b);return!c&&e&&(p(a,b),n(l.get(a),b,d)),e},apply(a,b,c){const i=A(b);if(i&&(b=b[d]),!g){g=!0,i&&(f=b.valueOf()),(s(b)||"[object Object]"===toString.call(b))&&(f=C(b[d])),e=v.initial(l.get(a));const k=Reflect.apply(a,b,c);return g=!1,(h||i&&!j(f,b.valueOf()))&&(n(e,"",f,b[d]||b),f=null,h=!1),k}return Reflect.apply(a,b,c)}},E=q(a,!0===c.pathAsArray?[]:"");return b=b.bind(E),E};D.target=a=>a[w]||a,D.unsubscribe=a=>a[x]||a;var E,F=function(){function a(a){var b=this;this.name=a,this.updateValues(a),this.store||(this.store={}),this.store=D(this.store,function(){b.writeValues()})}return a.prototype.updateValues=function(a){this.store=JSON.parse(localStorage.getItem(a))},a.prototype.writeValues=function(){localStorage.setItem(this.name,JSON.stringify(this.store))},a}(),G={amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""},H={bought:!1,unlocked:!1},I={buildings:{},upgrades:{}},J=function(a,c){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},J(a,c)},K=function(){return K=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a},K.apply(this,arguments)},L=function(a){function b(b,c,d,f,g,h,j,k,m,n){var o=this;0!==f[0]&&console.warn("All icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder"),0!==g[1]&&console.warn("All big icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder"),o=a.call(this,b,c,d,g[0],f[1],h,0,j,k)||this,R.customBuildings.push(o),l(o);var p=function(a){if(0>=parseInt(a))return"continue";var b=window.Game.ObjectsById[a];if(b.canvas=window.l("rowCanvas"+a),b.ctx=b.canvas.getContext("2d"),window.AddEvent(b.canvas,"mouseover",function(){b.mouseOn=!0}),window.AddEvent(b.canvas,"mouseout",function(){b.mouseOn=!1}),window.AddEvent(b.canvas,"mousemove",function(a){var c=b.canvas.getBoundingClientRect();b.mousePos[0]=a.pageX-c.left,b.mousePos[1]=a.pageY-c.top}),b.minigame&&b.minigameLoaded){var c=b.minigame.save();b.minigame.launch(),b.minigame.load(c)}};for(var q in window.Game.ObjectsById)p(q);o.buildingLink=g[2]||R.buildingLink+"",o.iconLink=f[2]||R.iconLink+"",m&&(window.Game.foolObjects[b]=m),n&&(window.Game.goldenCookieBuildingBuffs[b]=n),o.iconLink&&R.buildingHooks[o.name].tooltip.push(function(a){return o.locked?a:a.replace("background-position","background-image:url("+o.iconLink+");background-position")}),window.Game.BuildStore(),o.buildingLink&&R.hooks.postBuildStore.push(function(){window.l("productIcon"+o.id).style.backgroundImage="url("+o.buildingLink+")",window.l("productIconOff"+o.id).style.backgroundImage="url("+o.buildingLink+")"}),window.Game.BuildStore(),o.canvas=window.l("rowCanvas"+o.id),o.ctx=o.canvas.getContext("2d"),o.context=o.ctx,o.pics=[];var r=document.createElement("div");r.className="tinyProductIcon",r.id="mutedProduct"+o.id,r.style.display="none",o.buildingLink&&(r.style.backgroundImage="url("+o.buildingLink+")"),r.style.backgroundPositionX="-"+f[0]+"px",r.style.backgroundPositionY="-"+f[1]+"px",r.addEventListener("click",function(){o.mute(0),window.PlaySound(o.muted?"snd/clickOff.mp3":"snd/clickOn.mp3")}),window.AddEvent(o.canvas,"mouseover",function(){o.mouseOn=!0}),window.AddEvent(o.canvas,"mouseout",function(){o.mouseOn=!1}),window.AddEvent(o.canvas,"mousemove",function(a){var b=o.canvas.getBoundingClientRect();o.mousePos[0]=a.pageX-b.left,o.mousePos[1]=a.pageY-b.top}),window.l("buildingsMute").appendChild(r);var s=e(o);for(var q in s)o[q]=s[q];return window.Game.recalculateGains=1,o}return i(b,a),b}(window.Game.Object),M=function(a){function b(b,c,d,e,f){void 0===f&&(f=function(){});var h=this;e[2]||(e[2]=R.iconLink+""),h=a.call(this,b,"function"==typeof c?"":c,"function"==typeof d?0:d,"function"==typeof e?[0,0]:e,f)||this,"function"==typeof c&&(h.descFunc=c),"function"==typeof d&&(h.priceFunc=d),"function"==typeof e&&(h.iconFunction=e),R.customUpgrades.push(h);var j=g(h);for(var k in j)h[k]=j[k];return h}return i(b,a),b}(window.Game.Upgrade),N=function(a){function b(b,c,d,e,f,g,h){void 0===g&&(g=["Legacy"]),void 0===h&&(h=function(){});var j=a.call(this,b,c,d,e,h)||this;for(var k in j.parents=g,j.pool="prestige",j.posX=f[0],j.posY=f[1],j.parents){var i=j.parents[k];j.parents[k]=window.Game.Upgrades[i]||window.Game.UpgradesById[i]}return window.Game.PrestigeUpgrades.push(j),window.Game.UpgradePositions[j.id]=f,j}return i(b,a),b}(M),O=function(a){function b(b,c,d,e){var f=Math.min,g=a.call(this,b,c,window.Game.Objects[d].basePrice*window.Game.Tiers[e].price,window.Game.GetIcon(d,e))||this;return window.Game.SetTier(d,e),g.buildingTie1=window.Game.Objects[d],"fortune"===e&&(window.Game.Objects[d].fortune=g),"number"==typeof e&&(g.order=100*(window.Game.Objects[d].id+1)+e),g.order-=75*p(0,f(window.Game.Objects[d].id-4,3)),g}return i(b,a),b}(M),P=function(){return function(a,b,c,d,e,f,g,h,i){void 0===d&&(d=!1),void 0===e&&(e="auto"),void 0===f&&(f=null),void 0===g&&(g=null),void 0===h&&(h=null),void 0===i&&(i="auto"),this.name=a,this.color=c,this.price=e,this.unlock=f,this.keyName=i,this.upgrades=[],this.special=d,null===f&&(this.unlock=-1),"number"==typeof g&&(this.achievUnlock=g),h&&(this.req=h),"auto"===e&&(this.price=1e8*window.Game.Tiers[Object.keys(window.Game.Tiers).filter(function(a){return!isNaN(parseInt(a))}).length.toString()].price),this.iconRow=b[1],b[2]&&(this.iconLink=b[2]),"auto"===i&&(d?this.keyName=a:this.keyName=(Object.keys(window.Game.Tiers).filter(function(a){return!isNaN(parseInt(a))}).length+1).toString()),(!1===d&&null===f||"auto"===f)&&(this.unlock=window.Game.Tiers[parseInt(this.keyName)-1].unlock+50),(!1===d&&null===g||"auto"===g)&&(this.achievUnlock=window.Game.Tiers[parseInt(this.keyName)-1].achievUnlock+50),window.Game.Tiers[this.keyName]=this,R.customTiers.push(this)}}(),Q={"3d":[0,21],milestone1:[0,22],milestone2:[0,23],milestone3:[0,24],krumblor:[0,25],level1:[0,26],level2:[0,27]},R={hooks:null,iconLink:"",buildingLink:"",buildingHooks:{},buildingHooksById:[],customBuildings:[],customUpgrades:[],customTiers:[],save:function(){var a=new F("cppkiesSave").store;return a.exists||d(),a}(),onLoad:[],Building:L,Upgrade:M,TieredUpgrade:O,Tier:P,HeavenlyUpgrade:N,injectCode:c,DEFAULT_ONBUY:function(){window.Game.UnlockTiered(this),this.amount>=window.Game.SpecialGrandmaUnlock&&0<window.Game.Objects.Grandma.amount&&this.grandma&&window.Game.Unlock(this.grandma.name)},DEFAULT_CPS:function(a){return window.Game.GetTieredCpsMult(a)*window.Game.magicCpS(a.name)*a.baseCps},icons:{relinkColumn:function(a,b){return j(this,void 0,void 0,function(){var c,d,e,f;return k(this,function(g){switch(g.label){case 0:for(d in c=K({},Q),window.Game.Tiers)c[window.Game.Tiers[d].name.toLowerCase()]=c[d]=[0,window.Game.Tiers[d].iconRow];return e=m,f=[a],[4,n(a,c,b,[48,48],[48,Object.values(c).reduce(function(a,b){return p(a,b[1])},-Infinity)+1])];case 1:return e.apply(void 0,f.concat([g.sent()])),[2];}})})},relinkRow:null}};window.Cppkies?E=window.Cppkies:(E=R,window.Game.customSave.push(function(){for(var a in R.customBuildings)f(R.customBuildings[a]);for(var a in R.customUpgrades)h(R.customUpgrades[a])}),function(){return new Promise(function(a){var b={},d=[new q("customMenu",function(){window.Game.UpdateMenu=c(window.Game.UpdateMenu,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tswitch (Game.onMenu) {\n\t\t\t\t\t\tcase \"prefs\":\n\t\t\t\t\t\t\tfor(const i in Cppkies.hooks.customOptionsMenu) Cppkies.hooks.customOptionsMenu[i]()\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"stats\":\n\t\t\t\t\t\t\tfor(const i in Cppkies.hooks.customStatsMenu) Cppkies.hooks.customStatsMenu[i]()\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\t\tfor(const i in Cppkies.hooks.customInfoMenu) Cppkies.hooks.customInfoMenu[i]()\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tfor(const i in Cppkies.hooks.customMenu) Cppkies.hooks.customMenu[i]()\n\t\t\t\t\t","before")}),new q("customOptionsMenu"),new q("customStatsMenu"),new q("customInfoMenu"),new q("customLoad",function(){window.Game.LoadSave=c(window.Game.LoadSave,"if (Game.prefs.showBackupWarning==1)","\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tfor(const i in Cppkies.hooks.customLoad) Cppkies.hooks.customLoad[i]()\n\t\t\t\t\t","before")}),new q("customReset",function(){window.Game.Reset=c(window.Game.Reset,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tfor(const i in Cppkies.hooks.customReset) Cppkies.hooks.customReset[i](hard)\n\t\t\t\t\t","before")}),new q("customGetIcon",function(){window.Game.GetIcon=c(window.Game.GetIcon,"return [col,Game.Tiers[tier].iconRow];","\n\t\t\t\t\t// Cppkies Injection\n\t\t\t\t\tlet icon = [col, Game.Tiers[tier].iconRow]\n\t\t\t\t\tfor(const i in Cppkies.hooks.customGetIcon) icon = Cppkies.hooks.customGetIcon[i](type, tier, icon) || icon\n\t\t\t\t\treturn icon\n","replace")}),new q("postBuildStore",function(){window.Game.BuildStore=c(window.Game.BuildStore,null,";\nfor(const i in Cppkies.hooks.postBuildStore) Cppkies.hooks.postBuildStore[i]()","after")}),new q("customGrandmaPic",function(){window.Game.Objects.Grandma.art.pic=c(window.Game.Objects.Grandma.art.pic,"return choose(list)+'.png'","// Cppkies injection\n\t\t\t\t\tlist = list.concat(Cppkies.hooks.customGrandmaPic.map(val=> val()).filter(val => val))\n\t\t\t\t\t","before")})];d.forEach(function(a){var c,d;b[a.value]=a.defValue,null===(d=(c=a).func)||void 0===d?void 0:d.call(c)}),window.Game.Loader.Load=c(window.Game.Loader.Load,"img.src=this.domain","\n\t\t\t// Cppkies injection\n\t\t\timg.src = (assets[i].indexOf('http') !== -1 ? \"\" : this.domain)\n","replace"),window.Game.Objects.Cursor.buyFunction=c(window.Game.Objects.Cursor.buyFunction,"Game.Unlock('Octillion fingers');","\n \t\t\t// Cppkies injection\n\t\t\tdebugger\n\t\t\tfor(const i in this.tieredUpgrades) {\n\t\t\t\tif (isNaN(parseInt(i))) break\n\t\t\t\tif (this.amount >= window.Game.Tiers[this.tieredUpgrades[i].tier].unlock - 50) this.tieredUpgrades[i].unlock()\n\t\t\t}\n","after"),a(b)})}().then(function(a){E.hooks=a,window.Game.Notify("Cppkies loaded!","",[32,17]),window.Game.Win("Third-party"),R.onLoad.forEach(function(a){return a()}),R.onLoad=new Proxy(R.onLoad,{set:function(a,b,c){return"length"!==b&&c(),!0}}),o(),window.Cppkies=E}));var S=E;return S});
//# sourceMappingURL=index.js.map
