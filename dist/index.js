(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.Cppkies=b())})(this,function(){'use strict';function a(a){return a instanceof Function?a():a}function b(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function c(c,d,e,f){var g,h=c.toString(),i=null===d;i||(d=a(d),g="string"==typeof d?new RegExp(b(d),"g"):d),e=a(e);var j=/(\)[^{]*{)/,k=/(}?)$/;switch(i||g.test(h)||console.warn("Nothing to inject."),f){case"before":h=i?h.replace(j,"$1"+e):h.replace(g,""+e+d);break;case"replace":h=i?""+e:h.replace(g,""+e);break;case"after":h=i?h.replace(k,e+"$1"):h.replace(g,""+d+e);break;default:throw new Error("where Parameter must be \"before\", \"replace\" or \"after\"");}var m=new Function("return ("+h+")")();return m.prototype=c.prototype,m}function d(a,c){function b(){this.constructor=a}i(a,c),a.prototype=null===c?Object.create(c):(b.prototype=c.prototype,new b)}function e(a){return j.save.foreign.buildings[a.name]||k}function f(a){return j.save.foreign.upgrades[a.name]||m}function g(a){var b=[new h("tooltip",function(){a.tooltip=c(c(a.tooltip,"return","let ret = ","replace"),null,"\n//Cppkies injection\n\t\tfor(const i in Cppkies.buildingHooks[\""+a.name+"\"].tooltip) {\n\t\t\tconst tempRet = Cppkies.buildingHooks[\""+a.name+"\"].tooltip[i].call(this, ret)\n\t\t\tret = tempRet || ret\n\t\t}\n\t\treturn ret","after")})],d={};b.forEach(function(a){d[a.value]=a.defValue,a.func&&a.func()}),j.buildingHooks[a.name]=d}var h=function(){return function(a,b){this.value=a,this.func=b,this.defValue=[]}}(),i=function(a,c){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b])},i(a,c)},j={hooks:{},iconLink:"",buildingLink:"",buildingHooks:{},buildingHooksById:[],customBuildings:[],customUpgrades:[],save:null,onLoad:[],Building:null,Upgrade:null,HeavenlyUpgrade:null,injectCode:null,DEFAULT_ONBUY:null,DEFAULT_CPS:null},k={amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""},m={bought:!1,unlocked:!1},n={buildings:{},upgrades:{}},o=function(a){function b(b,c,d,f,h,k,m,n,o,p){var q=a.call(this,b,c,d,h[1],f[0],k,0,m,n)||this;j.customBuildings.push(q),g(q);var r=function(a){if(0<parseInt(a)){var b=Game.ObjectsById[a];if(b.canvas=l("rowCanvas"+a),b.ctx=b.canvas.getContext("2d"),AddEvent(b.canvas,"mouseover",function(){b.mouseOn=!0}),AddEvent(b.canvas,"mouseout",function(){b.mouseOn=!1}),AddEvent(b.canvas,"mousemove",function(a){var c=b.canvas.getBoundingClientRect();b.mousePos[0]=a.pageX-c.left,b.mousePos[1]=a.pageY-c.top}),b.minigame&&b.minigameLoaded){var c=b.minigame.save();b.minigame.launch(),b.minigame.load(c)}}};for(var s in Game.ObjectsById)r(s);var t=h[2]||j.buildingLink+"",u=f[2]||j.iconLink+"";o&&(Game.foolObjects[b]=o),p&&(Game.goldenCookieBuildingBuffs[b]=p),u&&j.buildingHooks[q.name].tooltip.push(function(a){return q.locked?a:a.replace("background-position","background-image:url("+u+");background-position")}),Game.BuildStore(),t&&j.hooks.postBuildStore.push(function(){l("productIcon"+q.id).style.backgroundImage="url("+t+")",l("productIconOff"+q.id).style.backgroundImage="url("+t+")"}),Game.BuildStore(),q.canvas=l("rowCanvas"+q.id),q.ctx=q.canvas.getContext("2d"),q.context=q.ctx,q.pics=[];var v=document.createElement("div");v.className="tinyProductIcon",v.id="mutedProduct"+q.id,v.style.display="none",t&&(v.style.backgroundImage="url("+t+")"),v.style.backgroundPositionX="-"+f[0]+"px",v.style.backgroundPositionY="-"+f[1]+"px",v.addEventListener("click",function(){q.mute(0),PlaySound(q.muted?"snd/clickOff.mp3":"snd/clickOn.mp3")}),AddEvent(q.canvas,"mouseover",function(){q.mouseOn=!0}),AddEvent(q.canvas,"mouseout",function(){q.mouseOn=!1}),AddEvent(q.canvas,"mousemove",function(a){var b=q.canvas.getBoundingClientRect();q.mousePos[0]=a.pageX-b.left,q.mousePos[1]=a.pageY-b.top}),l("buildingsMute").appendChild(v);var w=e(q);for(var s in w)q[s]=w[s];return Game.recalculateGains=1,q}return d(b,a),b}(Game.Object),p=function(a){function b(b,c,d,e,g){void 0===g&&(g=function(){});var h=this;e[2]||(e[2]=j.iconLink+""),h=a.call(this,b,"function"==typeof c?"":c,"function"==typeof d?0:d,"function"==typeof e?[0,0]:e,g)||this,"function"==typeof c&&(h.descFunc=c),"function"==typeof d&&(h.priceFunc=d),"function"==typeof e&&(h.iconFunction=e),j.customUpgrades.push(h);var k=f(h);for(var m in k)h[m]=k[m];return h}return d(b,a),b}(Game.Upgrade),q={PATH_SEPARATOR:".",TARGET:Symbol("target"),UNSUBSCRIBE:Symbol("unsubscribe")},r=Array.isArray,s=a=>"symbol"==typeof a;const{PATH_SEPARATOR:t}=q;var u={after:(a,b)=>r(a)?a.slice(b.length):""===b?a:a.slice(b.length+1),concat:(a,b)=>r(a)?(a=a.slice(),b&&a.push(b),a):b&&void 0!==b.toString?(""!==a&&(a+=t),s(b)?a+"Symbol("+b.description+")":a+b):a,initial:a=>{if(r(a))return a.slice(0,-1);if(""===a)return a;const b=a.lastIndexOf(t);return-1===b?"":a.slice(0,b)},walk:(a,b)=>{if(r(a))a.forEach(b);else if(""!==a){let c=0,d=a.indexOf(t);if(-1===d)b(a);else for(;c<a.length;)-1===d&&(d=a.length),b(a.slice(c,d)),c=d+1,d=a.indexOf(t,c)}}};const{TARGET:v,UNSUBSCRIBE:w}=q,x=a=>null===a||"object"!=typeof a&&"function"!=typeof a,y=a=>a instanceof RegExp||a instanceof Number,z=a=>a instanceof Date,A=(c,a)=>void 0!==c&&void 0!==a&&Object.is(c.value,a.value)&&(c.writable||!1)===(a.writable||!1)&&(c.enumerable||!1)===(a.enumerable||!1)&&(c.configurable||!1)===(a.configurable||!1),B=a=>r(a)?a.slice():{...a},C=(a,b,c={})=>{const d=Symbol("ProxyTarget");let e,f,g=!1,h=!1,i=!1;const j=c.equals||Object.is;let k=new WeakMap,m=new WeakMap,n=new WeakMap;const o=(a,c,d,j)=>{if(!i){if(!g)return void b(u.concat(a,c),j,d);if(g&&f&&void 0!==d&&void 0!==j&&"length"!==c){let b=f;a!==e&&(a=u.after(a,e),u.walk(a,a=>{b[a]=B(b[a]),b=b[a]})),b[c]=d}h=!0}},p=(a,b)=>{let c=null!==k&&k.get(a);if(c&&(c=c.get(b)),c)return c;c=new Map,k.set(a,c);let d=c.get(b);return d||(d=Reflect.getOwnPropertyDescriptor(a,b),c.set(b,d)),d},q=(a,b)=>{const c=k?k.get(a):void 0;c&&c.delete(b)},t=(a,b)=>{if(i)return a;m.set(a,b);let c=n.get(a);return void 0===c&&(c=new Proxy(a,E),n.set(a,c)),c},C=a=>(i=!0,k=null,m=null,n=null,a),D=a=>i||!0===c.ignoreSymbols&&s(a)||!0===c.ignoreUnderscores&&"_"===a.charAt(0)||void 0!==c.ignoreKeys&&c.ignoreKeys.includes(a),E={get(a,b,e){if(b===d||b===v)return a;if(b===w&&null!==m&&""===m.get(a))return C(a);const f=Reflect.get(a,b,e);if(x(f)||y(f)||"constructor"===b||!0===c.isShallow||D(b))return f;const g=p(a,b);if(g&&!g.configurable){if(g.set&&!g.get)return;if(!1===g.writable)return f}return t(f,u.concat(m.get(a),b))},set(a,b,c,e){c&&void 0!==c[d]&&(c=c[d]);const f=D(b),g=f?null:Reflect.get(a,b,e),h=!(b in a)||!j(g,c);let i=!0;return h&&(i=Reflect.set(a[d]||a,b,c),!f&&i&&o(m.get(a),b,g,c)),i},defineProperty(a,b,c){let d=!0;return A(c,p(a,b))||(d=Reflect.defineProperty(a,b,c),d&&!D(b)&&!A()&&(q(a,b),o(m.get(a),b,void 0,c.value))),d},deleteProperty(a,b){if(!Reflect.has(a,b))return!0;const c=D(b),d=c?null:Reflect.get(a,b),e=Reflect.deleteProperty(a,b);return!c&&e&&(q(a,b),o(m.get(a),b,d)),e},apply(a,b,c){const i=z(b);if(i&&(b=b[d]),!g){g=!0,i&&(f=b.valueOf()),(r(b)||"[object Object]"===toString.call(b))&&(f=B(b[d])),e=u.initial(m.get(a));const k=Reflect.apply(a,b,c);return g=!1,(h||i&&!j(f,b.valueOf()))&&(o(e,"",f,b[d]||b),f=null,h=!1),k}return Reflect.apply(a,b,c)}},F=t(a,!0===c.pathAsArray?[]:"");return b=b.bind(F),F};C.target=a=>a[v]||a,C.unsubscribe=a=>a[w]||a;var D,E=function(){function a(a){var b=this;this.name=a,this.updateValues(a),this.store||(this.store={}),this.store=C(this.store,function(){b.writeValues()})}return a.prototype.updateValues=function(a){this.store=JSON.parse(localStorage.getItem(a))},a.prototype.writeValues=function(){localStorage.setItem(this.name,JSON.stringify(this.store))},a}(),F=function(a){function b(b,c,d,e,f,g,h){void 0===g&&(g=["Legacy"]),void 0===h&&(h=function(){});var j=a.call(this,b,c,d,e,h)||this;for(var k in j.parents=g,j.pool="prestige",j.posX=f[0],j.posY=f[1],j.parents){var i=j.parents[k];j.parents[k]=Game.Upgrades[i]||Game.UpgradesById[i]}return Game.PrestigeUpgrades.push(j),Game.UpgradePositions[j.id]=f,j}return d(b,a),b}(p);window.Cppkies?D=window.Cppkies:(D=j,D.Building=o,D.Upgrade=p,D.HeavenlyUpgrade=F,D.injectCode=c,D.DEFAULT_CPS=function(a){return Game.GetTieredCpsMult(a)*Game.magicCpS(a.name)*a.baseCps},D.DEFAULT_ONBUY=function(){Game.UnlockTiered(this),this.amount>=Game.SpecialGrandmaUnlock&&0<Game.Objects.Grandma.amount&&this.grandma&&Game.Unlock(this.grandma.name)},j.save=new E("cppkiesSave").store,!j.save.exists&&function(){j.save.mods={},j.save.foreign=n,j.save.saveVer=0,j.save.exists=!0}(),function(){return new Promise(function(a){var b={},d=[new h("customMenu",function(){window.Game.UpdateMenu=c(window.Game.UpdateMenu,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tswitch (Game.onMenu) {\n\t\t\t\t\t\tcase \"prefs\":\n\t\t\t\t\t\t\tfor(const i in Cppkies.hooks.customOptionsMenu) Cppkies.hooks.customOptionsMenu[i]();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"stats\":\n\t\t\t\t\t\t\tfor(const i in Cppkies.hooks.customStatsMenu) Cppkies.hooks.customStatsMenu[i]();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\t\tfor(const i in Cppkies.hooks.customInfoMenu) Cppkies.hooks.customInfoMenu[i]();\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tfor(const i in Cppkies.hooks.customMenu) Cppkies.hooks.customMenu[i]();\n\t\t\t\t\t","before")}),new h("customOptionsMenu"),new h("customStatsMenu"),new h("customInfoMenu"),new h("customLoad",function(){window.Game.LoadSave=c(window.Game.LoadSave,"if (Game.prefs.showBackupWarning==1)","\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tfor(const i in Cppkies.hooks.customLoad) Cppkies.hooks.customLoad[i](); \n\t\t\t\t\t","before")}),new h("customReset",function(){window.Game.Reset=c(window.Game.Reset,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tfor(const i in Cppkies.hooks.customReset) Cppkies.hooks.customReset[i](hard);\n\t\t\t\t\t","before")}),new h("postBuildStore",function(){window.Game.BuildStore=c(window.Game.BuildStore,null,";\nfor(const i in Cppkies.hooks.postBuildStore) Cppkies.hooks.postBuildStore[i]()","after")}),new h("customGrandmaPic",function(){window.Game.Objects.Grandma.art.pic=c(window.Game.Objects.Grandma.art.pic,"return choose(list)+'.png'","// Cppkies injection\n\t\t\t\t\tlist = list.concat(Cppkies.hooks.customGrandmaPic.map(val=>val() || null).filter(val=>val !== null))\n\t\t\t\t\t","before")})];d.forEach(function(a){b[a.value]=a.defValue,a.func&&a.func()}),window.Game.Loader.Load=c(window.Game.Loader.Load,"img.src=this.domain","img.src=(assets[i].indexOf('http') !== -1 ? \"\" : this.domain)","replace"),a(b)})}().then(function(a){D.hooks=a,window.Game.Notify("Cppkies loaded!","",[32,17]),window.Game.Win("Third-party"),j.onLoad.forEach(function(a){return a()}),j.onLoad=new Proxy(j.onLoad,{set:function(a,b,c){return"length"!==b&&c(),!0}}),window.Cppkies=D}));var G=D;return G});
//# sourceMappingURL=index.js.map
