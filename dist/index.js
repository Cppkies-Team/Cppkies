(function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e=e||self,e.Cppkies=i())})(this,function(){'use strict';var B=Math.abs,M=Math.floor,E=Math.min,x=Math.pow,F=Math.max;function e(e,i){function n(){this.constructor=e}R(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function i(e,i,n,o){return new(n||(n=Promise))(function(t,s){function r(e){try{c(o.next(e))}catch(i){s(i)}}function a(e){try{c(o["throw"](e))}catch(i){s(i)}}function c(e){e.done?t(e.value):new n(function(i){i(e.value)}).then(r,a)}c((o=o.apply(e,i||[])).next())})}function n(e,i){function n(e){return function(i){return o([e,i])}}function o(n){if(s)throw new TypeError("Generator is already executing.");for(;d;)try{if(s=1,r&&(a=2&n[0]?r["return"]:n[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch((r=0,a)&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return d.label++,{value:n[1],done:!1};case 5:d.label++,r=n[1],n=[0];continue;case 7:n=d.ops.pop(),d.trys.pop();continue;default:if((a=d.trys,!(a=0<a.length&&a[a.length-1]))&&(6===n[0]||2===n[0])){d=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){d.label=n[1];break}if(6===n[0]&&d.label<a[1]){d.label=a[1],a=n;break}if(a&&d.label<a[2]){d.label=a[2],d.ops.push(n);break}a[2]&&d.ops.pop(),d.trys.pop();continue;}n=i.call(e,d)}catch(i){n=[6,i],r=0}finally{s=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var s,r,a,c,d={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c}function o(){for(var e=0,n=0,o=arguments.length;n<o;n++)e+=arguments[n].length;for(var t=Array(e),r=0,n=0;n<o;n++)for(var c=arguments[n],a=0,d=c.length;a<d;a++,r++)t[r]=c[a];return t}function t(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function s(e,i,n,s,r){void 0===r&&(r={});var a=e.toString(),c=null===i,d=/(?:)/;null!==i&&(d="string"==typeof i?new RegExp(t(i),"g"):i,!d.test(a)&&console.warn("Nothing to inject."));var u=/(\)[^{]*{)/,p=/(}?)$/;switch(s){case"before":a=c?a.replace(u,"$1"+n):a.replace(d,""+n+i);break;case"replace":a=c?""+n:a.replace(d,""+n);break;case"after":a=c?a.replace(p,n+"$1"):a.replace(d,""+i+n);break;default:throw new Error("where Parameter must be \"before\", \"replace\" or \"after\"");}var m=Function.apply(void 0,o(Object.keys(r),["return ("+a+")"])).apply(void 0,Object.values(r));return m.prototype=e.prototype,m}function r(e,n){for(var o in n)e[o]=n[o]}function a(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function c(e,i){return e.hasOwnProperty(i)}function d(){we.save=X={mods:{},foreign:W,saveVer:1}}function u(e){return X.foreign.buildings[e.name]||K}function p(e){var i=e.amount,n=e.bought,o=e.free,t=e.totalCookies,s=e.level,r=e.muted,a=e.minigameSave,c=e.name;X.foreign.buildings[c]={amount:i,bought:n,free:o,totalCookies:t,level:s,muted:r,minigameSave:a}}function m(e){return X.foreign.upgrades[e.name]||D}function g(e){X.foreign.upgrades[e.name]={unlocked:!!e.unlocked,bought:!!e.bought}}function k(e){return X.foreign.achievements[e.name]||Y}function b(e){X.foreign.achievements[e.name]={won:!!e.won}}function h(e){switch(d(),e.saveVer){case 0:X.foreign.buildings=e.foreign.buildings;break;default:throw new Error("Invalid save version "+X.saveVer+" (current version is "+1+")");}}function f(){for(var e,i=0,n=we.customBuildings;i<n.length;i++)e=n[i],r(e,u(e));for(var o,t=0,s=we.customUpgrades;t<s.length;t++)o=s[t],r(o,m(o));for(var a,c=0,d=we.customAchievements;c<d.length;c++)a=d[c],r(a,k(a))}function v(){for(var e,i=0,n=we.customBuildings;i<n.length;i++)e=n[i],p(e);for(var o,t=0,s=we.customUpgrades;t<s.length;t++)o=s[t],g(o);for(var r,a=0,c=we.customAchievements;a<c.length;a++)r=c[a],b(r)}function C(e){return!("object"!=typeof e)&&null!==e&&!!(c(e,"saveVer")&&"number"==typeof e.saveVer)&&!(1<e.saveVer)&&!!(0!==e.saveVer||c(e,"exists"))&&!!c(e,"mods")&&!("{}"!==JSON.stringify(e.mods))&&!!c(e,"foreign")&&!!function(n){if("object"!=typeof n)return!1;if(null===n)return!1;if(!c(n,"buildings"))return!1;if("object"!=typeof n.buildings)return!1;for(var o in n.buildings){var t=n.buildings[o];if("object"!=typeof t)return!1;for(var s in K)if(typeof K[s]!=typeof t[s])return!1}if(1<=e.saveVer){if(!c(n,"upgrades"))return!1;if("object"!=typeof n.upgrades)return!1;for(var o in n.upgrades){var r=n.upgrades[o];if("object"!=typeof r)return!1;for(var s in D)if(typeof D[s]!=typeof r[s])return!1}if(!c(n,"achievements"))return!1;if("object"!=typeof n.achievements)return!1;for(var o in n.achievements){var a=n.achievements[o];if("object"!=typeof a)return!1;for(var s in Y)if(typeof Y[s]!=typeof a[s])return!1}}return!0}(e.foreign)}function y(e){var i;try{i=JSON.parse(e)}catch(n){""!==e&&console.warn("CPPKIES: Found invalid save, creating new one..."),d(),i=X}C(i)?i.saveVer===1?we.save=X=i:(console.warn("CPPKIES: Found old save, migrating to a new one..."),h(i)):(console.warn("CPPKIES: Found invalid save, creating new one..."),d()),f()}function j(){return v(),JSON.stringify(X)}function O(e,i){$[e]=i}function P(e){if(z.includes(e))throw new Error("Recursive alias");return(z.push(e),e in $)?P($[e]):(z=[],e)}function w(e){return new Promise(function(i){var n=new Image;n.addEventListener("load",function(){i(n)}),n.crossOrigin="Anonymous",n.src=e})}function L(e){return new Promise(function(i){e.canvas.toBlob(function(e){i(URL.createObjectURL(e))})})}function S(e,n,o,t,s,r){return new Promise(function(i){o[0]instanceof Array||(o=[o]),o=o;var a={};for(var c in o)for(var d in o[c])if(o[c][d]){if(o[c][d]=o[c][d].toString().toLowerCase(),!(o[c][d]in n))throw new Error("Invalid icon name");a[o[c][d]]=[parseInt(d),parseInt(c)]}var u=document.createElement("canvas").getContext("2d"),p=new Image;p.addEventListener("load",function(){for(var e in u.canvas.width=s[0],u.canvas.height=s[1],a)u.drawImage(p,a[e][0]*t[0],a[e][1]*t[1],t[0],t[1],n[e][0]*t[0],n[e][1]*t[1],t[0],t[1]);var o,c=function(){L(u).then(i)};r&&(o=r(u)),o instanceof Promise?o.then(c):c()}),p.crossOrigin="Anonymous",p.src=e})}function T(e){return e=o(e),(void 0===e[2]||null===e[2])&&(e[2]=we.iconLink),e[2]=P(e[2]),e}function I(e){var i=new H,n=[new V("tooltip",function(){e.tooltip=s(s(e.tooltip,"return","let tempRet = ","replace"),null,"\n//Cppkies injection\n\t\t\t\treturn Cppkies.buildingHooks[this.name].emit(\"tooltip\", tempRet)","after")}),new V("buy",function(){e.buy=s(e.buy,null,"\n//Cppkies injection\n\t\t\t\tif(success) {\n\t\t\t\t\tCppkies.buildingHooks[this.name].emit(\"buy\")\n\t\t\t\t}","after")}),new V("levelUp",function(){e.levelUp=s(e.levelUp,"me.level+=1;","\n// Cppkies injection\nCppkies.buildingHooks[me.name].emit(\"levelUp\")","after",{me:e})})];n.forEach(function(e){var i;null===(i=e.func)||void 0===i?void 0:i.call(e)}),we.hooks.on("buildingCps",function(n){return{building:n.building,cps:Game.Objects[n.building]===e?i.emit("cps",n.cps):n.cps}}),ie[e.name]=i}function U(){for(var e,i=0,n=Game.ObjectsById;i<n.length;i++)e=n[i],ie[e.name]||I(e)}function G(e){return"fortune"===e.tier}function _(e){for(var n,o=1,t=1;t<=e;t++)o+=null!==(n=pe[t])&&void 0!==n?n:pe["default"];return 9*x(10,o)}function A(){we.hooks.on("getIcon",function(e){var i=e.icon,n=e.type,o=e.tier;return we.customTiers.forEach(function(e){e.keyName===o.toString()&&e.iconLink&&(i[2]=e.iconLink)}),{icon:i,type:n,tier:o}}),we.hooks.on("getIcon",function(e){var i=e.icon,n=e.type,o=e.tier;return we.customBuildings.forEach(function(e){e.name===n&&e.iconLink&&(i[2]=e.iconLink)}),{icon:i,tier:o,type:n}}),we.hooks.on("getIcon",function(e){var i=e.icon,n=e.type,o=e.tier;return void 0!==i[2]&&null!==i[2]||c(Game.Tiers[o.toString()],"iconLink")||(i[2]=""),{icon:i,tier:o,type:n}})}var N,R=function(e,i){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},R(e,i)},H=function(){function e(){this._events={}}return e.prototype.on=function(e,i){this._events[e]?this._events[e].push(i):this._events[e]=[i]},e.prototype.once=function(e,i){var n=this;this.on(e,function(o){return n.off(e,i),i(o)})},e.prototype.off=function(e,i){this._events[e].splice(this._events[e].indexOf(i),1)},e.prototype.emit=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=i[0];this._events[e]||(this._events[e]=[]);for(var t,s=0,r=this._events[e];s<r.length;s++)t=r[s],o=t(o);return o},e.prototype.constEmit=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this._events[e]||(this._events[e]=[]);for(var o,t=0,s=this._events[e];t<s.length;t++)o=s[t],o(i[0])},e}(),V=function(){return function(e,i){this.value=e,this.func=i}}(),K={amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""},D={bought:!1,unlocked:!1},Y={won:!1},W={buildings:{},upgrades:{},achievements:{}},X={mods:{},foreign:W,saveVer:1},$={},z=[],J={},Q={"3d":[0,21],milestone1:[0,22],milestone2:[0,23],milestone3:[0,24],krumblor:[0,25],level1:[0,26],level2:[0,27]},Z={},ee={research:[9,0],cookie:[10,0],mouse:[11,0],multicursor:[12,0],kitten:[18,0]},ie={},ne=[],oe=function(n){function o(e,o,t,s,r,a,c,d,p,m){var g,k,b=this;0!==s[1]&&console.warn("All icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=relink-column"),0!==r[0]&&console.warn("All big icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=big-icons"),b=n.call(this,e,o,t,r[1],s[0],a,0,c,d)||this,ne.push(b),ie[e]||I(b);var h=function(e){if(0>=parseInt(e))return"continue";var i=Game.ObjectsById[e];if(i.canvas=l("rowCanvas"+e),!i.canvas)return"continue";if(i.ctx=i.canvas.getContext("2d"),i.canvas.addEventListener("mouseover",function(){i.mouseOn=!0}),i.canvas.addEventListener("mouseout",function(){i.mouseOn=!1}),i.canvas.addEventListener("mousemove",function(n){var e=i.canvas.getBoundingClientRect();i.mousePos[0]=n.pageX-e.left,i.mousePos[1]=n.pageY-e.top}),i.minigame&&i.minigameLoaded){var n=i.minigame.save();i.minigame.launch(),i.minigame.load(n)}};for(var f in Game.ObjectsById)h(f);b.buildingLink=null!==(g=r[2])&&void 0!==g?g:we.buildingLink,b.iconLink=P(null!==(k=s[2])&&void 0!==k?k:we.iconLink),p&&(Game.foolObjects[e]=p),m&&(Game.goldenCookieBuildingBuffs[e]=m),b.iconLink&&ie[b.name].on("tooltip",function(e){return b.locked?e:e.replace("background-position","background-image:url("+b.iconLink+");background-position")}),Game.BuildStore(),b.buildingLink&&we.hooks.on("buildStore",function(){l("productIcon"+b.id).style.backgroundImage="url("+b.buildingLink+")",l("productIconOff"+b.id).style.backgroundImage="url("+b.buildingLink+")"}),Game.BuildStore(),b.canvas=l("rowCanvas"+b.id),b.ctx=b.canvas.getContext("2d"),b.pics=[];var v=document.createElement("div");v.className="tinyProductIcon",v.id="mutedProduct"+b.id,v.style.display="none",b.buildingLink&&(v.style.backgroundImage="url("+b.buildingLink+")"),v.style.backgroundPositionX="-"+s[0]+"px",v.style.backgroundPositionY="-"+s[1]+"px",v.addEventListener("click",function(){b.mute(0),window.PlaySound(b.muted?"snd/clickOff.mp3":"snd/clickOn.mp3")}),window.AddEvent(b.canvas,"mouseover",function(){b.mouseOn=!0}),window.AddEvent(b.canvas,"mouseout",function(){b.mouseOn=!1}),b.canvas.addEventListener("mousemove",function(i){var e=b.canvas.getBoundingClientRect();b.mousePos[0]=i.pageX-e.left,b.mousePos[1]=i.pageY-e.top}),l("buildingsMute").appendChild(v);var C=u(b);for(var f in C)b[f]=C[f];return Game.recalculateGains=1,b}return e(o,n),o}(Game.Object),te=[],se=function(n){function o(e,o,t,s,r){void 0===r&&(r=function(){});var a=n.call(this,e,"function"==typeof o?"":o,"function"==typeof t?0:t,"function"==typeof s?[0,0]:T(s),r)||this;"function"==typeof o&&(a.descFunc=o),"function"==typeof t&&(a.priceFunc=t),"function"==typeof s&&(a.iconFunction=function(){return T(s())}),te.push(a);var c=m(a);for(var d in c)a[d]=c[d];return Game.upgradesToRebuild=1,a}return e(o,n),o}(Game.Upgrade),re=function(i){function n(e,n,o,t,s,r,a){void 0===r&&(r=["Legacy"]),void 0===a&&(a=function(){});var c=i.call(this,e,n,o,t,a)||this;return c.pool="prestige",c.posX=s[0],c.posY=s[1],c.parents=r.map(function(e){return Game.Upgrades[e]||Game.UpgradesById[e]}),Game.PrestigeUpgrades.push(c),Game.UpgradePositions[c.id]=s,c}return e(n,i),n}(se),ae=function(i){function n(e,n,o,t){var s=this;return"string"==typeof o&&(o=Game.Objects[o]),s=i.call(this,e,a(o.plural)+" are <b>twice</b> as efficient.<q>"+n+"</q>",o.basePrice*Game.Tiers[t].price,Game.GetIcon(o.name,t))||this,Game.SetTier(o.name,t),s.buildingTie1=o,G(s)&&(s.order=19e3,o.fortune=s),isNaN(parseInt(t.toString()))||(t=parseInt(t.toString())),"number"==typeof t&&(s.order=100*(o.id+1)+s.id/1e3,s.order-=75*F(0,E(o.id-4,3)),8<=o.id&&(s.order-=75)),"fortune"===t&&Game.Tiers[t].upgrades.push(s),o.buyFunction.apply(o),s}return e(n,i),n}(se),ce=function(i){function n(e,n,t,s){var r=this;"string"==typeof t&&(t=Game.Objects[t]);var c=t.id-1;return 1===c?c="grandma":c+=" grandmas",r=i.call(this,e,"Grandmas are <b>twice</b> as efficient. "+a(t.plural)+" gain <b>+1% CpS</b> per "+c+".<q>"+n+"</q>",t.basePrice*Game.Tiers[2].price,[10,9,""],Game.Objects.Grandma.redraw)||this,t.grandma=r,r.buildingTie=t,r.order=250+r.id/1e3,Game.GrandmaSynergies.push(r.name),s&&we.hooks.on("grandmaPic",function(e){return r.bought?o(e,[s]):e}),Game.Objects.Grandma.redraw(),t.buyFunction.apply(t),r}return e(n,i),n}(se),de=function(i){function n(e,n,o,t,s){var r=this;"string"==typeof o&&(o=Game.Objects[o]),"string"==typeof t&&(t=Game.Objects[t]);var c=Game.GetIcon(o.name,s);if(o.basePrice>t.basePrice){var d=o;o=t,t=d}return r=i.call(this,e,a(o.plural)+" gain <b>+5% CpS</b> per "+t.name.toLowerCase()+".<br>"+a(t.plural)+" gain <b>+0.1% CpS</b> per \n\t\t\t"+o.name.toLowerCase()+".<q>"+n+"</q>",(10*o.basePrice+1*t.basePrice)*Game.Tiers[s].price,c)||this,r.tier=s,r.buildingTie1=o,r.buildingTie2=t,r.order=5e3+r.id/1e3,o.synergies.push(r),t.synergies.push(r),Game.Tiers[s].upgrades.push(r),Game.RebuildUpgrades(),o.buyFunction.apply(o),r}return e(n,i),n}(se),le=[5,7,8,9,10],ue=function(i){function n(e,n,o,t){void 0===t&&(t=20);var s=this,r=Game.Objects.Cursor,a=parseInt(o.toString());return s=i.call(this,e,"Multiplies the gain from Thousand fingers by <b>"+t+"</b>.<q>"+n+"</q>",Game.Tiers[o].special||isNaN(a)?r.basePrice*Game.Tiers[o].price:x(10,le[E(a-4,le.length-1)]+3*F(a-8,0)),Game.GetIcon(r.name,o))||this,s.tier=o,s.pool="",s.order=100+s.id/1e3,we.on("cursorFingerMult",function(e){return s.bought?e*t:e}),Game.Tiers[o].special||isNaN(a)||we.buildingHooks.Cursor.on("buy",function(){r.amount>=(4===a?25:50*(a-4))&&Game.Unlock(s.name)}),"fortune"===o&&Game.Tiers[o].upgrades.push(s),Game.Objects.Cursor.buyFunction.apply(Game.Objects.Cursor),s}return e(n,i),n}(se),pe={1:5,2:4,4:4,default:3},me=[.1,.125,.15,.175,.2,.2,.2,.2,.2,.175,.15,.125,.115],ge=function(i){function n(e,n,o,t,s,r){void 0===t&&(t=Game.Tiers[o].special||isNaN(parseInt(o.toString()))?null:me[(parseInt(o.toString())-1)%(me.length-1)]),void 0===r&&(r=Game.Tiers[o].special||isNaN(parseInt(o.toString()))?null:1===o?.5:o-1);var a=i.call(this,e,"You gain <b>more CpS</b> the more milk you have.<q>"+n+"</q>",Game.Tiers[o].special||isNaN(parseInt(o.toString()))?null!==s&&void 0!==s?s:0:_(o),Game.GetIcon("Kitten",o))||this;return a.tier=o,a.kitten=!0,a.pool="",null===t&&console.warn("Please make sure to specify the power if the kitten tier is special"),(Game.Tiers[o].special||isNaN(parseInt(o.toString())))&&void 0===s&&console.warn("Please make sure to specify the cost if the kitten tier is special"),null!==r&&we.on("logic",function(){Game.milkProgress>=r&&Game.Unlock(a.name)}),a.order=2e4+a.id/1e3,null!==t&&we.on("rawCpsMult",function(e){var i=a.bought?1+Game.milkProgress*t*we.hiddenMilkMult:1;return Game.cookiesMultByType.kittens*=i,e*i}),Game.UpgradesByPool.kitten.push(a),"fortune"===o&&Game.Tiers[o].upgrades.push(a),a}return e(n,i),n}(se),ke=function(i){function n(e,n,o,t){void 0===t&&(t=1);var s=i.call(this,e,"Clicking gains <b>+"+t+"% of your CpS</b>.<q>"+n+"</q>",1,Game.GetIcon("Mouse",o))||this;s.tier=o,s.pool="";var r=parseInt(o.toString());return s.order=150+s.id/1e3,we.on("cpcAdd",function(e){return s.bought?e+Game.cookiesPs*t/100:e}),Game.Tiers[o].special||isNaN(r)||we.on("check",function(){Game.handmadeCookies>=x(10,1+2*r)&&Game.Unlock(s.name)}),"fortune"===o&&Game.Tiers[o].upgrades.push(s),s}return e(n,i),n}(se),be=function(i){function n(e,n,o,t,s,r,a){var c,d=i.call(this,e,"Cookie production multiplier <b>+"+Beautify("function"==typeof s?s():s,1)+"%</b>.<q>"+n+"</q>",o,t)||this;return d.power=s,d.pool="cookie",d.order=(null!==(c=null!==a&&void 0!==a?a:we.cookieOrder)&&void 0!==c?c:10020)+d.id/1e3,d.unlockAt={name:e,cookies:("function"==typeof o?o():o)/20,require:null===r||void 0===r?void 0:r.require,season:null===r||void 0===r?void 0:r.season},Game.UnlockAt.push(d.unlockAt),Game.UpgradesByPool.cookie.push(d),Game.cookieUpgrades.push(d),d}return e(n,i),n}(se),he=[],fe=function(){return function(e,i,n,o,t,s,r,a,c){void 0===o&&(o=!1),void 0===t&&(t="auto"),void 0===s&&(s=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===c&&(c="auto");var d;this.name=e,this.color=n,this.upgrades=[],this.special=o,this.keyName="auto"===c?o?e:(Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length+1).toString():c,null===s&&(this.unlock=-1),"number"==typeof s&&(this.unlock=s),(!1===o&&null===s||"auto"===s)&&(this.unlock=Game.Tiers[parseInt(this.keyName)-1].unlock+50),"number"==typeof r&&(this.achievUnlock=r),(!1===o&&null===r||"auto"===r)&&(this.achievUnlock=Game.Tiers[parseInt(this.keyName)-1].achievUnlock+50),a&&(this.req=a),this.price="auto"===t?1e8*Game.Tiers[Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length.toString()].price:t,this.iconRow=i[1],this.iconLink=P(null!==(d=i[2])&&void 0!==d?d:we.iconLink),Game.Tiers[this.keyName]=this,he.push(this)}}(),ve=[],Ce=function(i){function n(e,n,o){var t=i.call(this,e,n,T(o))||this;return r(t,k(t)),ve.push(t),t}return e(n,i),n}(Game.Achievement),ye=function(i){function n(e,n,o,t){void 0===t&&(t=x(10,M(1.5*Game.BankAchievements.length+2)));var s=i.call(this,e,"Bake <b>"+toFixed(t)+"</b> cookie"+(1===B(t)?"":"s")+" in one ascension."+(o?"<q>"+o+"</q>":""),n)||this;return s.treshold=t,s.order=100+.01*Game.BankAchievements.length,Game.BankAchievements.push(s),s}return e(n,i),n}(Ce),je=function(i){function n(e,n,o,t){void 0===t&&(t=x(10,M(1.2*Game.BankAchievements.length)));var s=i.call(this,e,"Bake <b>"+toFixed(t)+"</b> cookie"+(1===B(t)?"":"s")+" per second."+(o?"<q>"+o+"</q>":""),n)||this;return s.treshold=t,s.order=200+.01*Game.CpsAchievements.length,Game.CpsAchievements.push(s),s}return e(n,i),n}(Ce),Oe=function(i){function n(e,n,o,t){var s=this,r="object"==typeof o?o:Game.Objects[o],a=null,c=-1;if(0===r.id){switch(t){case"cursor2":a=[0,6],c=2;break;case"cursor50":a=[1,6],c=50;break;default:if(0>=Game.Tiers[t].achievUnlock){console.warn("Tier has invalid unlock amount");break}c=1===t?1:2*Game.Tiers[t].achievUnlock;}we.buildingHooks.Cursor.on("buy",function(){Game.Objects.Cursor.amount>=c&&Game.Win(s.name)})}else c=Game.Tiers[t].achievUnlock;return s=i.call(this,e,"Have <b>"+c+"</b> "+(1===B(c)?r.single:r.plural)+"."+(n?"<q>"+n+"</q>":""),null!==a&&void 0!==a?a:Game.GetIcon(r.name,t))||this,Game.SetTier(r.name,"cursor2"===t||"cursor50"===t?1:t),r.tieredAchievs[t]=s,s.buildingTie=r,s.order=1e3+100*r.id+s.id/1e3,s.order-=75*F(0,E(r.id-4,3)),8<=r.id&&(s.order-=75),0===r.id&&(s.order+=50),s}return e(n,i),n}(Ce),Pe=function(i){function n(e,n,o,t,s){var r=this;"string"==typeof n&&(n=Game.Objects[n]);var a=[n.iconColumn,21+o,n instanceof oe?n.iconLink:void 0],c=x(10,12+n.id+(null!==s&&void 0!==s?s:0)+7*(o-1));return T(a),r=i.call(this,e,"Make <b>"+toFixed(c)+"</b> cookies just from "+n.plural+"."+(t?"<q>"+t+"</q>":""),a)||this,r.order=1020+100*n.id+r.id/1e3,r.order-=75*F(0,E(n.id-4,3)),8<=n.id&&(r.order-=75),0===n.id&&(r.order+=50),n.productionAchievs.push({pow:c,achiev:r}),r}return e(n,i),n}(Ce),we={hooks:null,on:null,hiddenMilkMult:1,iconLink:"",buildingLink:"",cookieOrder:10020,buildingHooks:ie,buildingHooksById:[],hookAllBuildings:U,customBuildings:ne,customUpgrades:te,customTiers:he,save:X,onLoad:[],Building:oe,Upgrade:se,TieredUpgrade:ae,Tier:fe,HeavenlyUpgrade:re,GrandmaSynergy:ce,SynergyUpgrade:de,CursorUpgrade:ue,KittenUpgrade:ge,MouseUpgrade:ke,CookieUpgrade:be,Achievement:Ce,CpsAchievement:je,BankAchievement:ye,TieredAchievement:Oe,ProductionAchievement:Pe,customAchievements:ve,injectCode:s,DEFAULT_ONBUY:function(){Game.UnlockTiered(this),this.amount>=Game.SpecialGrandmaUnlock&&0<Game.Objects.Grandma.amount&&this.grandma&&Game.Unlock(this.grandma.name)},DEFAULT_CPS:function(e){return Game.GetTieredCpsMult(e)*Game.magicCpS(e.name)*e.baseCps},icons:{relinkColumn:function(e,o,t,s){return void 0===s&&(s=!1),i(this,void 0,void 0,function(){var r,a,a,c,d;return n(this,function(i){switch(i.label){case 0:for(a in void 0===t&&(!J[e]&&(J[e]=0),t=J[e]++),r={},Q)r[a]=[t,Q[a][1]];for(a in Game.Tiers)r[Game.Tiers[a].name.toLowerCase()]=r[a.toString()]=[t,Game.Tiers[a].iconRow];return c=O,d=[e],[4,S(s?P(e):e,r,o,[48,48],[48*(t+1),48*(Object.values(r).reduce(function(e,i){return F(e,i[1])},-Infinity)+1)],function(i){return new Promise(function(n){if(P(e)!==e){var o=new Image;o.addEventListener("load",function(){i.drawImage(o,0,0),n()}),o.src=P(e),o.crossOrigin="Anonymous"}else n()})})];case 1:return c.apply(void 0,d.concat([i.sent()])),[2];}})})},relinkRow:function(e,o,t,s){return void 0===s&&(s=!1),i(this,void 0,void 0,function(){var r,a,a,c,d;return n(this,function(i){switch(i.label){case 0:for(a in void 0===t&&(!Z[e]&&(Z[e]=0),t=Z[e]++),r={},ee)r[a]=[ee[a][0],t];for(a in Game.ObjectsById)r[Game.ObjectsById[a].single.toLowerCase()]=r[a]=[Game.ObjectsById[a].iconColumn,t];return c=O,d=[e],[4,S(s?P(e):e,r,o,[48,48],[48*(Object.values(r).reduce(function(e,i){return F(e,i[0])},-Infinity)+1),48*(t+1)],function(i){return new Promise(function(n){if(P(e)!==e){var o=new Image;o.addEventListener("load",function(){i.drawImage(o,0,0),n()}),o.src=P(e),o.crossOrigin="Anonymous"}else n()})})];case 1:return c.apply(void 0,d.concat([i.sent()])),[2];}})})},patchIconsheet:function(e,o,t){var s;return void 0===t&&(t=!0),i(this,void 0,void 0,function(){var i,r,a,c,d,u,p,m,g,k,b,h,f,v,C;return n(this,function(n){switch(n.label){case 0:return i=document.createElement("canvas").getContext("2d"),[4,w(t?P(e):e)];case 1:for(r=n.sent(),a=[r.width,r.height],(c=0,d=o);c<d.length;c++)u=d[c],48*u[0][0]>a[0]&&(a[0]=48*u[0][0]),48*u[0][1]>a[1]&&(a[1]=48*u[0][1]);i.canvas.width=a[0],i.canvas.height=a[1],i.drawImage(r,0,0),p={},m=0,g=o,n.label=2;case 2:return m<g.length?(k=g[m],b=P((null!==(s=k[1][2])&&void 0!==s?s:we.iconLink)||"img/icons.png"),!!p[b])?[3,4]:(h=p,f=b,[4,w(b)]):[3,6];case 3:h[f]=n.sent(),n.label=4;case 4:i.clearRect(48*k[0][0],48*k[0][1],48,48),i.drawImage(p[b],48*k[1][0],48*k[1][1],48,48,48*k[0][0],48*k[0][1],48,48),n.label=5;case 5:return m++,[3,2];case 6:return v=O,C=[e],[4,L(i)];case 7:return v.apply(void 0,C.concat([n.sent()])),[2];}})})},extraColumnIcons:Q,extraRowIcons:ee,alias:O,aliases:$}};window.Cppkies?N=window.Cppkies:(N=we,window.Cppkies=N,function(){return new Promise(function(e){var i=new H,n=[new V("customMenu",function(){Game.UpdateMenu=s(Game.UpdateMenu,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tswitch (Game.onMenu) {\n\t\t\t\t\t\tcase \"prefs\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"optionsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"stats\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"statsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"logMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tCppkies.hooks.emit(\"menu\")\n\t\t\t\t\t","before")}),new V("preSave",function(){Game.WriteSave=s(Game.WriteSave,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"preSave\")\n\t\t\t\t\t","before")}),new V("reset",function(){Game.Reset=s(Game.Reset,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"reset\", hard)\n\t\t\t\t\t","before")}),new V("getIcon",function(){Game.GetIcon=s(Game.GetIcon,"return [col,Game.Tiers[tier].iconRow];","\n\t\t\t\t\t// Cppkies Injection\n\t\t\t\t\treturn Cppkies.hooks.emit(\"getIcon\", { icon: [col, Game.Tiers[tier].iconRow], tier: tier, type: type }).icon","replace")}),new V("buildStore",function(){Game.BuildStore=s(Game.BuildStore,null,";\nCppkies.hooks.emit(\"buildStore\")","after")}),new V("grandmaPic",function(){Game.Objects.Grandma.art.pic=s(Game.Objects.Grandma.art.pic,"return choose(list)+'.png'","// Cppkies injection\n\t\t\t\t\tlist = Cppkies.hooks.emit(\"grandmaPic\", list)\n\t\t\t\t\t","before")}),new V("cps",function(){Game.CalculateGains=s(Game.CalculateGains,"var rawCookiesPs=Game.cookiesPs*mult;","// Cppkies injection\n\t\t\t\t\tGame.cookiesPs = Cppkies.hooks.emit(\"rawCps\", Game.cookiesPs);\n\t\t\t\t\tmult = Cppkies.hooks.emit(\"rawCpsMult\", mult);\n","before"),Game.CalculateGains=s(Game.CalculateGains,"Game.cookiesPs=Game.runModHookOnValue('cps',Game.cookiesPs);","\n// Cppkies injection\nmult = Cppkies.hooks.emit(\"cpsMult\", mult);\nGame.cookiesPs = Cppkies.hooks.emit(\"cps\", Game.cookiesPs);\n","before")}),new V("cursorFingerMult",function(){Game.Objects.Cursor.cps=s(Game.Objects.Cursor.cps,"var mult=1;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add)\n;","before")}),new V("cpc",function(){Game.mouseCps=s(Game.mouseCps,"var num=0;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add)\n;","before"),Game.mouseCps=s(Game.mouseCps,"out=Game.runModHookOnValue('cookiesPerClick',out);","// Cppkies injection\nout = Cppkies.hooks.emit(\"cpc\", out)\n;","before"),Game.mouseCps=s(Game.mouseCps,"var out","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cpcAdd\", add)\n;","before")}),new V("buildingCps",function(){Game.CalculateGains=s(Game.CalculateGains,"me.storedTotalCps=me.amount*me.storedCps;","// Cppkies injection (internal, do not use)\nme.storedCps = Cppkies.hooks.emit(\"buildingCps\", { building: i, cps: me.storedCps }).cps;\n","before")})];n.forEach(function(e){var i;null===(i=e.func)||void 0===i?void 0:i.call(e)}),Game.Loader.Load=s(Game.Loader.Load,"img.src=this.domain","\n\t\t\t// Cppkies injection\n\t\t\timg.src = (assets[i].indexOf('http') !== -1 ? \"\" : this.domain)\n","replace"),Game.Objects.Cursor.buyFunction=s(Game.Objects.Cursor.buyFunction,"Game.Unlock('Octillion fingers');","\n \t\t\t// Cppkies injection\n\t\t\tfor(const i in this.tieredUpgrades) {\n\t\t\t\tif (isNaN(parseInt(i))) continue\n\t\t\t\tif (this.amount >= Game.Tiers[this.tieredUpgrades[i].tier].unlock - 50) this.tieredUpgrades[i].unlock()\n\t\t\t}\n","after"),Game.Object=s(Game.Object,"Game.ObjectsN++","\n// Cppkies injection\nCppkies.hookAllBuildings();\n","after"),Game.CalculateGains=s(Game.CalculateGains,"var catMult=1;","// Cppkies injection\n\t\t\tCppkies.hiddenMilkMult = milkMult;\n","before"),Game.GetIcon=s(Game.GetIcon,"col=18;","else if (type === \"Mouse\") col = 11;","after"),Game.registerHook("logic",function(){return i.emit("logic")}),Game.registerHook("check",function(){return i.emit("check")}),e(i)})}().then(function(e){N.hooks=e,N.on=e.on.bind(e),Game.Notify("Cppkies loaded!","",[32,17],1.5);var i=document.createElement("div");i.textContent="Cppkies!",document.querySelector("#topBar").insertBefore(i,document.querySelector("#topBar").children[1]),Game.modSaveData.cppkies||(Game.modSaveData.cppkies="{}"),Game.registerMod("cppkies",{save:j,load:y}),Game.Win("Third-party"),U(),we.onLoad.forEach(function(e){return e()}),we.onLoad=new Proxy(we.onLoad,{set:function(e,i,n){return"length"!==i&&n(),!0}}),window.CPPKIES_ONLOAD||(window.CPPKIES_ONLOAD=[]),window.CPPKIES_ONLOAD.forEach(function(e){return e()}),window.CPPKIES_ONLOAD=new Proxy(we.onLoad,{set:function(e,i,n){return"length"!==i&&n(),!0}}),A()}));var Le=N;return Le});
//# sourceMappingURL=index.js.map
