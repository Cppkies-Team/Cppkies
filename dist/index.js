(function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self,e.Cppkies=n())})(this,function(){'use strict';var E=Math.abs,x=Math.floor,R=Math.min,F=Math.pow,H=Math.max;function e(e,n){function i(){this.constructor=e}Y(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}function n(e,n,i,o){return new(i||(i=Promise))(function(a,r){function s(e){try{d(o.next(e))}catch(n){r(n)}}function t(e){try{d(o["throw"](e))}catch(n){r(n)}}function d(e){e.done?a(e.value):new i(function(n){n(e.value)}).then(s,t)}d((o=o.apply(e,n||[])).next())})}function o(e,n){function i(e){return function(n){return o([e,n])}}function o(i){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,r&&(s=2&i[0]?r["return"]:i[0]?r["throw"]||((s=r["return"])&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch((r=0,s)&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if((s=c.trys,!(s=0<s.length&&s[s.length-1]))&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){c.label=i[1];break}if(6===i[0]&&c.label<s[1]){c.label=s[1],s=i;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(i);break}s[2]&&c.ops.pop(),c.trys.pop();continue;}i=n.call(e,c)}catch(n){i=[6,n],r=0}finally{a=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,r,s,d,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return d={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d}function a(){for(var e=0,n=0,o=arguments.length;n<o;n++)e+=arguments[n].length;for(var t=Array(e),r=0,n=0;n<o;n++)for(var d=arguments[n],a=0,c=d.length;a<c;a++,r++)t[r]=d[a];return t}function r(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function s(e,n,i,o,s){void 0===s&&(s={});var t=e.toString(),d=null===n,c=/(?:)/;null!==n&&(c="string"==typeof n?new RegExp(r(n),"g"):n,!c.test(t)&&console.warn("Nothing to inject."));var u=/(\)[^{]*{)/,p=/(}?)$/;switch(o){case"before":t=d?t.replace(u,"$1"+i):t.replace(c,""+i+n);break;case"replace":t=d?""+i:t.replace(c,""+i);break;case"after":t=d?t.replace(p,i+"$1"):t.replace(c,""+n+i);break;default:throw new Error("where Parameter must be \"before\", \"replace\" or \"after\"");}var g=Function.apply(void 0,a(Object.keys(s),["return ("+t+")"])).apply(void 0,Object.values(s));return g.prototype=e.prototype,g}function t(e,n){for(var o in n)e[o]=n[o]}function d(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function c(e,n){return e.hasOwnProperty(n)}function u(e){for(var n,i=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],o="",a=0,r=i;a<r.length;a++)for(n=r[a];e>=n[0];)o+=n[1],e-=n[0];return o}function p(e){switch(e){case"mod":return{achievements:{},buildings:{},upgrades:{}};case"dragon":return{level:"sync",auras:["sync","sync"]};case"achievement":return{won:!1};case"upgrade":return{bought:!1,unlocked:!1};case"building":return{amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""};default:throw new Error("Invalid fragment name!");}}function g(){return{mods:{},foreign:p("mod"),saveVer:1,dragon:p("dragon")}}function m(){Ie.save=V=g()}function k(e){return V.foreign.buildings[e.name]||p("building")}function b(e){var n=e.amount,i=e.bought,o=e.free,a=e.totalCookies,r=e.level,s=e.muted,t=e.minigameSave,d=e.name;V.foreign.buildings[d]={amount:n,bought:i,free:o,totalCookies:a,level:r,muted:s,minigameSave:t}}function h(e){return V.foreign.upgrades[e.name]||p("upgrade")}function v(e){V.foreign.upgrades[e.name]={unlocked:!!e.unlocked,bought:!!e.bought}}function f(e){return V.foreign.achievements[e.name]||p("achievement")}function C(e){V.foreign.achievements[e.name]={won:!!e.won}}function y(){"sync"!==V.dragon.level&&V.dragon.level<=Game.dragonLevels.length-1&&(Game.dragonLevel=V.dragon.level),"sync"!==V.dragon.auras[0]&&V.dragon.auras[0]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura=V.dragon.auras[0]),"sync"!==V.dragon.auras[1]&&V.dragon.auras[1]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura2=V.dragon.auras[1])}function L(){for(var e,n=0,i=Ie.customBuildings;n<i.length;n++)e=i[n],t(e,k(e));for(var o,a=0,r=Ie.customUpgrades;a<r.length;a++)o=r[a],t(o,h(o)),o.bought&&Game.CountsAsUpgradeOwned(o.pool)&&Game.UpgradesOwned++;for(var s,d=0,c=Ie.customAchievements;d<c.length;d++)s=c[d],t(s,f(s)),s.won&&Game.CountsAsAchievementOwned(s.pool)&&Game.AchievementsOwned++;y()}function A(){for(var e,n=0,i=Ie.customBuildings;n<i.length;n++)e=i[n],b(e);for(var o,a=0,r=Ie.customUpgrades;a<r.length;a++)o=r[a],v(o);for(var s,t=0,d=Ie.customAchievements;t<d.length;t++)s=d[t],C(s)}function O(e){var n=g();if("object"!=typeof e||null===e)return n;if(!c(e,"saveVer")||"number"!=typeof e.saveVer||1<e.saveVer)return n;if(n.foreign=c(e,"foreign")?function(e){var n=p("mod");if("object"!=typeof e||null===e)return n;if(c(e,"buildings")&&"object"==typeof e.buildings&&null!==e.buildings)for(var i in e.buildings){var o=e.buildings[i];if("object"==typeof o&&null!==o)for(var a in n.buildings[i]=p("building"),o)typeof n.buildings[i][a]==typeof o[a]&&(n.buildings[i][a]=o[a])}if(c(e,"upgrades")&&"object"==typeof e.upgrades&&null!==e.upgrades)for(var r in e.upgrades){var s=e.upgrades[r];if("object"==typeof s&&null!==s)for(var a in n.upgrades[r]=p("upgrade"),n.upgrades[r])typeof n.upgrades[r][a]==typeof s[a]&&(n.upgrades[r][a]=s[a])}if(c(e,"achievements")&&"object"==typeof e.achievements&&null!==e.achievements)for(var t in e.achievements){var d=e.achievements[t];if("object"==typeof d&&null!==d)for(var a in n.achievements[t]=p("achievement"),n.achievements[t])typeof n.achievements[t][a]==typeof d[a]&&(n.achievements[t][a]=d[a])}return n}(e.foreign):p("mod"),c(e,"dragon")&&"object"==typeof e.dragon&&null!==e.dragon&&(c(e.dragon,"level")&&("number"==typeof e.dragon.level||"sync"===e.dragon.level)&&(n.dragon.level=e.dragon.level),c(e.dragon,"auras")&&e.dragon.auras instanceof Array))for(var o in e.dragon.auras){var i=e.dragon.auras[o];("number"==typeof i||"sync"===i)&&(n.dragon.auras[o]=i)}return n}function w(e){var n;try{n=JSON.parse(e)}catch(n){""!==e&&console.warn("CPPKIES: Found invalid save, creating new one..."),m()}V=Ie.save=O(n),L()}function j(){return A(),JSON.stringify(V)}function S(e,n){$[e]=n}function T(e){if(z.includes(e))throw new Error("Recursive alias");return(z.push(e),e in $)?T($[e]):(z=[],e)}function U(e){return new Promise(function(n){var i=new Image;i.addEventListener("load",function(){n(i)}),i.crossOrigin="Anonymous",i.src=e})}function P(e){return new Promise(function(n){e.canvas.toBlob(function(e){n(URL.createObjectURL(e))})})}function I(e,n,i,o,a,r){return new Promise(function(s){i[0]instanceof Array||(i=[i]),i=i;var t={};for(var d in i)for(var c in i[d])if(i[d][c]){if(i[d][c]=i[d][c].toString().toLowerCase(),!(i[d][c]in n))throw new Error("Invalid icon name");t[i[d][c]]=[parseInt(c),parseInt(d)]}var u=document.createElement("canvas").getContext("2d"),p=new Image;p.addEventListener("load",function(){for(var e in u.canvas.width=a[0],u.canvas.height=a[1],t)u.drawImage(p,t[e][0]*o[0],t[e][1]*o[1],o[0],o[1],n[e][0]*o[0],n[e][1]*o[1],o[0],o[1]);var i,d=function(){P(u).then(s)};r&&(i=r(u)),i instanceof Promise?i.then(d):d()}),p.crossOrigin="Anonymous",p.src=e})}function G(e){return e=a(e),(void 0===e[2]||null===e[2])&&(e[2]=Ie.iconLink),e[2]=T(e[2]),e}function M(e){var n=new W,i=[new K("tooltip",function(){e.tooltip=s(s(e.tooltip,"return","let tempRet = ","replace"),null,"\n//Cppkies injection\n\t\t\t\treturn Cppkies.buildingHooks[this.name].emit(\"tooltip\", tempRet)","after")}),new K("buy",function(){e.buy=s(e.buy,null,"\n//Cppkies injection\n\t\t\t\tif(success) {\n\t\t\t\t\tCppkies.buildingHooks[this.name].emit(\"buy\")\n\t\t\t\t}","after")}),new K("levelUp",function(){e.levelUp=s(e.levelUp,"me.level+=1;","\n// Cppkies injection\nCppkies.buildingHooks[me.name].emit(\"levelUp\")","after",{me:e})})];i.forEach(function(e){var n;null===(n=e.func)||void 0===n?void 0:n.call(e)}),Ie.hooks.on("buildingCps",function(i){return{building:i.building,cps:Game.Objects[i.building]===e?n.emit("cps",i.cps):i.cps}}),ne[e.name]=n}function _(){for(var e,n=0,i=Game.ObjectsById;n<i.length;n++)e=i[n],ne[e.name]||M(e)}function B(e){return"fortune"===e.tier}function N(e){for(var n,o=1,a=1;a<=e;a++)o+=null!==(n=pe[a])&&void 0!==n?n:pe["default"];return 9*F(10,o)}function q(){Ie.on("getIcon",function(e){var n=e.icon,i=e.type,o=e.tier;return Ie.customTiers.forEach(function(e){e.keyName===o.toString()&&e.iconLink&&(n[2]=e.iconLink)}),{icon:n,type:i,tier:o}}),Ie.on("getIcon",function(e){var n=e.icon,i=e.type,o=e.tier;return Ie.customBuildings.forEach(function(e){e.name===i&&e.iconLink&&(n[2]=e.iconLink)}),{icon:n,tier:o,type:i}}),Ie.on("getIcon",function(e){var n=e.icon,i=e.type,o=e.tier;return void 0!==n[2]&&null!==n[2]||c(Game.Tiers[o.toString()],"iconLink")||(n[2]=""),{icon:n,tier:o,type:i}}),Ie.on("preSave",function(){if(0!==Game.dragonAura&&(V.dragon.auras[0]="sync"),0!==Game.dragonAura2&&(V.dragon.auras[1]="sync"),Game.dragonAuras[Game.dragonAura]instanceof Se&&(V.dragon.auras[0]=Game.dragonAura,Game.dragonAura=0),Game.dragonAuras[Game.dragonAura2]instanceof Se&&(V.dragon.auras[1]=Game.dragonAura2,Game.dragonAura2=0),Game.dragonLevels[Game.dragonLevel]instanceof Te||Game.dragonLevel>=X)for(V.dragon.level=Game.dragonLevel;Game.dragonLevels[Game.dragonLevel]instanceof Te||Game.dragonLevel>=X;)Game.dragonLevel--}),Ie.on("postSave",function(){"sync"!==V.dragon.auras[0]&&Game.dragonAuras[V.dragon.auras[0]]&&(Game.dragonAura=V.dragon.auras[0]),"sync"!==V.dragon.auras[1]&&Game.dragonAuras[V.dragon.auras[1]]&&(Game.dragonAura2=V.dragon.auras[1]),"sync"!==V.dragon.level&&Game.dragonLevels[V.dragon.level]&&(Game.dragonLevel=V.dragon.level)}),Ie.on("reset",function(){V.dragon.auras=["sync","sync"],V.dragon.level="sync"}),Ie.on("specialPic",function(e){var n,i=Game.dragonLevels[Game.dragonLevel];return"dragon"===e.tab&&i instanceof Te&&(e.pic=null!==(n=i.picLink)&&void 0!==n?n:e.pic),e})}var D,Y=function(e,n){return Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])},Y(e,n)},W=function(){function e(){this._events={}}return e.prototype.on=function(e,n){this._events[e]?this._events[e].push(n):this._events[e]=[n]},e.prototype.once=function(e,n){var i=this;this.on(e,function(o){return i.off(e,n),n(o)})},e.prototype.off=function(e,n){this._events[e].splice(this._events[e].indexOf(n),1)},e.prototype.emit=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var o=n[0];this._events[e]||(this._events[e]=[]);for(var a,r=0,s=this._events[e];r<s.length;r++)a=s[r],o=a(o);return o},e.prototype.constEmit=function(e){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];this._events[e]||(this._events[e]=[]);for(var o,a=0,r=this._events[e];a<r.length;a++)o=r[a],o(n[0])},e}(),K=function(){return function(e,n){this.value=e,this.func=n}}(),X=Game.dragonLevels.length+0,V=g(),$={},z=[],J={},Q={"3d":[0,21],milestone1:[0,22],milestone2:[0,23],milestone3:[0,24],krumblor:[0,25],level1:[0,26],level2:[0,27]},Z={},ee={research:[9,0],cookie:[10,0],mouse:[11,0],multicursor:[12,0],kitten:[18,0]},ne={},ie=[],oe=function(n){function i(e,o,a,r,s,t,d,c,u,p){var g,m,b=this;if(Game.Objects[e])throw new Error("Can't create building, \""+e+"\" is already used as a building name");0!==r[1]&&console.warn("All icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=relink-column"),0!==s[0]&&console.warn("All big icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=big-icons"),b=n.call(this,e,o,a,s[1],r[0],t,0,d,c)||this,ie.push(b),ne[e]||M(b);var h=function(e){if(0>=parseInt(e))return"continue";var n=Game.ObjectsById[e];if(n.canvas=l("rowCanvas"+e),!n.canvas)return"continue";if(n.ctx=n.canvas.getContext("2d"),n.canvas.addEventListener("mouseover",function(){n.mouseOn=!0}),n.canvas.addEventListener("mouseout",function(){n.mouseOn=!1}),n.canvas.addEventListener("mousemove",function(i){var e=n.canvas.getBoundingClientRect();n.mousePos[0]=i.pageX-e.left,n.mousePos[1]=i.pageY-e.top}),n.minigame&&n.minigameLoaded){var i=n.minigame.save();n.minigame.launch(),n.minigame.load(i)}};for(var v in Game.ObjectsById)h(v);b.buildingLink=null!==(g=s[2])&&void 0!==g?g:Ie.buildingLink,b.iconLink=T(null!==(m=r[2])&&void 0!==m?m:Ie.iconLink),u&&(Game.foolObjects[e]=u),p&&(Game.goldenCookieBuildingBuffs[e]=p),b.iconLink&&ne[b.name].on("tooltip",function(e){return b.locked?e:e.replace("background-position","background-image:url("+b.iconLink+");background-position")}),Game.BuildStore(),b.buildingLink&&Ie.hooks.on("buildStore",function(){l("productIcon"+b.id).style.backgroundImage="url("+b.buildingLink+")",l("productIconOff"+b.id).style.backgroundImage="url("+b.buildingLink+")"}),Game.BuildStore(),b.canvas=l("rowCanvas"+b.id),b.ctx=b.canvas.getContext("2d"),b.pics=[];var f=document.createElement("div");f.className="tinyProductIcon",f.id="mutedProduct"+b.id,f.style.display="none",b.buildingLink&&(f.style.backgroundImage="url("+b.buildingLink+")"),f.style.backgroundPositionX="-"+r[0]+"px",f.style.backgroundPositionY="-"+r[1]+"px",f.addEventListener("click",function(){b.mute(0),window.PlaySound(b.muted?"snd/clickOff.mp3":"snd/clickOn.mp3")}),window.AddEvent(b.canvas,"mouseover",function(){b.mouseOn=!0}),window.AddEvent(b.canvas,"mouseout",function(){b.mouseOn=!1}),b.canvas.addEventListener("mousemove",function(n){var e=b.canvas.getBoundingClientRect();b.mousePos[0]=n.pageX-e.left,b.mousePos[1]=n.pageY-e.top}),l("buildingsMute").appendChild(f);var C=k(b);for(var v in C)b[v]=C[v];return Game.recalculateGains=1,b}return e(i,n),i}(Game.Object),ae=[],re=function(n){function i(e,o,a,r,s){void 0===s&&(s=function(){});var t=n.call(this,e,"function"==typeof o?"":o,"function"==typeof a?0:a,"function"==typeof r?[0,0]:G(r),s)||this;"function"==typeof o&&(t.descFunc=o),"function"==typeof a&&(t.priceFunc=a),"function"==typeof r&&(t.iconFunction=function(){return G(r())}),ae.push(t);var d=h(t);for(var c in d)t[c]=d[c];return Game.upgradesToRebuild=1,t.bought&&Game.CountsAsUpgradeOwned(t.pool)&&Game.UpgradesOwned++,t}return e(i,n),i}(Game.Upgrade),se=function(n){function i(e,i,o,a,r,s,t){void 0===s&&(s=["Legacy"]),void 0===t&&(t=function(){});var d=n.call(this,e,i,o,a,t)||this;return d.pool="prestige",d.posX=r[0],d.posY=r[1],d.parents=s.map(function(e){return Game.Upgrades[e]||Game.UpgradesById[e]}),Game.PrestigeUpgrades.push(d),Game.UpgradePositions[d.id]=r,d}return e(i,n),i}(re),te=function(n){function i(e,i,o,a){var r=this;return"string"==typeof o&&(o=Game.Objects[o]),r=n.call(this,e,d(o.plural)+" are <b>twice</b> as efficient.<q>"+i+"</q>",o.basePrice*Game.Tiers[a].price,Game.GetIcon(o.name,a))||this,Game.SetTier(o.name,a),r.buildingTie1=o,B(r)&&(r.order=19e3,o.fortune=r),isNaN(parseInt(a.toString()))||(a=parseInt(a.toString())),"number"==typeof a&&(r.order=100*(o.id+1)+r.id/1e3,r.order-=75*H(0,R(o.id-4,3)),8<=o.id&&(r.order-=75)),"fortune"===a&&Game.Tiers[a].upgrades.push(r),o.buyFunction.apply(o),r}return e(i,n),i}(re),de=function(n){function i(e,i,o,r){var s=this;if(r){if(!r.endsWith(".png"))throw new Error("Can't use the grandma picture URL \""+r+"\", URL must end with .png");r=r.substring(0,r.length-4)}"string"==typeof o&&(o=Game.Objects[o]);var t=o.id-1;return 1===t?t="grandma":t+=" grandmas",s=n.call(this,e,"Grandmas are <b>twice</b> as efficient. "+d(o.plural)+" gain <b>+1% CpS</b> per "+t+".<q>"+i+"</q>",o.basePrice*Game.Tiers[2].price,[10,9,""],Game.Objects.Grandma.redraw)||this,o.grandma=s,s.buildingTie=o,s.order=250+s.id/1e3,12<=o.id&&(s.order+=5),Game.GrandmaSynergies.push(s.name),r&&Ie.hooks.on("grandmaPic",function(e){return s.bought?a(e,[r]):e}),Game.Objects.Grandma.redraw(),o.buyFunction.apply(o),s}return e(i,n),i}(re),ce=function(n){function i(e,i,o,a,r){var s=this;"string"==typeof o&&(o=Game.Objects[o]),"string"==typeof a&&(a=Game.Objects[a]);var t=Game.GetIcon(o.name,r);if(o.basePrice>a.basePrice){var c=o;o=a,a=c}return s=n.call(this,e,d(o.plural)+" gain <b>+5% CpS</b> per "+a.name.toLowerCase()+".<br>"+d(a.plural)+" gain <b>+0.1% CpS</b> per \n\t\t\t"+o.name.toLowerCase()+".<q>"+i+"</q>",(10*o.basePrice+1*a.basePrice)*Game.Tiers[r].price,t)||this,s.tier=r,s.buildingTie1=o,s.buildingTie2=a,s.order=5e3+s.id/1e3,o.synergies.push(s),a.synergies.push(s),Game.Tiers[r].upgrades.push(s),Game.RebuildUpgrades(),o.buyFunction.apply(o),s}return e(i,n),i}(re),le=[5,7,8,9,10],ue=function(n){function i(e,i,o,a){void 0===a&&(a=20);var r=this,s=Game.Objects.Cursor,t=parseInt(o.toString());return r=n.call(this,e,"Multiplies the gain from Thousand fingers by <b>"+a+"</b>.<q>"+i+"</q>",Game.Tiers[o].special||isNaN(t)?s.basePrice*Game.Tiers[o].price:F(10,le[R(t-4,le.length-1)]+3*H(t-8,0)),Game.GetIcon(s.name,o))||this,r.tier=o,r.pool="",r.order=100+r.id/1e3,Ie.on("cursorFingerMult",function(e){return r.bought?e*a:e}),Game.Tiers[o].special||isNaN(t)||Ie.buildingHooks.Cursor.on("buy",function(){s.amount>=(4===t?25:50*(t-4))&&Game.Unlock(r.name)}),"fortune"===o&&Game.Tiers[o].upgrades.push(r),Game.Objects.Cursor.buyFunction.apply(Game.Objects.Cursor),r}return e(i,n),i}(re),pe={1:5,2:4,4:4,default:3},ge=[.1,.125,.15,.175,.2,.2,.2,.2,.2,.175,.15,.125,.115],me=function(n){function i(e,i,o,a,r,s){void 0===a&&(a=Game.Tiers[o].special||isNaN(parseInt(o.toString()))?null:ge[(parseInt(o.toString())-1)%(ge.length-1)]),void 0===s&&(s=Game.Tiers[o].special||isNaN(parseInt(o.toString()))?null:1===o?.5:o-1);var t=n.call(this,e,"You gain <b>more CpS</b> the more milk you have.<q>"+i+"</q>",Game.Tiers[o].special||isNaN(parseInt(o.toString()))?null!==r&&void 0!==r?r:0:N(o),Game.GetIcon("Kitten",o))||this;return t.tier=o,t.kitten=!0,t.pool="",null===a&&console.warn("Please make sure to specify the power if the kitten tier is special"),(Game.Tiers[o].special||isNaN(parseInt(o.toString())))&&void 0===r&&console.warn("Please make sure to specify the cost if the kitten tier is special"),null!==s&&Ie.on("logic",function(){Game.milkProgress>=s&&Game.Unlock(t.name)}),t.order=2e4+t.id/1e3,null!==a&&Ie.on("rawCpsMult",function(e){var n=t.bought?1+Game.milkProgress*a*Ie.hiddenMilkMult:1;return Game.cookiesMultByType.kittens*=n,e*n}),Game.UpgradesByPool.kitten.push(t),"fortune"===o&&Game.Tiers[o].upgrades.push(t),t}return e(i,n),i}(re),ke=function(n){function i(e,i,o,a){void 0===a&&(a=1);var r=n.call(this,e,"Clicking gains <b>+"+a+"% of your CpS</b>.<q>"+i+"</q>",F(10,3+2*parseInt(o.toString())),Game.GetIcon("Mouse",o))||this;r.tier=o,r.pool="";var s=parseInt(o.toString());return r.order=150+r.id/1e3,Ie.on("cpcAdd",function(e){return r.bought?e+Game.cookiesPs*a/100:e}),Game.Tiers[o].special||isNaN(s)||Ie.on("check",function(){Game.handmadeCookies>=F(10,1+2*s)&&Game.Unlock(r.name)}),"fortune"===o&&Game.Tiers[o].upgrades.push(r),r}return e(i,n),i}(re),be=function(n){function i(e,i,o,a,r,s,t){var d,c=n.call(this,e,"Cookie production multiplier <b>+"+Beautify("function"==typeof r?r():r,1)+"%</b>.<q>"+i+"</q>",o,a)||this;return c.power=r,c.pool="cookie",c.order=(null!==(d=null!==t&&void 0!==t?t:Ie.cookieOrder)&&void 0!==d?d:10020)+c.id/1e3,c.unlockAt={name:e,cookies:("function"==typeof o?o():o)/20,require:null===s||void 0===s?void 0:s.require,season:null===s||void 0===s?void 0:s.season},Game.UnlockAt.push(c.unlockAt),Game.UpgradesByPool.cookie.push(c),Game.cookieUpgrades.push(c),c}return e(i,n),i}(re),he=[],ve=function(){return function(e,n,i,o,a,r,s,t,d){void 0===o&&(o=!1),void 0===a&&(a="auto"),void 0===r&&(r=null),void 0===s&&(s=null),void 0===t&&(t=null),void 0===d&&(d="auto");var c;this.name=e,this.color=i,this.upgrades=[],this.special=o,this.keyName="auto"===d?o?e:(Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length+1).toString():d,null===r&&(this.unlock=-1),"number"==typeof r&&(this.unlock=r),(!1===o&&null===r||"auto"===r)&&(this.unlock=Game.Tiers[parseInt(this.keyName)-1].unlock+50),"number"==typeof s&&(this.achievUnlock=s),(!1===o&&null===s||"auto"===s)&&(this.achievUnlock=Game.Tiers[parseInt(this.keyName)-1].achievUnlock+50),t&&(this.req=t),this.price="auto"===a?1e8*Game.Tiers[Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length.toString()].price:a,this.iconRow=n[1],this.iconLink=T(null!==(c=n[2])&&void 0!==c?c:Ie.iconLink),Game.Tiers[this.keyName]=this,he.push(this)}}(),fe=[],Ce=function(n){function i(e,i,o){var a=n.call(this,e,i,G(o))||this;return t(a,f(a)),fe.push(a),a.won&&Game.CountsAsAchievementOwned(a.pool)&&Game.AchievementsOwned++,a}return e(i,n),i}(Game.Achievement),ye=function(n){function i(e,i,o,a){void 0===a&&(a=F(10,x(1.5*Game.BankAchievements.length+2)));var r=n.call(this,e,"Bake <b>"+toFixed(a)+"</b> cookie"+(1===E(a)?"":"s")+" in one ascension."+(o?"<q>"+o+"</q>":""),i)||this;return r.treshold=a,r.order=100+.01*Game.BankAchievements.length,Game.BankAchievements.push(r),r}return e(i,n),i}(Ce),Le=function(n){function i(e,i,o,a){void 0===a&&(a=F(10,x(1.2*Game.BankAchievements.length)));var r=n.call(this,e,"Bake <b>"+toFixed(a)+"</b> cookie"+(1===E(a)?"":"s")+" per second."+(o?"<q>"+o+"</q>":""),i)||this;return r.treshold=a,r.order=200+.01*Game.CpsAchievements.length,Game.CpsAchievements.push(r),r}return e(i,n),i}(Ce),Ae=function(n){function i(e,i,o,a){var r=this,s="object"==typeof o?o:Game.Objects[o],t=null,d=-1;if(0===s.id){switch(a){case"cursor2":t=[0,6],d=2;break;case"cursor50":t=[1,6],d=50;break;default:if(0>=Game.Tiers[a].achievUnlock){console.warn("Tier has invalid unlock amount");break}d=1===a?1:2*Game.Tiers[a].achievUnlock;}Ie.buildingHooks.Cursor.on("buy",function(){Game.Objects.Cursor.amount>=d&&Game.Win(r.name)})}else d=Game.Tiers[a].achievUnlock;return r=n.call(this,e,"Have <b>"+d+"</b> "+(1===E(d)?s.single:s.plural)+"."+(i?"<q>"+i+"</q>":""),null!==t&&void 0!==t?t:Game.GetIcon(s.name,a))||this,Game.SetTier(s.name,"cursor2"===a||"cursor50"===a?1:a),s.tieredAchievs[a]=r,r.buildingTie=s,r.order=1e3+100*s.id+r.id/1e3,r.order-=75*H(0,R(s.id-4,3)),8<=s.id&&(r.order-=75),0===s.id&&(r.order+=50),r}return e(i,n),i}(Ce),Oe=function(n){function i(e,i,o,a,r){var s=this;"string"==typeof i&&(i=Game.Objects[i]);var t=[i.iconColumn,21+o,i instanceof oe?i.iconLink:void 0],d=F(10,12+i.id+(null!==r&&void 0!==r?r:0)+7*(o-1));return s=n.call(this,e,"Make <b>"+toFixed(d)+"</b> cookies just from "+i.plural+"."+(a?"<q>"+a+"</q>":""),t)||this,s.order=1020+100*i.id+s.id/1e3,s.order-=75*H(0,R(i.id-4,3)),8<=i.id&&(s.order-=75),0===i.id&&(s.order+=50),i.productionAchievs.push({pow:d,achiev:s}),s}return e(i,n),i}(Ce),we=function(n){function i(e,i,o){var a=this;"string"==typeof i&&(i=Game.Objects[i]);var r=[i.iconColumn,26,i instanceof oe?i.iconLink:void 0];return a=n.call(this,e,"Reach level <b>10</b> "+i.plural+"."+(o?"<q>"+o+"</q>":""),r)||this,a.order=1020+100*i.id+a.id/1e3,a.order-=75*H(0,R(i.id-4,3)),8<=i.id&&(a.order-=75),0===i.id&&(a.order+=50),i.levelAchiev10=a,a}return e(i,n),i}(Ce),je=function(n){function i(e,i,o){var a=this,r=parseInt(i.toString());return a=n.call(this,e,"Make <b>"+toFixed(F(10,1+2*r))+"</b> cookies from clicking."+(o?"<q>"+o+"</q>":""),Game.GetIcon("Mouse",i))||this,a.pool="normal",a.tier=i,a.order=1e3+a.id/1e3,Game.Tiers[i].special||isNaN(r)||Ie.on("check",function(){Game.handmadeCookies>=F(10,1+2*r)&&Game.Win(a.name)}),a}return e(i,n),i}(Ce),Se=function(){function e(e,n,i){this.name=e,this.desc=n,"string"==typeof i&&(i=Game.Objects[i]),this.pic=i instanceof Game.Object?G([i.iconColumn,25,i instanceof oe?i.iconLink:void 0]):i,Game.dragonAuras[Object.keys(Game.dragonAuras).length]=this,"sync"!==V.dragon.auras[0]&&Object.keys(Game.dragonAuras).length>=V.dragon.auras[0]&&(Game.dragonAura=V.dragon.auras[0]),"sync"!==V.dragon.auras[1]&&Object.keys(Game.dragonAuras).length>=V.dragon.auras[1]&&(Game.dragonAura2=V.dragon.auras[1])}return e}(),Te=function(){function e(n,i,o,a,r,s,t){void 0===t&&(t=Game.dragonLevels.length-3),this.buy=r,this.picY=0;var d=Game.dragonLevels[t-1];this.name=null!==n&&void 0!==n?n:d.name,this.action=i,this.costStr="string"==typeof o?function(){return o}:o,this.cost=a,s?(this.pic=s[0],this.picY=s[1],0!==this.picY&&console.warn("For now, all dragon levels must not use pic Y, sorry."),this.picLink=s[2]):(this.pic=d.pic,d instanceof e&&(this.picY=d.picY,this.picLink=d.picLink)),Game.dragonLevels.splice(t,0,this),"sync"!==V.dragon.level&&Game.dragonLevels.length>=V.dragon.level&&(Game.dragonLevel=V.dragon.level)}return e}(),Ue=function(n){function i(e,i,o){var a=this;return"string"==typeof o&&(o=Game.Objects[o]),a=n.call(this,null,"Train "+e+"<br/><small>Aura : "+i+"</small>","100 "+o.plural,function(){return 100<=o.amount},function(){return o.sacrifice(100)})||this,a}return e(i,n),i}(Te),Pe=function(){return function(e,n,i,o){if(void 0===o&&(o=!1),this.name=e,this.pic=i,this.special=o,!i.endsWith(".png"))throw new Error("Can't create milk with the milk URL \""+i+"\", the URL must end with .png!");o||(this.name="Rank "+u(Game.Milks.length+1)+" - "+e),this.pic=i.substr(0,i.length-4),G(n),this.icon=[n[0],n[1]],this.iconLink=n[2],o?Game.MilksByChoice[Object.keys(Game.MilksByChoice).length]=this:Game.Milks.push(this)}}(),Ie={hooks:null,on:null,hiddenMilkMult:1,iconLink:"",buildingLink:"",cookieOrder:10020,buildingHooks:ne,buildingHooksById:[],hookAllBuildings:_,customBuildings:ie,customUpgrades:ae,customTiers:he,save:V,onLoad:[],Building:oe,Upgrade:re,TieredUpgrade:te,Tier:ve,HeavenlyUpgrade:se,GrandmaSynergy:de,SynergyUpgrade:ce,CursorUpgrade:ue,KittenUpgrade:me,MouseUpgrade:ke,CookieUpgrade:be,Achievement:Ce,CpsAchievement:Le,BankAchievement:ye,TieredAchievement:Ae,ProductionAchievement:Oe,Level10Achievement:we,MouseAchievement:je,customAchievements:fe,DragonAura:Se,DragonLevel:Te,DragonAuraLevel:Ue,Milk:Pe,injectCode:s,DEFAULT_ONBUY:function(){Game.UnlockTiered(this),this.amount>=Game.SpecialGrandmaUnlock&&0<Game.Objects.Grandma.amount&&this.grandma&&Game.Unlock(this.grandma.name)},DEFAULT_CPS:function(e){return Game.GetTieredCpsMult(e)*Game.magicCpS(e.name)*e.baseCps},icons:{relinkColumn:function(e,a,r,s){return void 0===s&&(s=!1),n(this,void 0,void 0,function(){var n,t,t,d,c;return o(this,function(i){switch(i.label){case 0:for(t in void 0===r&&(!J[e]&&(J[e]=0),r=J[e]++),n={},Q)n[t]=[r,Q[t][1]];for(t in Game.Tiers)n[Game.Tiers[t].name.toLowerCase()]=n[t.toString()]=[r,Game.Tiers[t].iconRow];return d=S,c=[e],[4,I(s?T(e):e,n,a,[48,48],[48*(r+1),48*(Object.values(n).reduce(function(e,n){return H(e,n[1])},-Infinity)+1)],function(n){return new Promise(function(i){if(T(e)!==e){var o=new Image;o.addEventListener("load",function(){n.drawImage(o,0,0),i()}),o.src=T(e),o.crossOrigin="Anonymous"}else i()})})];case 1:return d.apply(void 0,c.concat([i.sent()])),[2];}})})},relinkRow:function(e,a,r,s){return void 0===s&&(s=!1),n(this,void 0,void 0,function(){var n,t,t,d,c;return o(this,function(i){switch(i.label){case 0:for(t in void 0===r&&(!Z[e]&&(Z[e]=0),r=Z[e]++),n={},ee)n[t]=[ee[t][0],r];for(t in Game.ObjectsById)n[Game.ObjectsById[t].single.toLowerCase()]=n[t]=[Game.ObjectsById[t].iconColumn,r];return d=S,c=[e],[4,I(s?T(e):e,n,a,[48,48],[48*(Object.values(n).reduce(function(e,n){return H(e,n[0])},-Infinity)+1),48*(r+1)],function(n){return new Promise(function(i){if(T(e)!==e){var o=new Image;o.addEventListener("load",function(){n.drawImage(o,0,0),i()}),o.src=T(e),o.crossOrigin="Anonymous"}else i()})})];case 1:return d.apply(void 0,c.concat([i.sent()])),[2];}})})},patchIconsheet:function(e,i,a){var r;return void 0===a&&(a=!0),n(this,void 0,void 0,function(){var n,s,t,d,c,u,p,g,m,k,b,h,v,f,C;return o(this,function(o){switch(o.label){case 0:return n=document.createElement("canvas").getContext("2d"),[4,U(a?T(e):e)];case 1:for(s=o.sent(),t=[s.width,s.height],(d=0,c=i);d<c.length;d++)u=c[d],48*u[0][0]>t[0]&&(t[0]=48*u[0][0]),48*u[0][1]>t[1]&&(t[1]=48*u[0][1]);n.canvas.width=t[0],n.canvas.height=t[1],n.drawImage(s,0,0),p={},g=0,m=i,o.label=2;case 2:return g<m.length?(k=m[g],b=T((null!==(r=k[1][2])&&void 0!==r?r:Ie.iconLink)||"img/icons.png"),!!p[b])?[3,4]:(h=p,v=b,[4,U(b)]):[3,6];case 3:h[v]=o.sent(),o.label=4;case 4:n.clearRect(48*k[0][0],48*k[0][1],48,48),n.drawImage(p[b],48*k[1][0],48*k[1][1],48,48,48*k[0][0],48*k[0][1],48,48),o.label=5;case 5:return g++,[3,2];case 6:return f=S,C=[e],[4,P(n)];case 7:return f.apply(void 0,C.concat([o.sent()])),[2];}})})},extraColumnIcons:Q,extraRowIcons:ee,alias:S,aliases:$}};window.Cppkies?D=window.Cppkies:(D=Ie,window.Cppkies=D,function(){return new Promise(function(e){var n=new W,i=[new K("customMenu",function(){Game.UpdateMenu=s(Game.UpdateMenu,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tswitch (Game.onMenu) {\n\t\t\t\t\t\tcase \"prefs\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"optionsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"stats\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"statsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"logMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tCppkies.hooks.emit(\"menu\")\n\t\t\t\t\t","before")}),new K("preSave",function(){Game.WriteSave=s(Game.WriteSave,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"preSave\")\n\t\t\t\t\t","before")}),new K("postSave",function(){Game.WriteSave=s(Game.WriteSave,"if (type==2 || type==3)","\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"postSave\")\n\t\t\t\t\t","before")}),new K("reset",function(){Game.Reset=s(Game.Reset,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.constEmit(\"reset\", hard)\n\t\t\t\t\t","before")}),new K("reincarnate",function(){Game.registerHook("reincarnate",function(){return n.emit("reincarnate")})}),new K("getIcon",function(){Game.GetIcon=s(Game.GetIcon,"return [col,Game.Tiers[tier].iconRow];","\n\t\t\t\t\t// Cppkies Injection\n\t\t\t\t\treturn Cppkies.hooks.emit(\"getIcon\", { icon: [col, Game.Tiers[tier].iconRow], tier: tier, type: type }).icon","replace"),Game.GetIcon=s(Game.GetIcon,"col=18;","else if (type === \"Mouse\") col = 11;","after")}),new K("buildStore",function(){Game.BuildStore=s(Game.BuildStore,null,";\nCppkies.hooks.emit(\"buildStore\")","after")}),new K("grandmaPic",function(){Game.Objects.Grandma.art.pic=s(Game.Objects.Grandma.art.pic,"return choose(list)+'.png'","// Cppkies injection\n\t\t\t\t\tlist = Cppkies.hooks.emit(\"grandmaPic\", list)\n\t\t\t\t\t","before")}),new K("cps",function(){Game.CalculateGains=s(Game.CalculateGains,"var rawCookiesPs=Game.cookiesPs*mult;","// Cppkies injection\n\t\t\t\t\tGame.cookiesPs = Cppkies.hooks.emit(\"rawCps\", Game.cookiesPs);\n\t\t\t\t\tmult = Cppkies.hooks.emit(\"rawCpsMult\", mult);\n","before"),Game.CalculateGains=s(Game.CalculateGains,"Game.cookiesPs=Game.runModHookOnValue('cps',Game.cookiesPs);","// Cppkies injection\nmult = Cppkies.hooks.emit(\"cpsMult\", mult);\n","before"),Game.registerHook("cps",function(e){return n.emit("cps",e)})}),new K("cursorFingerMult",function(){Game.Objects.Cursor.cps=s(Game.Objects.Cursor.cps,"var mult=1;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add);\n","before")}),new K("cpc",function(){Game.mouseCps=s(Game.mouseCps,"var num=0;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add);\n","before"),Game.registerHook("cookiesPerClick",function(e){return n.emit("cpc",e)}),Game.mouseCps=s(Game.mouseCps,"var out","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cpcAdd\", add);\n","before")}),new K("buildingCps",function(){Game.CalculateGains=s(Game.CalculateGains,"me.storedTotalCps=me.amount*me.storedCps;","// Cppkies injection (internal, do not use)\nme.storedCps = Cppkies.hooks.emit(\"buildingCps\", { building: i, cps: me.storedCps }).cps;\n","before")}),new K("logic",function(){Game.registerHook("logic",function(){return n.emit("logic")})}),new K("draw",function(){Game.registerHook("draw",function(){return n.emit("draw")})}),new K("check",function(){Game.registerHook("check",function(){return n.emit("check")})}),new K("ticker",function(){Game.getNewTicker=s(Game.getNewTicker,"Game.TickerAge=Game.fps*10;","// Cppkies injection\nlist = Cppkies.hooks.emit(\"ticker\", list);\n","before")}),new K("specialPic",function(){Game.DrawSpecial=s(Game.DrawSpecial,"if (hovered || selected)","// Cppkies injection\nconst override = Cppkies.hooks.emit(\"specialPic\", {tab: Game.specialTabs[i], frame: frame, pic: pic})\npic = override.pic\nframe = override.frame;\n","before"),Game.ToggleSpecialMenu=s(Game.ToggleSpecialMenu,"else {pic='dragon.png?v='+Game.version;frame=4;}","// Cppkies injection\nconst override = Cppkies.hooks.emit(\"specialPic\", {tab: Game.specialTab, frame: frame, pic: pic})\npic = override.pic\nframe = override.frame;\n","after")})];i.forEach(function(e){var n;null===(n=e.func)||void 0===n?void 0:n.call(e)}),Game.Loader.Load=s(Game.Loader.Load,"img.src=this.domain","\n\t\t\t// Cppkies injection\n\t\t\timg.src = (assets[i].indexOf('http') !== -1 ? \"\" : this.domain)\n","replace"),Game.UpdateMenu=s(Game.UpdateMenu,"url(img/'+milk.pic+'.png)","url(' + (milk.pic.indexOf('http') >= 0 ? milk.pic : 'img/'+milk.pic) + '.png)","replace"),Game.UpdateMenu=s(Game.UpdateMenu,"img/icons.png?v='+Game.version+'","' + (Game.Milks[i].iconLink ? Game.Milks[i].iconLink : 'img/icons.png?v='+Game.version) + '","replace"),Game.ToggleSpecialMenu=s(Game.ToggleSpecialMenu,">=5",">=Game.dragonLevels.findIndex(val => val.name === \"Krumblor, cookie hatchling\")","replace"),Game.ToggleSpecialMenu=s(Game.ToggleSpecialMenu,">=25",">=Game.dragonLevels.findIndex(val => val.action === \"Train secondary aura<br><small>Lets you use two dragon auras simultaneously</small>\") + 1","replace"),Game.Objects.Cursor.buyFunction=s(Game.Objects.Cursor.buyFunction,"Game.Unlock('Octillion fingers');","\n \t\t\t// Cppkies injection\n\t\t\tfor(const i in this.tieredUpgrades) {\n\t\t\t\tif (isNaN(parseInt(i))) continue\n\t\t\t\tif (this.amount >= Game.Tiers[this.tieredUpgrades[i].tier].unlock - 50) this.tieredUpgrades[i].unlock()\n\t\t\t}\n","after"),Game.Object=s(Game.Object,"Game.ObjectsN++","\n// Cppkies injection\nCppkies.hookAllBuildings();\n","after"),Game.CalculateGains=s(Game.CalculateGains,"var catMult=1;","// Cppkies injection\n\t\t\tCppkies.hiddenMilkMult = milkMult;\n","before"),e(n)})}().then(function(e){D.hooks=e,D.on=e.on.bind(e),Game.Notify("Cppkies loaded!","",[32,17],1.5);var n=document.createElement("div");n.textContent="Cppkies!",document.querySelector("#topBar").insertBefore(n,document.querySelector("#topBar").children[1]),Game.modSaveData.cppkies||(Game.modSaveData.cppkies="{}"),Game.registerMod("cppkies",{save:j,load:w}),Game.Win("Third-party"),_(),Ie.onLoad.forEach(function(e){return e()}),Ie.onLoad=new Proxy(Ie.onLoad,{set:function(e,n,i){return"length"!==n&&i(),!0}}),window.CPPKIES_ONLOAD||(window.CPPKIES_ONLOAD=[]),window.CPPKIES_ONLOAD.forEach(function(e){return e()}),window.CPPKIES_ONLOAD=new Proxy(Ie.onLoad,{set:function(e,n,i){return"length"!==n&&i(),!0}}),q()}));var Ge=D;return Ge});
//# sourceMappingURL=index.js.map
