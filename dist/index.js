(function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e=e||self,e.Cppkies=i())})(this,function(){'use strict';var A=Math.abs,B=Math.floor,M=Math.min,E=Math.pow,x=Math.max;function e(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function i(n,o,t,s,r){for(var a in void 0===r&&(r={}),r)if(!/[a-zA-Z_$][0-9a-zA-Z_$]*/.test(a))throw new Error("Invalid context variable name!");var c=n.toString(),d=null===o,u=/(?:)/;null!==o&&(u="string"==typeof o?new RegExp(e(o),"g"):o,!u.test(c)&&console.warn("Nothing to inject."));var p=/(\)[^{]*{)/,m=/(}?)$/;switch(s){case"before":c=d?c.replace(p,"$1"+t):c.replace(u,""+t+o);break;case"replace":c=d?""+t:c.replace(u,""+t);break;case"after":c=d?c.replace(m,t+"$1"):c.replace(u,""+o+t);break;default:throw new Error("where Parameter must be \"before\", \"replace\" or \"after\"");}var g="";for(var a in r)g+="var "+a+" = globalThis.tempCtx."+a+"\n";globalThis.tempCtx=r;var k=new Function(g+"globalThis.tempCtx = null\nreturn ("+c+")")();return k.prototype=n.prototype,k}function n(e,n){for(var o in n)e[o]=n[o]}function o(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function t(e,i){return e.hasOwnProperty(i)}function s(){Se.save=D={mods:{},foreign:K,saveVer:1}}function r(e){return D.foreign.buildings[e.name]||R}function a(e){var i=e.amount,n=e.bought,o=e.free,t=e.totalCookies,s=e.level,r=e.muted,a=e.minigameSave,c=e.name;D.foreign.buildings[c]={amount:i,bought:n,free:o,totalCookies:t,level:s,muted:r,minigameSave:a}}function c(e){return D.foreign.upgrades[e.name]||H}function d(e){D.foreign.upgrades[e.name]={unlocked:!!e.unlocked,bought:!!e.bought}}function u(e){return D.foreign.achievements[e.name]||V}function p(e){D.foreign.achievements[e.name]={won:!!e.won}}function m(e){switch(s(),e.saveVer){case 0:D.foreign.buildings=e.foreign.buildings;break;default:throw new Error("Invalid save version "+D.saveVer+" (current version is "+1+")");}}function g(){for(var e,i=0,o=Se.customBuildings;i<o.length;i++)e=o[i],n(e,r(e));for(var t,s=0,a=Se.customUpgrades;s<a.length;s++)t=a[s],n(t,c(t));for(var d,p=0,m=Se.customAchievements;p<m.length;p++)d=m[p],n(d,u(d))}function k(){for(var e,i=0,n=Se.customBuildings;i<n.length;i++)e=n[i],a(e);for(var o,t=0,s=Se.customUpgrades;t<s.length;t++)o=s[t],d(o);for(var r,c=0,u=Se.customAchievements;c<u.length;c++)r=u[c],p(r)}function b(e){return!("object"!=typeof e)&&null!==e&&!!(t(e,"saveVer")&&"number"==typeof e.saveVer)&&!(1<e.saveVer)&&!!(0!==e.saveVer||t(e,"exists"))&&!!t(e,"mods")&&!("{}"!==JSON.stringify(e.mods))&&!!t(e,"foreign")&&!!function(n){if("object"!=typeof n)return!1;if(null===n)return!1;if(!t(n,"buildings"))return!1;if("object"!=typeof n.buildings)return!1;for(var o in n.buildings){var s=n.buildings[o];if("object"!=typeof s)return!1;for(var r in R)if(typeof R[r]!=typeof s[r])return!1}if(1<=e.saveVer){if(!t(n,"upgrades"))return!1;if("object"!=typeof n.upgrades)return!1;for(var o in n.upgrades){var a=n.upgrades[o];if("object"!=typeof a)return!1;for(var r in H)if(typeof H[r]!=typeof a[r])return!1}if(!t(n,"achievements"))return!1;if("object"!=typeof n.achievements)return!1;for(var o in n.achievements){var c=n.achievements[o];if("object"!=typeof c)return!1;for(var r in V)if(typeof V[r]!=typeof c[r])return!1}}return!0}(e.foreign)}function h(e){var i;try{i=JSON.parse(e)}catch(n){""!==e&&console.warn("CPPKIES: Found invalid save, creating new one..."),s(),i=D}b(i)?i.saveVer===1?Se.save=D=i:(console.warn("CPPKIES: Found old save, migrating to a new one..."),m(i)):(console.warn("CPPKIES: Found invalid save, creating new one..."),s()),g()}function f(){return k(),JSON.stringify(D)}function v(e,i){function n(){this.constructor=e}Y(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function C(e,i,n,o){return new(n||(n=Promise))(function(t,s){function r(e){try{c(o.next(e))}catch(i){s(i)}}function a(e){try{c(o["throw"](e))}catch(i){s(i)}}function c(e){e.done?t(e.value):new n(function(i){i(e.value)}).then(r,a)}c((o=o.apply(e,i||[])).next())})}function y(e,i){function n(e){return function(i){return o([e,i])}}function o(n){if(s)throw new TypeError("Generator is already executing.");for(;d;)try{if(s=1,r&&(a=2&n[0]?r["return"]:n[0]?r["throw"]||((a=r["return"])&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch((r=0,a)&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return d.label++,{value:n[1],done:!1};case 5:d.label++,r=n[1],n=[0];continue;case 7:n=d.ops.pop(),d.trys.pop();continue;default:if((a=d.trys,!(a=0<a.length&&a[a.length-1]))&&(6===n[0]||2===n[0])){d=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){d.label=n[1];break}if(6===n[0]&&d.label<a[1]){d.label=a[1],a=n;break}if(a&&d.label<a[2]){d.label=a[2],d.ops.push(n);break}a[2]&&d.ops.pop(),d.trys.pop();continue;}n=i.call(e,d)}catch(i){n=[6,i],r=0}finally{s=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var s,r,a,c,d={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c}function S(){for(var e=0,n=0,o=arguments.length;n<o;n++)e+=arguments[n].length;for(var t=Array(e),r=0,n=0;n<o;n++)for(var c=arguments[n],a=0,d=c.length;a<d;a++,r++)t[r]=c[a];return t}function j(e,i){W[e]=i}function O(e){if(X.includes(e))throw new Error("Recursive alias");return(X.push(e),e in W)?O(W[e]):(X=[],e)}function L(e){return new Promise(function(i){var n=new Image;n.addEventListener("load",function(){i(n)}),n.crossOrigin="Anonymous",n.src=e})}function P(e){return new Promise(function(i){e.canvas.toBlob(function(e){i(URL.createObjectURL(e))})})}function w(e,n,o,t,s,r){return new Promise(function(i){o[0]instanceof Array||(o=[o]),o=o;var a={};for(var c in o)for(var d in o[c])if(o[c][d]){if(o[c][d]=o[c][d].toString().toLowerCase(),!(o[c][d]in n))throw new Error("Invalid icon name");a[o[c][d]]=[parseInt(d),parseInt(c)]}var u=document.createElement("canvas").getContext("2d"),p=new Image;p.addEventListener("load",function(){for(var e in u.canvas.width=s[0],u.canvas.height=s[1],a)u.drawImage(p,a[e][0]*t[0],a[e][1]*t[1],t[0],t[1],n[e][0]*t[0],n[e][1]*t[1],t[0],t[1]);var o,c=function(){P(u).then(i)};r&&(o=r(u)),o instanceof Promise?o.then(c):c()}),p.crossOrigin="Anonymous",p.src=e})}function T(e){var n=new N,o=[new F("tooltip",function(){e.tooltip=i(i(e.tooltip,"return","let tempRet = ","replace"),null,"\n//Cppkies injection\n\t\t\t\treturn Cppkies.buildingHooks[this.name].emit(\"tooltip\", tempRet)","after")}),new F("buy",function(){e.buy=i(e.buy,null,"\n//Cppkies injection\n\t\t\t\tif(success) {\n\t\t\t\t\tCppkies.buildingHooks[this.name].emit(\"buy\")\n\t\t\t\t}","after")})];o.forEach(function(e){var i;null===(i=e.func)||void 0===i?void 0:i.call(e)}),Se.hooks.on("buildingCps",function(i){return{building:i.building,cps:Game.Objects[i.building]===e?n.emit("cps",i.cps):i.cps}}),Z[e.name]=n}function I(){for(var e,i=0,n=Game.ObjectsById;i<n.length;i++)e=n[i],Z[e.name]||T(e)}function G(e){return"fortune"===e.tier}function U(e){for(var n,o=1,t=1;t<=e;t++)o+=null!==(n=de[t])&&void 0!==n?n:de["default"];return 9*E(10,o)}function _(){Se.hooks.on("getIcon",function(e){var i=e.icon,n=e.type,o=e.tier;return Se.customTiers.forEach(function(e){e.keyName===o.toString()&&e.iconLink&&(i[2]=e.iconLink)}),{icon:i,type:n,tier:o}}),Se.hooks.on("getIcon",function(e){var i=e.icon,n=e.type,o=e.tier;return Se.customBuildings.forEach(function(e){e.name===n&&e.iconLink&&(i[2]=e.iconLink)}),{icon:i,tier:o,type:n}})}var q,N=function(){function e(){this._events={}}return e.prototype.on=function(e,i){this._events[e]?this._events[e].push(i):this._events[e]=[i]},e.prototype.once=function(e,i){var n=this;this.on(e,function(o){return n.off(e,i),i(o)})},e.prototype.off=function(e,i){this._events[e].splice(this._events[e].indexOf(i),1)},e.prototype.emit=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=i[0];this._events[e]||(this._events[e]=[]);for(var t,s=0,r=this._events[e];s<r.length;s++)t=r[s],o=t(o);return o},e.prototype.constEmit=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this._events[e]||(this._events[e]=[]);for(var o,t=0,s=this._events[e];t<s.length;t++)o=s[t],o(i[0])},e}(),F=function(){return function(e,i){this.value=e,this.func=i}}(),R={amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""},H={bought:!1,unlocked:!1},V={won:!1},K={buildings:{},upgrades:{},achievements:{}},D={mods:{},foreign:K,saveVer:1},Y=function(e,i){return Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},Y(e,i)},W={},X=[],$={},z={"3d":[0,21],milestone1:[0,22],milestone2:[0,23],milestone3:[0,24],krumblor:[0,25],level1:[0,26],level2:[0,27]},J={},Q={research:[9,0],cookie:[10,0],mouse:[11,0],multicursor:[12,0],kitten:[18,0]},Z={},ee=[],ie=function(e){function i(n,o,t,s,a,c,d,u,p,m){var g=this;0!==s[1]&&console.warn("All icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=relink-column"),0!==a[0]&&console.warn("All big icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=big-icons"),g=e.call(this,n,o,t,a[1],s[0],c,0,d,u)||this,ee.push(g),Z[n]||T(g);var k=function(e){if(0>=parseInt(e))return"continue";var i=Game.ObjectsById[e];if(i.canvas=l("rowCanvas"+e),!i.canvas)return"continue";if(i.ctx=i.canvas.getContext("2d"),i.canvas.addEventListener("mouseover",function(){i.mouseOn=!0}),i.canvas.addEventListener("mouseout",function(){i.mouseOn=!1}),i.canvas.addEventListener("mousemove",function(n){var e=i.canvas.getBoundingClientRect();i.mousePos[0]=n.pageX-e.left,i.mousePos[1]=n.pageY-e.top}),i.minigame&&i.minigameLoaded){var n=i.minigame.save();i.minigame.launch(),i.minigame.load(n)}};for(var b in Game.ObjectsById)k(b);g.buildingLink=a[2]||Se.buildingLink+"",g.iconLink=O(s[2]||Se.iconLink+""),p&&(Game.foolObjects[n]=p),m&&(Game.goldenCookieBuildingBuffs[n]=m),g.iconLink&&Z[g.name].on("tooltip",function(e){return g.locked?e:e.replace("background-position","background-image:url("+g.iconLink+");background-position")}),Game.BuildStore(),g.buildingLink&&Se.hooks.on("buildStore",function(){l("productIcon"+g.id).style.backgroundImage="url("+g.buildingLink+")",l("productIconOff"+g.id).style.backgroundImage="url("+g.buildingLink+")"}),Game.BuildStore(),g.canvas=l("rowCanvas"+g.id),g.ctx=g.canvas.getContext("2d"),g.pics=[];var h=document.createElement("div");h.className="tinyProductIcon",h.id="mutedProduct"+g.id,h.style.display="none",g.buildingLink&&(h.style.backgroundImage="url("+g.buildingLink+")"),h.style.backgroundPositionX="-"+s[0]+"px",h.style.backgroundPositionY="-"+s[1]+"px",h.addEventListener("click",function(){g.mute(0),window.PlaySound(g.muted?"snd/clickOff.mp3":"snd/clickOn.mp3")}),window.AddEvent(g.canvas,"mouseover",function(){g.mouseOn=!0}),window.AddEvent(g.canvas,"mouseout",function(){g.mouseOn=!1}),g.canvas.addEventListener("mousemove",function(i){var e=g.canvas.getBoundingClientRect();g.mousePos[0]=i.pageX-e.left,g.mousePos[1]=i.pageY-e.top}),l("buildingsMute").appendChild(h);var f=r(g);for(var b in f)g[b]=f[b];return Game.recalculateGains=1,g}return v(i,e),i}(Game.Object),ne=[],oe=function(e){function i(n,o,t,s,r){void 0===r&&(r=function(){});var a=this;s[2]||(s[2]=Se.iconLink+""),s[2]=O(s[2]),a=e.call(this,n,"function"==typeof o?"":o,"function"==typeof t?0:t,"function"==typeof s?[0,0]:s,r)||this,"function"==typeof o&&(a.descFunc=o),"function"==typeof t&&(a.priceFunc=t),"function"==typeof s&&(a.iconFunction=s),ne.push(a);var d=c(a);for(var u in d)a[u]=d[u];return a}return v(i,e),i}(Game.Upgrade),te=function(e){function i(i,n,o,t,s,r,a){void 0===r&&(r=["Legacy"]),void 0===a&&(a=function(){});var c=e.call(this,i,n,o,t,a)||this;return c.pool="prestige",c.posX=s[0],c.posY=s[1],c.parents=r.map(function(e){return Game.Upgrades[e]||Game.UpgradesById[e]}),Game.PrestigeUpgrades.push(c),Game.UpgradePositions[c.id]=s,c}return v(i,e),i}(oe),se=function(e){function i(i,n,t,s){var r=this;return"string"==typeof t&&(t=Game.Objects[t]),r=e.call(this,i,o(t.plural)+" are <b>twice</b> as efficient.<q>"+n+"</q>",t.basePrice*Game.Tiers[s.toString()].price,Game.GetIcon(t.name,s))||this,Game.SetTier(t.name,s),r.buildingTie1=t,G(r)&&(r.order=19e3,t.fortune=r),isNaN(parseInt(s.toString()))||(s=parseInt(s.toString())),"number"==typeof s&&(r.order=100*(t.id+1)+r.id/1e3,r.order-=75*x(0,M(t.id-4,3)),8<=t.id&&(r.order-=75)),"fortune"===s&&Game.Tiers[s.toString()].upgrades.push(r),r}return v(i,e),i}(oe),re=function(e){function i(i,n,t,s){var r=this;"string"==typeof t&&(t=Game.Objects[t]);var a=t.id-1;return 1===a?a="grandma":a+=" grandmas",r=e.call(this,i,"Grandmas are <b>twice</b> as efficient."+o(t.plural)+" gain <b>+1% CpS</b> per "+a+".<q>"+n+"</q>",t.basePrice*Game.Tiers[2].price,[10,9],Game.Objects.Grandma.redraw)||this,t.grandma=r,r.buildingTie=t,r.order=250+5*(t.id/12),Game.GrandmaSynergies.push(r.name),s&&Se.hooks.on("grandmaPic",function(e){return r.bought?S(e,[s]):e}),r}return v(i,e),i}(oe),ae=function(e){function i(i,n,t,s,r){var a=this;return"string"==typeof t&&(t=Game.Objects[t]),"string"==typeof s&&(s=Game.Objects[s]),a=e.call(this,i,o(t.plural)+" gain <b>+5% CpS</b> per "+s.name.toLowerCase()+".<br>"+o(s.plural)+" gain <b>+0.1% CpS</b> per \n\t\t\t"+t.name.toLowerCase()+".<q>"+n+"</q>",(10*t.basePrice+1*s.basePrice)*Game.Tiers[r].price,Game.GetIcon(t.name,r))||this,a.tier=r,a.buildingTie1=t,a.buildingTie2=s,a.order=5e3+a.id/1e3,t.synergies.push(a),s.synergies.push(a),Game.Tiers[r.toString()].upgrades.push(a),a}return v(i,e),i}(oe),ce=[5,7,8,9,10],le=function(e){function i(i,n,o,t){void 0===t&&(t=20);var s=this,r=Game.Objects.Cursor,a=parseInt(o.toString());return s=e.call(this,i,"Multiplies the gain from Thousand fingers by <b>"+t+"</b>.<q>"+n+"</q>",Game.Tiers[o.toString()].special||isNaN(a)?r.basePrice*Game.Tiers[o.toString()].price:E(10,ce[M(a-4,ce.length-1)]+3*x(a-8,0)),Game.GetIcon(r.name,o))||this,s.tier=o,s.pool="",s.order=100+s.id/1e3,Se.on("cursorFingerMult",function(e){return s.bought?e*t:e}),Game.Tiers[o.toString()].special||isNaN(a)||Se.buildingHooks.Cursor.on("buy",function(){r.amount>=(4===a?25:50*(a-4))&&Game.Unlock(s.name)}),"fortune"===o&&Game.Tiers[o.toString()].upgrades.push(s),s}return v(i,e),i}(oe),de={1:5,2:4,4:4,default:3},ue=[.1,.125,.15,.175,.2,.2,.2,.2,.2,.175,.15,.125,.115],pe=function(e){function i(i,n,o,t,s,r){void 0===t&&(t=Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString()))?null:ue[(parseInt(o.toString())-1)%(ue.length-1)]),void 0===r&&(r=Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString()))?null:1===o?.5:o-1);var a=e.call(this,i,"You gain <b>more CpS</b> the more milk you have.<q>"+n+"</q>",Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString()))?null!==s&&void 0!==s?s:0:U(o),Game.GetIcon("Kitten",o))||this;return a.tier=o,a.kitten=!0,a.pool="",null===t&&console.warn("Please make sure to specify the power if the kitten tier is special"),(Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString())))&&void 0===s&&console.warn("Please make sure to specify the cost if the kitten tier is special"),null!==r&&Se.on("logic",function(){Game.milkProgress>=r&&Game.Unlock(a.name)}),a.order=2e4+a.id/1e3,null!==t&&Se.on("rawCpsMult",function(e){var i=a.bought?1+Game.milkProgress*t*Se.hiddenMilkMult:1;return Game.cookiesMultByType.kittens*=i,e*i}),Game.UpgradesByPool.kitten.push(a),"fortune"===o&&Game.Tiers[o.toString()].upgrades.push(a),a}return v(i,e),i}(oe),me=function(e){function i(i,n,o,t){void 0===t&&(t=1);var s=e.call(this,i,"Clicking gains <b>+"+t+"% of your CpS</b>.<q>"+n+"</q>",1,Game.GetIcon("Mouse",o))||this;s.tier=o,s.pool="";var r=parseInt(o.toString());return s.order=150+s.id/1e3,Se.on("cpcAdd",function(e){return s.bought?e+Game.cookiesPs*t/100:e}),Game.Tiers[o.toString()].special||isNaN(r)||Se.on("check",function(){Game.handmadeCookies>=E(10,1+2*r)&&Game.Unlock(s.name)}),"fortune"===o&&Game.Tiers[o.toString()].upgrades.push(s),s}return v(i,e),i}(oe),ge=function(e){function i(i,n,o,t,s,r,a){var c=e.call(this,i,"Cookie production multiplier <b>+"+Beautify("function"==typeof s?s():s,1)+"%</b>.<q>"+n+"</q>",o,t)||this;return c.power=s,c.pool="cookie",c.order=(null!==a&&void 0!==a?a:10020)+c.id/1e3,c.unlockAt={name:i,cookies:("function"==typeof o?o():o)/20,require:null===r||void 0===r?void 0:r.require,season:null===r||void 0===r?void 0:r.season,locked:null===r||void 0===r?void 0:r.locked},Game.UnlockAt.push(c.unlockAt),Game.UpgradesByPool.cookie.push(c),Game.cookieUpgrades.push(c),c}return v(i,e),i}(oe),ke=[],be=function(){return function(e,i,n,o,t,s,r,a,c){void 0===o&&(o=!1),void 0===t&&(t="auto"),void 0===s&&(s=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===c&&(c="auto"),this.name=e,this.color=n,this.upgrades=[],this.special=o,this.keyName="auto"===c?o?e:(Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length+1).toString():c,null===s&&(this.unlock=-1),"number"==typeof s&&(this.unlock=s),(!1===o&&null===s||"auto"===s)&&(this.unlock=Game.Tiers[parseInt(this.keyName)-1].unlock+50),"number"==typeof r&&(this.achievUnlock=r),(!1===o&&null===r||"auto"===r)&&(this.achievUnlock=Game.Tiers[parseInt(this.keyName)-1].achievUnlock+50),a&&(this.req=a),this.price="auto"===t?1e8*Game.Tiers[Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length.toString()].price:t,this.iconRow=i[1],this.iconLink=O(i[2]||Se.iconLink+""),Game.Tiers[this.keyName]=this,ke.push(this)}}(),he=[],fe=function(e){function i(i,o,t){var s=this;return t[2]||(t[2]=Se.iconLink+""),t[2]=O(t[2]),s=e.call(this,i,o,t)||this,n(s,u(s)),he.push(s),s}return v(i,e),i}(Game.Achievement),ve=function(e){function i(i,n,o,t){void 0===t&&(t=E(10,B(1.5*Game.BankAchievements.length+2)));var s=e.call(this,i,"Bake <b>"+toFixed(t)+"</b> cookie"+(1===A(t)?"":"s")+" in one ascension."+(o?"<q>"+o+"</q>":""),n)||this;return s.treshold=t,s.order=100+.01*Game.BankAchievements.length,Game.BankAchievements.push(s),s}return v(i,e),i}(fe),Ce=function(e){function i(i,n,o,t){void 0===t&&(t=E(10,B(1.2*Game.BankAchievements.length)));var s=e.call(this,i,"Bake <b>"+toFixed(t)+"</b> cookie"+(1===A(t)?"":"s")+" per second."+(o?"<q>"+o+"</q>":""),n)||this;return s.treshold=t,s.order=200+.01*Game.CpsAchievements.length,Game.CpsAchievements.push(s),s}return v(i,e),i}(fe),ye=function(e){function i(i,n,o,t){var s=this,r="object"==typeof o?o:Game.Objects[o],a=null,c=-1;if(0===r.id){switch(t){case"cursor2":a=[0,6],c=2;break;case"cursor50":a=[1,6],c=50;break;default:if(0>=Game.Tiers[t.toString()].achievUnlock){console.warn("Tier has invalid unlock amount");break}c="1"===t.toString()?1:2*Game.Tiers[t.toString()].achievUnlock;}Se.buildingHooks.Cursor.on("buy",function(){Game.Objects.Cursor.amount>=c&&Game.Win(s.name)})}else c=Game.Tiers[t.toString()].achievUnlock;return s=e.call(this,i,"Have <b>"+c+"</b> "+(1===A(c)?r.single:r.plural)+"."+(n?"<q>"+n+"</q>":""),[0,7])||this,Game.SetTier(r.name,t),s.icon=a?a:Game.GetIcon(r.name,t),r.tieredAchievs[t]=s,s.buildingTie=r,"number"==typeof t&&(s.order=1e3+100*r.id+s.id/1e3,s.order-=75*x(0,M(r.id-4,3)),8<=r.id&&(s.order-=75),0===r.id&&(s.order+=50)),s}return v(i,e),i}(fe),Se={hooks:null,on:null,hiddenMilkMult:1,iconLink:"",buildingLink:"",buildingHooks:Z,buildingHooksById:[],hookAllBuildings:I,customBuildings:ee,customUpgrades:ne,customTiers:ke,save:D,onLoad:[],Building:ie,Upgrade:oe,TieredUpgrade:se,Tier:be,HeavenlyUpgrade:te,GrandmaSynergy:re,SynergyUpgrade:ae,CursorUpgrade:le,KittenUpgrade:pe,MouseUpgrade:me,CookieUpgrade:ge,Achievement:fe,CpsAchievement:Ce,BankAchievement:ve,TieredAchievement:ye,customAchievements:he,injectCode:i,DEFAULT_ONBUY:function(){Game.UnlockTiered(this),this.amount>=Game.SpecialGrandmaUnlock&&0<Game.Objects.Grandma.amount&&this.grandma&&Game.Unlock(this.grandma.name)},DEFAULT_CPS:function(e){return Game.GetTieredCpsMult(e)*Game.magicCpS(e.name)*e.baseCps},icons:{relinkColumn:function(e,n,o,t){return void 0===t&&(t=!1),C(this,void 0,void 0,function(){var s,r,r,a,c;return y(this,function(i){switch(i.label){case 0:for(r in void 0===o&&(!$[e]&&($[e]=0),o=$[e]++),s={},z)s[r]=[o,z[r][1]];for(r in Game.Tiers)s[Game.Tiers[r].name.toLowerCase()]=s[r.toString()]=[o,Game.Tiers[r].iconRow];return a=j,c=[e],[4,w(t?O(e):e,s,n,[48,48],[48*(o+1),48*(Object.values(s).reduce(function(e,i){return x(e,i[1])},-Infinity)+1)],function(i){return new Promise(function(n){if(O(e)!==e){var o=new Image;o.addEventListener("load",function(){i.drawImage(o,0,0),n()}),o.src=O(e),o.crossOrigin="Anonymous"}else n()})})];case 1:return a.apply(void 0,c.concat([i.sent()])),[2];}})})},relinkRow:function(e,n,o,t){return void 0===t&&(t=!1),C(this,void 0,void 0,function(){var s,r,r,a,c;return y(this,function(i){switch(i.label){case 0:for(r in void 0===o&&(!J[e]&&(J[e]=0),o=J[e]++),s={},Q)s[r]=[Q[r][0],o];for(r in Game.ObjectsById)s[Game.ObjectsById[r].single.toLowerCase()]=s[r]=[Game.ObjectsById[r].iconColumn,o];return a=j,c=[e],[4,w(t?O(e):e,s,n,[48,48],[48*(Object.values(s).reduce(function(e,i){return x(e,i[0])},-Infinity)+1),48*(o+1)],function(i){return new Promise(function(n){if(O(e)!==e){var o=new Image;o.addEventListener("load",function(){i.drawImage(o,0,0),n()}),o.src=O(e),o.crossOrigin="Anonymous"}else n()})})];case 1:return a.apply(void 0,c.concat([i.sent()])),[2];}})})},patchIconsheet:function(e,i,n){var o;return void 0===n&&(n=!0),C(this,void 0,void 0,function(){var t,s,r,a,c,d,u,p,m,g,k,b,h,f,v;return y(this,function(C){switch(C.label){case 0:return t=document.createElement("canvas").getContext("2d"),[4,L(n?O(e):e)];case 1:for(s=C.sent(),r=[s.width,s.height],(a=0,c=i);a<c.length;a++)d=c[a],48*d[0][0]>r[0]&&(r[0]=48*d[0][0]),48*d[0][1]>r[1]&&(r[1]=48*d[0][1]);t.canvas.width=r[0],t.canvas.height=r[1],t.drawImage(s,0,0),u={},p=0,m=i,C.label=2;case 2:return p<m.length?(g=m[p],k=O((null!==(o=g[1][2])&&void 0!==o?o:Se.iconLink)||"img/icons.png"),!!u[k])?[3,4]:(b=u,h=k,[4,L(k)]):[3,6];case 3:b[h]=C.sent(),C.label=4;case 4:t.clearRect(48*g[0][0],48*g[0][1],48,48),t.drawImage(u[k],48*g[1][0],48*g[1][1],48,48,48*g[0][0],48*g[0][1],48,48),C.label=5;case 5:return p++,[3,2];case 6:return f=j,v=[e],[4,P(t)];case 7:return f.apply(void 0,v.concat([C.sent()])),[2];}})})}}};window.Cppkies?q=window.Cppkies:(q=Se,window.Cppkies=q,function(){return new Promise(function(e){var n=new N,o=[new F("customMenu",function(){Game.UpdateMenu=i(Game.UpdateMenu,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tswitch (Game.onMenu) {\n\t\t\t\t\t\tcase \"prefs\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"optionsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"stats\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"statsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"logMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tCppkies.hooks.emit(\"menu\")\n\t\t\t\t\t","before")}),new F("preSave",function(){Game.WriteSave=i(Game.WriteSave,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"preSave\")\n\t\t\t\t\t","before")}),new F("reset",function(){Game.Reset=i(Game.Reset,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"reset\", hard)\n\t\t\t\t\t","before")}),new F("getIcon",function(){Game.GetIcon=i(Game.GetIcon,"return [col,Game.Tiers[tier].iconRow];","\n\t\t\t\t\t// Cppkies Injection\n\t\t\t\t\treturn Cppkies.hooks.emit(\"getIcon\", { icon: [col, Game.Tiers[tier].iconRow], tier: tier, type: type }).icon","replace")}),new F("buildStore",function(){Game.BuildStore=i(Game.BuildStore,null,";\nCppkies.hooks.emit(\"buildStore\")","after")}),new F("grandmaPic",function(){Game.Objects.Grandma.art.pic=i(Game.Objects.Grandma.art.pic,"return choose(list)+'.png'","// Cppkies injection\n\t\t\t\t\tlist = Cppkies.hooks.emit(\"grandmaPic\", list)\n\t\t\t\t\t","before")}),new F("cps",function(){Game.CalculateGains=i(Game.CalculateGains,"var rawCookiesPs=Game.cookiesPs*mult;","// Cppkies injection\n\t\t\t\t\tGame.cookiesPs = Cppkies.hooks.emit(\"rawCps\", Game.cookiesPs);\n\t\t\t\t\tmult = Cppkies.hooks.emit(\"rawCpsMult\", mult);\n","before"),Game.CalculateGains=i(Game.CalculateGains,"Game.cookiesPs=Game.runModHookOnValue('cps',Game.cookiesPs);","\n// Cppkies injection\nmult = Cppkies.hooks.emit(\"cpsMult\", mult);\nGame.cookiesPs = Cppkies.hooks.emit(\"cps\", Game.cookiesPs);\n","before")}),new F("cursorFingerMult",function(){Game.Objects.Cursor.cps=i(Game.Objects.Cursor.cps,"var mult=1;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add)\n;","before")}),new F("cpc",function(){Game.mouseCps=i(Game.mouseCps,"var num=0;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add)\n;","before"),Game.mouseCps=i(Game.mouseCps,"out=Game.runModHookOnValue('cookiesPerClick',out);","// Cppkies injection\nout = Cppkies.hooks.emit(\"cpc\", out)\n;","before"),Game.mouseCps=i(Game.mouseCps,"var out","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cpcAdd\", add)\n;","before")}),new F("buildingCps",function(){Game.CalculateGains=i(Game.CalculateGains,"me.storedTotalCps=me.amount*me.storedCps;","// Cppkies injection (internal, do not use)\nme.storedCps = Cppkies.hooks.emit(\"buildingCps\", { building: i, cps: me.storedCps }).cps;\n","before")})];o.forEach(function(e){var i;null===(i=e.func)||void 0===i?void 0:i.call(e)}),Game.Loader.Load=i(Game.Loader.Load,"img.src=this.domain","\n\t\t\t// Cppkies injection\n\t\t\timg.src = (assets[i].indexOf('http') !== -1 ? \"\" : this.domain)\n","replace"),Game.Objects.Cursor.buyFunction=i(Game.Objects.Cursor.buyFunction,"Game.Unlock('Octillion fingers');","\n \t\t\t// Cppkies injection\n\t\t\tfor(const i in this.tieredUpgrades) {\n\t\t\t\tif (isNaN(parseInt(i))) continue\n\t\t\t\tif (this.amount >= Game.Tiers[this.tieredUpgrades[i].tier].unlock - 50) this.tieredUpgrades[i].unlock()\n\t\t\t}\n","after"),Game.Object=i(Game.Object,"Game.ObjectsN++","\n// Cppkies injection\nCppkies.hookAllBuildings();\n","after"),Game.CalculateGains=i(Game.CalculateGains,"var catMult=1;","// Cppkies injection\n\t\t\tCppkies.hiddenMilkMult = milkMult;\n","before"),Game.GetIcon=i(Game.GetIcon,"col=18;","else if (type === \"Mouse\") col = 11;","after"),Game.registerHook("logic",function(){return n.emit("logic")}),Game.registerHook("check",function(){return n.emit("check")}),e(n)})}().then(function(e){q.hooks=e,q.on=e.on.bind(e),Game.Notify("Cppkies loaded!","",[32,17],1.5),Game.modSaveData.cppkies||(Game.modSaveData.cppkies="{}"),Game.registerMod("cppkies",{save:f,load:h}),Game.Win("Third-party"),I(),Se.onLoad.forEach(function(e){return e()}),Se.onLoad=new Proxy(Se.onLoad,{set:function(e,i,n){return"length"!==i&&n(),!0}}),window.CPPKIES_ONLOAD||(window.CPPKIES_ONLOAD=[]),window.CPPKIES_ONLOAD.forEach(function(e){return e()}),window.CPPKIES_ONLOAD=new Proxy(Se.onLoad,{set:function(e,i,n){return"length"!==i&&n(),!0}}),_()}));var je=q;return je});
//# sourceMappingURL=index.js.map
