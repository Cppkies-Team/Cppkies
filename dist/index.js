(function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e=e||self,e.Cppkies=i())})(this,function(){'use strict';var M=Math.abs,E=Math.floor,x=Math.min,N=Math.pow,F=Math.max;function e(e){return e instanceof Function?e():e}function n(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function o(o,t,s,a,r){for(var c in void 0===r&&(r={}),r)if(!/[a-zA-Z_$][0-9a-zA-Z_$]*/.test(c))throw new Error("Invalid context variable name!");var d,u=o.toString(),p=null===t;p||(t=e(t),d="string"==typeof t?new RegExp(n(t),"g"):t),s=e(s);var m=/(\)[^{]*{)/,g=/(}?)$/;switch(p||d.test(u)||console.warn("Nothing to inject."),a){case"before":u=p?u.replace(m,"$1"+s):u.replace(d,""+s+t);break;case"replace":u=p?""+s:u.replace(d,""+s);break;case"after":u=p?u.replace(g,s+"$1"):u.replace(d,""+t+s);break;default:throw new Error("where Parameter must be \"before\", \"replace\" or \"after\"");}var k="";for(var c in r)k+="var "+c+" = globalThis.tempCtx."+c+"\n";globalThis.tempCtx=r;var b=new Function(k+"globalThis.tempCtx = null\nreturn ("+u+")")();return b.prototype=o.prototype,b}function t(e,n){for(var o in n)e[o]=n[o]}function s(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function a(e,i){return e.hasOwnProperty(i)}function r(){Le.save=K={mods:{},foreign:W,saveVer:1}}function c(e){return K.foreign.buildings[e.name]||D}function d(e){var i=e.amount,n=e.bought,o=e.free,t=e.totalCookies,s=e.level,a=e.muted,r=e.minigameSave,c=e.name;K.foreign.buildings[c]={amount:i,bought:n,free:o,totalCookies:t,level:s,muted:a,minigameSave:r}}function u(e){return K.foreign.upgrades[e.name]||Y}function p(e){K.foreign.upgrades[e.name]={unlocked:!!e.unlocked,bought:!!e.bought}}function m(e){return K.foreign.achievements[e.name]||X}function g(e){K.foreign.achievements[e.name]={won:!!e.won}}function k(e){switch(r(),e.saveVer){case 0:K.foreign.buildings=e.foreign.buildings;break;default:throw new Error("Invalid save version "+K.saveVer+" (current version is "+1+")");}}function b(){for(var e,i=0,n=Le.customBuildings;i<n.length;i++)e=n[i],t(e,c(e));for(var o,s=0,a=Le.customUpgrades;s<a.length;s++)o=a[s],t(o,u(o));for(var r,d=0,p=Le.customAchievements;d<p.length;d++)r=p[d],t(r,m(r))}function h(){for(var e,i=0,n=Le.customBuildings;i<n.length;i++)e=n[i],d(e);for(var o,t=0,s=Le.customUpgrades;t<s.length;t++)o=s[t],p(o);for(var a,r=0,c=Le.customAchievements;r<c.length;r++)a=c[r],g(a)}function f(e){if(null===e)return!1;if("object"!=typeof e)return!1;if(!a(e,"saveVer")||"number"!=typeof e.saveVer||1<e.saveVer)return!1;if(0===e.saveVer&&!a(e,"exists"))return!1;return!!a(e,"mods")&&!("{}"!==JSON.stringify(e.mods))&&!!a(e,"foreign")&&!!function(n){if("object"!=typeof n)return!1;if(!a(n,"buildings"))return!1;if("object"!=typeof n.buildings)return!1;for(var o in n.buildings){var t=n.buildings[o];if("object"!=typeof t)return!1;for(var s in D)if(typeof D[s]!=typeof t[s])return!1}if(1<=e.saveVer){if(!a(n,"upgrades"))return!1;if("object"!=typeof n.upgrades)return!1;for(var o in n.upgrades){var r=n.upgrades[o];if("object"!=typeof r)return!1;for(var s in Y)if(typeof Y[s]!=typeof r[s])return!1}if(!a(n,"achievements"))return!1;if("object"!=typeof n.achievements)return!1;for(var o in n.achievements){var c=n.achievements[o];if("object"!=typeof c)return!1;for(var s in X)if(typeof X[s]!=typeof c[s])return!1}}return!0}(e.foreign)}function v(e){var i;try{i=JSON.parse(e)}catch(n){""!==e&&console.warn("CPPKIES: Found invalid save, creating new one..."),r(),i=K}f(i)?i.saveVer===1?Le.save=K=i:(console.warn("CPPKIES: Found old save, migrating to a new one..."),k(i)):(console.warn("CPPKIES: Found invalid save, creating new one..."),r()),b()}function C(){return h(),JSON.stringify(K)}function y(e,i){function n(){this.constructor=e}$(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function S(e,i,n,o){return new(n||(n=Promise))(function(t,s){function a(e){try{c(o.next(e))}catch(i){s(i)}}function r(e){try{c(o["throw"](e))}catch(i){s(i)}}function c(e){e.done?t(e.value):new n(function(i){i(e.value)}).then(a,r)}c((o=o.apply(e,i||[])).next())})}function j(e,i){function n(e){return function(i){return o([e,i])}}function o(n){if(s)throw new TypeError("Generator is already executing.");for(;d;)try{if(s=1,a&&(r=2&n[0]?a["return"]:n[0]?a["throw"]||((r=a["return"])&&r.call(a),0):a.next)&&!(r=r.call(a,n[1])).done)return r;switch((a=0,r)&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return d.label++,{value:n[1],done:!1};case 5:d.label++,a=n[1],n=[0];continue;case 7:n=d.ops.pop(),d.trys.pop();continue;default:if((r=d.trys,!(r=0<r.length&&r[r.length-1]))&&(6===n[0]||2===n[0])){d=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){d.label=n[1];break}if(6===n[0]&&d.label<r[1]){d.label=r[1],r=n;break}if(r&&d.label<r[2]){d.label=r[2],d.ops.push(n);break}r[2]&&d.ops.pop(),d.trys.pop();continue;}n=i.call(e,d)}catch(i){n=[6,i],a=0}finally{s=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var s,a,r,c,d={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c}function L(){for(var e=0,n=0,o=arguments.length;n<o;n++)e+=arguments[n].length;for(var t=Array(e),r=0,n=0;n<o;n++)for(var c=arguments[n],a=0,d=c.length;a<d;a++,r++)t[r]=c[a];return t}function O(e,i){z[e]=i}function P(e){if(J.includes(e))throw new Error("Recursive alias");return(J.push(e),e in z)?P(z[e]):(J=[],e)}function w(e){return new Promise(function(i){var n=new Image;n.addEventListener("load",function(){i(n)}),n.crossOrigin="Anonymous",n.src=e})}function I(e){return new Promise(function(i){e.canvas.toBlob(function(e){i(URL.createObjectURL(e))})})}function T(e,n,o,t,s,a){return new Promise(function(i){o[0]instanceof Array||(o=[o]),o=o;var r={};for(var c in o)for(var d in o[c])if(o[c][d]){if(o[c][d]=o[c][d].toString().toLowerCase(),!(o[c][d]in n))throw new Error("Invalid icon name");r[o[c][d]]=[parseInt(d),parseInt(c)]}var u=document.createElement("canvas").getContext("2d"),p=new Image;p.addEventListener("load",function(){for(var e in u.canvas.width=s[0],u.canvas.height=s[1],r)u.drawImage(p,r[e][0]*t[0],r[e][1]*t[1],t[0],t[1],n[e][0]*t[0],n[e][1]*t[1],t[0],t[1]);var o,c=function(){I(u).then(i)};a&&(o=a(u)),o instanceof Promise?o.then(c):c()}),p.crossOrigin="Anonymous",p.src=e})}function G(e){var i=new V,n=[new H("tooltip",function(){e.tooltip=o(o(e.tooltip,"return","let tempRet = ","replace"),null,"\n//Cppkies injection\n\t\t\t\treturn Cppkies.buildingHooks[this.name].emit(\"tooltip\", tempRet)","after")}),new H("buy",function(){e.buy=o(e.buy,null,"\n//Cppkies injection\n\t\t\t\tif(success) {\n\t\t\t\t\tCppkies.buildingHooks[this.name].emit(\"buy\")\n\t\t\t\t}","after")})];n.forEach(function(e){null===e||void 0===e?void 0:e.func()}),Le.hooks.on("buildingCps",function(n){return{building:n.building,cps:Game.Objects[n.building]===e?i.emit("cps",n.cps):n.cps}}),ne[e.name]=i}function U(){for(var e,i=0,n=Game.ObjectsById;i<n.length;i++)e=n[i],ne[e.name]||G(e)}function _(e){return"fortune"===e.tier}function A(e){for(var n,o=1,t=1;t<=e;t++)o+=null!==(n=me[t])&&void 0!==n?n:me["default"];return 9*N(10,o)}function B(){Le.hooks.on("getIcon",function(e){var i=e.icon,n=e.type,o=e.tier;return Le.customTiers.forEach(function(e){e.keyName===o.toString()&&e.iconLink&&(i[2]=e.iconLink)}),{icon:i,type:n,tier:o}}),Le.hooks.on("getIcon",function(e){var i=e.icon,n=e.type,o=e.tier;return Le.customBuildings.forEach(function(e){e.name===n&&e.iconLink&&(i[2]=e.iconLink)}),{icon:i,tier:o,type:n}})}var R,V=function(){function e(){this._events={}}return e.prototype.on=function(e,i){this._events[e]?this._events[e].push(i):this._events[e]=[i]},e.prototype.once=function(e,i){var n=this;this.on(e,function(o){return n.off(e,i),i(o)})},e.prototype.off=function(e,i){this._events[e].splice(this._events[e].indexOf(i),1)},e.prototype.emit=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=i[0];this._events[e]||(this._events[e]=[]);for(var t,s=0,a=this._events[e];s<a.length;s++)t=a[s],o=t(o);return o},e.prototype.constEmit=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this._events[e]||(this._events[e]=[]);for(var o,t=0,s=this._events[e];t<s.length;t++)o=s[t],o(i[0])},e}(),H=function(){return function(e,i){this.value=e,this.func=i}}(),K=null,D={amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""},Y={bought:!1,unlocked:!1},X={won:!1},W={buildings:{},upgrades:{},achievements:{}},$=function(e,i){return $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},$(e,i)},z={},J=[],Q={},Z={"3d":[0,21],milestone1:[0,22],milestone2:[0,23],milestone3:[0,24],krumblor:[0,25],level1:[0,26],level2:[0,27]},ee={},ie={research:[9,0],cookie:[10,0],mouse:[11,0],multicursor:[12,0],kitten:[18,0]},ne={},oe=[],te=function(e){function i(n,o,t,s,a,r,d,u,p,m){var g=this;0!==s[1]&&console.warn("All icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=relink-column"),0!==a[0]&&console.warn("All big icon sheets must follow an order, see https://cppkies.js.org/#/CommonProblems#IconOrder?id=big-icons"),g=e.call(this,n,o,t,a[1],s[0],r,0,d,u)||this,oe.push(g),ne[n]||G(g);var k=function(e){if(0>=parseInt(e))return"continue";var i=Game.ObjectsById[e];if(i.canvas=l("rowCanvas"+e),!i.canvas)return"continue";if(i.ctx=i.canvas.getContext("2d"),i.canvas.addEventListener("mouseover",function(){i.mouseOn=!0}),i.canvas.addEventListener("mouseout",function(){i.mouseOn=!1}),i.canvas.addEventListener("mousemove",function(n){var e=i.canvas.getBoundingClientRect();i.mousePos[0]=n.pageX-e.left,i.mousePos[1]=n.pageY-e.top}),i.minigame&&i.minigameLoaded){var n=i.minigame.save();i.minigame.launch(),i.minigame.load(n)}};for(var b in Game.ObjectsById)k(b);g.buildingLink=a[2]||Le.buildingLink+"",g.iconLink=P(s[2]||Le.iconLink+""),p&&(Game.foolObjects[n]=p),m&&(Game.goldenCookieBuildingBuffs[n]=m),g.iconLink&&ne[g.name].on("tooltip",function(e){return g.locked?e:e.replace("background-position","background-image:url("+g.iconLink+");background-position")}),Game.BuildStore(),g.buildingLink&&Le.hooks.on("buildStore",function(){l("productIcon"+g.id).style.backgroundImage="url("+g.buildingLink+")",l("productIconOff"+g.id).style.backgroundImage="url("+g.buildingLink+")"}),Game.BuildStore(),g.canvas=l("rowCanvas"+g.id),g.ctx=g.canvas.getContext("2d"),g.pics=[];var h=document.createElement("div");h.className="tinyProductIcon",h.id="mutedProduct"+g.id,h.style.display="none",g.buildingLink&&(h.style.backgroundImage="url("+g.buildingLink+")"),h.style.backgroundPositionX="-"+s[0]+"px",h.style.backgroundPositionY="-"+s[1]+"px",h.addEventListener("click",function(){g.mute(0),window.PlaySound(g.muted?"snd/clickOff.mp3":"snd/clickOn.mp3")}),window.AddEvent(g.canvas,"mouseover",function(){g.mouseOn=!0}),window.AddEvent(g.canvas,"mouseout",function(){g.mouseOn=!1}),g.canvas.addEventListener("mousemove",function(i){var e=g.canvas.getBoundingClientRect();g.mousePos[0]=i.pageX-e.left,g.mousePos[1]=i.pageY-e.top}),l("buildingsMute").appendChild(h);var f=c(g);for(var b in f)g[b]=f[b];return Game.recalculateGains=1,g}return y(i,e),i}(Game.Object),se=[],ae=function(e){function i(n,o,t,s,a){void 0===a&&(a=function(){});var r=this;s[2]||(s[2]=Le.iconLink+""),s[2]=P(s[2]),r=e.call(this,n,"function"==typeof o?"":o,"function"==typeof t?0:t,"function"==typeof s?[0,0]:s,a)||this,"function"==typeof o&&(r.descFunc=o),"function"==typeof t&&(r.priceFunc=t),"function"==typeof s&&(r.iconFunction=s),se.push(r);var c=u(r);for(var d in c)r[d]=c[d];return r}return y(i,e),i}(Game.Upgrade),re=function(e){function i(i,n,o,t,s,a,r){void 0===a&&(a=["Legacy"]),void 0===r&&(r=function(){});var c=e.call(this,i,n,o,t,r)||this;return c.pool="prestige",c.posX=s[0],c.posY=s[1],c.parents=a.map(function(e){return Game.Upgrades[e]||Game.UpgradesById[e]}),Game.PrestigeUpgrades.push(c),Game.UpgradePositions[c.id]=s,c}return y(i,e),i}(ae),ce=function(e){function i(i,n,o,t){var a=this;return"string"==typeof o&&(o=Game.Objects[o]),a=e.call(this,i,s(o.plural)+" are <b>twice</b> as efficient.<q>"+n+"</q>",o.basePrice*Game.Tiers[t.toString()].price,Game.GetIcon(o.name,t))||this,Game.SetTier(o.name,t),a.buildingTie1=o,_(a)&&(a.order=19e3,o.fortune=a),isNaN(parseInt(t.toString()))||(t=parseInt(t.toString())),"number"==typeof t&&(a.order=100*(o.id+1)+a.id/1e3,a.order-=75*F(0,x(o.id-4,3)),8<=o.id&&(a.order-=75)),"fortune"===t&&Game.Tiers[t.toString()].upgrades.push(a),a}return y(i,e),i}(ae),le=function(e){function i(i,n,o,t){var a=this;"string"==typeof o&&(o=Game.Objects[o]);var r=o.id-1;return 1===r?r="grandma":r+=" grandmas",a=e.call(this,i,"Grandmas are <b>twice</b> as efficient."+s(o.plural)+" gain <b>+1% CpS</b> per "+r+".<q>"+n+"</q>",o.basePrice*Game.Tiers[2].price,[10,9],Game.Objects.Grandma.redraw)||this,o.grandma=a,a.buildingTie=o,a.order=250+5*(o.id/12),Game.GrandmaSynergies.push(a.name),t&&Le.hooks.on("grandmaPic",function(e){if(a.bought)return L(e,[t])}),a}return y(i,e),i}(ae),de=function(e){function i(i,n,o,t,a){var r=this;return"string"==typeof o&&(o=Game.Objects[o]),"string"==typeof t&&(t=Game.Objects[t]),r=e.call(this,i,s(o.plural)+" gain <b>+5% CpS</b> per "+t.name.toLowerCase()+".<br>"+s(t.plural)+" gain <b>+0.1% CpS</b> per \n\t\t\t"+o.name.toLowerCase()+".<q>"+n+"</q>",(10*o.basePrice+1*t.basePrice)*Game.Tiers[a].price,Game.GetIcon(o.name,a))||this,r.tier=a,r.buildingTie1=o,r.buildingTie2=t,r.order=5e3+r.id/1e3,o.synergies.push(r),t.synergies.push(r),Game.Tiers[a.toString()].upgrades.push(r),r}return y(i,e),i}(ae),ue=[5,7,8,9,10],pe=function(e){function i(i,n,o,t){void 0===t&&(t=20);var s=this,a=Game.Objects.Cursor,r=parseInt(o.toString());return s=e.call(this,i,"Multiplies the gain from Thousand fingers by <b>"+t+"</b>.<q>"+n+"</q>",Game.Tiers[o.toString()].special||isNaN(r)?a.basePrice*Game.Tiers[o.toString()].price:N(10,ue[x(r-4,ue.length-1)]+3*F(r-8,0)),Game.GetIcon(a.name,o))||this,s.tier=o,s.pool="",s.order=100+s.id/1e3,Le.on("cursorFingerMult",function(e){return s.bought?e*t:e}),Game.Tiers[o.toString()].special||isNaN(r)||Le.buildingHooks.Cursor.on("buy",function(){a.amount>=(4===r?25:50*(r-4))&&Game.Unlock(s.name)}),"fortune"===o&&Game.Tiers[o.toString()].upgrades.push(s),s}return y(i,e),i}(ae),me={1:5,2:4,4:4,default:3},ge=[.1,.125,.15,.175,.2,.2,.2,.2,.2,.175,.15,.125,.115],ke=function(e){function i(i,n,o,t,s,a){void 0===t&&(t=Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString()))?null:ge[(parseInt(o.toString())-1)%(ge.length-1)]),void 0===a&&(a=Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString()))?null:1===o?.5:o-1);var r=e.call(this,i,"You gain <b>more CpS</b> the more milk you have.<q>"+n+"</q>",Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString()))?null!==s&&void 0!==s?s:0:A(o),Game.GetIcon("Kitten",o))||this;return r.tier=o,r.kitten=!0,r.pool="",null===t&&console.warn("Please make sure to specify the power if the kitten tier is special"),(Game.Tiers[o.toString()].special||isNaN(parseInt(o.toString())))&&void 0===s&&console.warn("Please make sure to specify the cost if the kitten tier is special"),null!==a&&Le.on("logic",function(){Game.milkProgress>=a&&Game.Unlock(r.name)}),r.order=2e4+r.id/1e3,Le.on("rawCpsMult",function(e){var i=r.bought?1+Game.milkProgress*t*Le.hiddenMilkMult:1;return Game.cookiesMultByType.kittens*=i,e*i}),Game.UpgradesByPool.kitten.push(r),"fortune"===o&&Game.Tiers[o.toString()].upgrades.push(r),r}return y(i,e),i}(ae),be=function(e){function i(i,n,o,t){void 0===t&&(t=1);var s=e.call(this,i,"Clicking gains <b>+"+t+"% of your CpS</b>.<q>"+n+"</q>",1,Game.GetIcon("Mouse",o))||this;s.tier=o,s.pool="";var a=parseInt(o.toString());return s.order=150+s.id/1e3,Le.on("cpcAdd",function(e){return s.bought?e+Game.cookiesPs*t/100:e}),Game.Tiers[o.toString()].special||isNaN(a)||Le.on("check",function(){Game.handmadeCookies>=N(10,1+2*a)&&Game.Unlock(s.name)}),"fortune"===o&&Game.Tiers[o.toString()].upgrades.push(s),s}return y(i,e),i}(ae),he=function(e){function i(i,n,o,t,s,a,r){var c=e.call(this,i,"Cookie production multiplier <b>+"+Beautify("function"==typeof s?s():s,1)+"%</b>.<q>"+n+"</q>",o,t)||this;return c.power=s,c.pool="cookie",c.order=(null!==r&&void 0!==r?r:10020)+c.id/1e3,c.unlockAt={name:i,cookies:("function"==typeof o?o():o)/20,require:a.require,season:a.season,locked:a.locked},Game.UnlockAt.push(c.unlockAt),Game.UpgradesByPool.cookie.push(c),Game.cookieUpgrades.push(c),c}return y(i,e),i}(ae),fe=[],ve=function(){return function(e,i,n,o,t,s,a,r,c){void 0===o&&(o=!1),void 0===t&&(t="auto"),void 0===s&&(s=null),void 0===a&&(a=null),void 0===r&&(r=null),void 0===c&&(c="auto"),this.name=e,this.color=n,this.upgrades=[],this.special=o,this.keyName="auto"===c?o?e:(Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length+1).toString():c,null===s&&(this.unlock=-1),"number"==typeof s&&(this.unlock=s),(!1===o&&null===s||"auto"===s)&&(this.unlock=Game.Tiers[parseInt(this.keyName)-1].unlock+50),"number"==typeof a&&(this.achievUnlock=a),(!1===o&&null===a||"auto"===a)&&(this.achievUnlock=Game.Tiers[parseInt(this.keyName)-1].achievUnlock+50),r&&(this.req=r),this.price="auto"===t?1e8*Game.Tiers[Object.keys(Game.Tiers).filter(function(e){return!isNaN(parseInt(e))}).length.toString()].price:t,this.iconRow=i[1],this.iconLink=P(i[2]||Le.iconLink+""),Game.Tiers[this.keyName]=this,fe.push(this)}}(),Ce=[],ye=function(e){function i(i,n,o){var s=this;return o[2]||(o[2]=Le.iconLink+""),o[2]=P(o[2]),s=e.call(this,i,n,o)||this,t(s,m(s)),Ce.push(s),s}return y(i,e),i}(Game.Achievement),Se=function(e){function i(i,n,o,t){void 0===t&&(t=N(10,E(1.5*Game.BankAchievements.length+2)));var s=e.call(this,i,"Bake <b>"+toFixed(t)+"</b> cookie"+(1===M(t)?"":"s")+" in one ascension."+(o?"<q>"+o+"</q>":""),n)||this;return s.treshold=t,s.order=100+.01*Game.BankAchievements.length,Game.BankAchievements.push(s),s}return y(i,e),i}(ye),je=function(e){function i(i,n,o,t){void 0===t&&(t=N(10,E(1.2*Game.BankAchievements.length)));var s=e.call(this,i,"Bake <b>"+toFixed(t)+"</b> cookie"+(1===M(t)?"":"s")+" per second."+(o?"<q>"+o+"</q>":""),n)||this;return s.treshold=t,s.order=200+.01*Game.CpsAchievements.length,Game.CpsAchievements.push(s),s}return y(i,e),i}(ye),Le={hooks:null,on:null,hiddenMilkMult:1,iconLink:"",buildingLink:"",buildingHooks:ne,buildingHooksById:[],hookAllBuildings:U,customBuildings:oe,customUpgrades:se,customTiers:fe,save:K,onLoad:[],Building:te,Upgrade:ae,TieredUpgrade:ce,Tier:ve,HeavenlyUpgrade:re,GrandmaSynergy:le,SynergyUpgrade:de,CursorUpgrade:pe,KittenUpgrade:ke,MouseUpgrade:be,UpgradeCookie:he,Achievement:ye,CpsAchievement:je,BankAchievement:Se,customAchievements:Ce,injectCode:o,DEFAULT_ONBUY:function(){Game.UnlockTiered(this),this.amount>=Game.SpecialGrandmaUnlock&&0<Game.Objects.Grandma.amount&&this.grandma&&Game.Unlock(this.grandma.name)},DEFAULT_CPS:function(e){return Game.GetTieredCpsMult(e)*Game.magicCpS(e.name)*e.baseCps},icons:{relinkColumn:function(e,n,o,t){return void 0===t&&(t=!1),S(this,void 0,void 0,function(){var s,a,a,r,c;return j(this,function(i){switch(i.label){case 0:for(a in void 0===o&&(!Q[e]&&(Q[e]=0),o=Q[e]++),s={},Z)s[a]=[o,Z[a][1]];for(a in Game.Tiers)s[Game.Tiers[a].name.toLowerCase()]=s[a.toString()]=[o,Game.Tiers[a].iconRow];return r=O,c=[e],[4,T(t?P(e):e,s,n,[48,48],[48*(o+1),48*(Object.values(s).reduce(function(e,i){return F(e,i[1])},-Infinity)+1)],function(i){return new Promise(function(n){if(P(e)!==e){var o=new Image;o.addEventListener("load",function(){i.drawImage(o,0,0),n()}),o.src=P(e),o.crossOrigin="Anonymous"}else n()})})];case 1:return r.apply(void 0,c.concat([i.sent()])),[2];}})})},relinkRow:function(e,n,o,t){return void 0===t&&(t=!1),S(this,void 0,void 0,function(){var s,a,a,r,c;return j(this,function(i){switch(i.label){case 0:for(a in void 0===o&&(!ee[e]&&(ee[e]=0),o=ee[e]++),s={},ie)s[a]=[ie[a][0],o];for(a in Game.ObjectsById)s[Game.ObjectsById[a].single.toLowerCase()]=s[a]=[Game.ObjectsById[a].iconColumn,o];return r=O,c=[e],[4,T(t?P(e):e,s,n,[48,48],[48*(Object.values(s).reduce(function(e,i){return F(e,i[0])},-Infinity)+1),48*(o+1)],function(i){return new Promise(function(n){if(P(e)!==e){var o=new Image;o.addEventListener("load",function(){i.drawImage(o,0,0),n()}),o.src=P(e),o.crossOrigin="Anonymous"}else n()})})];case 1:return r.apply(void 0,c.concat([i.sent()])),[2];}})})},patchIconsheet:function(e,i,n){var o;return void 0===n&&(n=!0),S(this,void 0,void 0,function(){var t,s,a,r,c,d,u,p,m,g,k,b,h,f,v;return j(this,function(C){switch(C.label){case 0:return t=document.createElement("canvas").getContext("2d"),[4,w(n?P(e):e)];case 1:for(s=C.sent(),a=[s.width,s.height],(r=0,c=i);r<c.length;r++)d=c[r],48*d[0][0]>a[0]&&(a[0]=48*d[0][0]),48*d[0][1]>a[1]&&(a[1]=48*d[0][1]);t.canvas.width=a[0],t.canvas.height=a[1],t.drawImage(s,0,0),u={},p=0,m=i,C.label=2;case 2:return p<m.length?(g=m[p],k=P((null!==(o=g[1][2])&&void 0!==o?o:Le.iconLink)||"img/icons.png"),!!u[k])?[3,4]:(b=u,h=k,[4,w(k)]):[3,6];case 3:b[h]=C.sent(),C.label=4;case 4:t.clearRect(48*g[0][0],48*g[0][1],48,48),t.drawImage(u[k],48*g[1][0],48*g[1][1],48,48,48*g[0][0],48*g[0][1],48,48),C.label=5;case 5:return p++,[3,2];case 6:return f=O,v=[e],[4,I(t)];case 7:return f.apply(void 0,v.concat([C.sent()])),[2];}})})}}};window.Cppkies?R=window.Cppkies:(R=Le,function(){return new Promise(function(e){var i=new V,n=[new H("customMenu",function(){Game.UpdateMenu=o(Game.UpdateMenu,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tswitch (Game.onMenu) {\n\t\t\t\t\t\tcase \"prefs\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"optionsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"stats\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"statsMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase \"log\":\n\t\t\t\t\t\t\tCppkies.hooks.emit(\"logMenu\")\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tCppkies.hooks.emit(\"menu\")\n\t\t\t\t\t","before")}),new H("preSave",function(){Game.WriteSave=o(Game.WriteSave,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"preSave\")\n\t\t\t\t\t","before")}),new H("reset",function(){Game.Reset=o(Game.Reset,null,"\n\t\t\t\t\t// Cppkies injection\n\t\t\t\t\tCppkies.hooks.emit(\"reset\", hard)\n\t\t\t\t\t","before")}),new H("getIcon",function(){Game.GetIcon=o(Game.GetIcon,"return [col,Game.Tiers[tier].iconRow];","\n\t\t\t\t\t// Cppkies Injection\n\t\t\t\t\treturn Cppkies.hooks.emit(\"getIcon\", { icon: [col, Game.Tiers[tier].iconRow], tier: tier, type: type }).icon","replace")}),new H("buildStore",function(){Game.BuildStore=o(Game.BuildStore,null,";\nCppkies.hooks.emit(\"buildStore\")","after")}),new H("grandmaPic",function(){Game.Objects.Grandma.art.pic=o(Game.Objects.Grandma.art.pic,"return choose(list)+'.png'","// Cppkies injection\n\t\t\t\t\tlist = Cppkies.hooks.emit(\"grandmaPic\", list)\n\t\t\t\t\t","before")}),new H("cps",function(){Game.CalculateGains=o(Game.CalculateGains,"var rawCookiesPs=Game.cookiesPs*mult;","// Cppkies injection\n\t\t\t\t\tGame.cookiesPs = Cppkies.hooks.emit(\"rawCps\", Game.cookiesPs);\n\t\t\t\t\tmult = Cppkies.hooks.emit(\"rawCpsMult\", mult);\n","before"),Game.CalculateGains=o(Game.CalculateGains,"Game.cookiesPs=Game.runModHookOnValue('cps',Game.cookiesPs);","\n// Cppkies injection\nmult = Cppkies.hooks.emit(\"cpsMult\", mult);\nGame.cookiesPs = Cppkies.hooks.emit(\"cps\", Game.cookiesPs);\n","before")}),new H("cursorFingerMult",function(){Game.Objects.Cursor.cps=o(Game.Objects.Cursor.cps,"var mult=1;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add)\n;","before")}),new H("cpc",function(){Game.mouseCps=o(Game.mouseCps,"var num=0;","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cursorFingerMult\", add)\n;","before"),Game.mouseCps=o(Game.mouseCps,"out=Game.runModHookOnValue('cookiesPerClick',out);","// Cppkies injection\nout = Cppkies.hooks.emit(\"cpc\", out)\n;","before"),Game.mouseCps=o(Game.mouseCps,"var out","// Cppkies injection\nadd = Cppkies.hooks.emit(\"cpcAdd\", add)\n;","before")}),new H("buildingCps",function(){Game.CalculateGains=o(Game.CalculateGains,"me.storedTotalCps=me.amount*me.storedCps;","// Cppkies injection (internal, do not use)\nme.storedCps = Cppkies.hooks.emit(\"buildingCps\", { building: i, cps: me.storedCps }).cps;\n","before")})];n.forEach(function(e){var i;null===(i=e.func)||void 0===i?void 0:i.call(e)}),Game.Loader.Load=o(Game.Loader.Load,"img.src=this.domain","\n\t\t\t// Cppkies injection\n\t\t\timg.src = (assets[i].indexOf('http') !== -1 ? \"\" : this.domain)\n","replace"),Game.Objects.Cursor.buyFunction=o(Game.Objects.Cursor.buyFunction,"Game.Unlock('Octillion fingers');","\n \t\t\t// Cppkies injection\n\t\t\tfor(const i in this.tieredUpgrades) {\n\t\t\t\tif (isNaN(parseInt(i))) continue\n\t\t\t\tif (this.amount >= Game.Tiers[this.tieredUpgrades[i].tier].unlock - 50) this.tieredUpgrades[i].unlock()\n\t\t\t}\n","after"),Game.Object=o(Game.Object,"Game.ObjectsN++","\n// Cppkies injection\nCppkies.hookAllBuildings();\n","after"),Game.CalculateGains=o(Game.CalculateGains,"var catMult=1;","// Cppkies injection\n\t\t\tCppkies.hiddenMilkMult = milkMult;\n","before"),Game.GetIcon=o(Game.GetIcon,"col=18;","else if (type === \"Mouse\") col = 11;","after"),Game.registerHook("logic",function(){return i.emit("logic")}),Game.registerHook("check",function(){return i.emit("check")}),e(i)})}().then(function(e){R.hooks=e,R.on=e.on.bind(e),Game.Notify("Cppkies loaded!","",[32,17],1.5),Game.modSaveData.cppkies||(Game.modSaveData.cppkies="{}"),Game.registerMod("cppkies",{save:C,load:v}),Game.Win("Third-party"),U(),Le.onLoad.forEach(function(e){return e()}),Le.onLoad=new Proxy(Le.onLoad,{set:function(e,i,n){return"length"!==i&&n(),!0}}),window.CPPKIES_ONLOAD||(window.CPPKIES_ONLOAD=[]),window.CPPKIES_ONLOAD.forEach(function(e){return e()}),window.CPPKIES_ONLOAD=new Proxy(Le.onLoad,{set:function(e,i,n){return"length"!==i&&n(),!0}}),B(),window.Cppkies=R}));var Oe=R;return Oe});
//# sourceMappingURL=index.js.map
