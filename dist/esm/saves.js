import"./tslib.es6-ac47674d.js";import{customBuildings as e,customUpgrades as n,customAchievements as r,mods as a}from"./vars.js";import{applyAllProps as o,hasOwnProperty as t}from"./helpers.js";import{decompressFromUTF16 as u,compressToUTF16 as i}from"./lz-string.js";var s=Game.dragonLevels.length+0,g=3;function l(e){switch(e){case"mod":return{achievements:{},buildings:{},upgrades:{},ui:{},custom:null};case"dragon":return{level:"sync",auras:["sync","sync"]};case"achievement":return{won:!1};case"upgrade":return{bought:!1,unlocked:!1};case"building":return{amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""};default:throw new Error("Invalid fragment name!")}}function d(){return{mods:{},foreign:l("mod"),saveVer:3,dragon:l("dragon")}}var m=d();function c(){var e=d();o(m,e)}function f(e){var n=e.amount,r=e.bought,a=e.free,o=e.totalCookies,t=e.level,u=e.muted,i=e.minigameSave,s=e.name;m.foreign.buildings[s]={amount:n,bought:r,free:a,totalCookies:o,level:t,muted:u,minigameSave:i}}function v(e){return m.foreign.buildings[e.name]||l("building")}function p(e){m.foreign.upgrades[e.name]={unlocked:!!e.unlocked,bought:!!e.bought}}function h(e){return m.foreign.upgrades[e.name]||l("upgrade")}function b(e){m.foreign.achievements[e.name]={won:!!e.won}}function y(e){return m.foreign.achievements[e.name]||l("achievement")}function j(){"sync"!==m.dragon.level&&m.dragon.level<=Game.dragonLevels.length-1&&(Game.dragonLevel=m.dragon.level),"sync"!==m.dragon.auras[0]&&m.dragon.auras[0]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura=m.dragon.auras[0]),"sync"!==m.dragon.auras[1]&&m.dragon.auras[1]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura2=m.dragon.auras[1])}function k(e){for(var n={},r=0,a=e.toggles;r<a.length;r++){var o=a[r];o.save&&(n[o.keyname]=o.save())}m.mods[e.keyname]={achievements:{},upgrades:{},buildings:{},custom:e.custom,ui:n}}function w(e){return m.mods[e.keyname]||l("mod")}function G(e,n){e.custom=n.custom;for(var r=0,a=e.toggles;r<a.length;r++){var o=a[r];o.load&&t(n.ui,o.keyname)&&o.load(n.ui[o.keyname])}}function A(){for(var t=0,u=e;t<u.length;t++){var i=u[t];o(i,v(i))}for(var s=0,g=n;s<g.length;s++){var l=g[s];o(l,h(l)),l.bought&&Game.CountsAsUpgradeOwned(l.pool)&&Game.UpgradesOwned++}for(var d=0,m=r;d<m.length;d++){var c=m[d];o(c,y(c)),c.won&&Game.CountsAsAchievementOwned(c.pool)&&Game.AchievementsOwned++}j();for(var f=0,p=a;f<p.length;f++){var b=p[f];G(b,w(b))}}function O(){for(var o=0,t=e;o<t.length;o++){f(t[o])}for(var u=0,i=n;u<i.length;u++){p(i[u])}for(var s=0,g=r;s<g.length;s++){b(g[s])}for(var l=0,d=a;l<d.length;l++){k(d[l])}}function C(e){var n=d();if("object"!=typeof e||null===e)return n;if(!t(e,"saveVer")||"number"!=typeof e.saveVer||e.saveVer>3)return n;function r(e){var n=l("mod");if("object"!=typeof e||null===e)return n;if(t(e,"buildings")&&"object"==typeof e.buildings&&null!==e.buildings&&(e.buildings,1))for(var r in e.buildings){var a=e.buildings[r];"object"==typeof a&&null!==a&&(n.buildings[r]=l("building"),o(n.buildings[r],a))}if(t(e,"upgrades")&&"object"==typeof e.upgrades&&null!==e.upgrades&&(e.upgrades,1))for(var u in e.upgrades){var i=e.upgrades[u];"object"==typeof i&&null!==i&&(n.upgrades[u]=l("upgrade"),o(n.upgrades[u],i))}if(t(e,"achievements")&&"object"==typeof e.achievements&&null!==e.achievements&&(e.achievements,1))for(var s in e.achievements){var g=e.achievements[s];"object"==typeof g&&null!==g&&(n.achievements[s]=l("achievement"),o(n.achievements[s],g))}if(t(e,"ui")&&"object"==typeof e.ui&&null!==e.ui&&(e.ui,1))for(var d in e.ui)n.ui[d]=e.ui[d];return t(e,"custom")&&"object"==typeof e.custom&&(n.custom=e.custom),n}if(t(e,"foreign")?n.foreign=r(e.foreign):n.foreign=l("mod"),t(e,"mods")&&"object"==typeof e.mods&&null!==e.mods&&(e.mods,1))for(var a in e.mods)n.mods[a]=r(e.mods[a]);if(t(e,"dragon")&&"object"==typeof e.dragon&&null!==e.dragon&&(!t(e.dragon,"level")||"number"!=typeof e.dragon.level&&"sync"!==e.dragon.level||(n.dragon.level=e.dragon.level),t(e.dragon,"auras")&&e.dragon.auras instanceof Array))for(var u in e.dragon.auras){var i=e.dragon.auras[u];"number"!=typeof i&&"sync"!==i||(n.dragon.auras[u]=i)}return n}function S(e){var n;if(""===e||"{}"===e)c();else try{var r=u(e);r||(r=e),n=JSON.parse(r)}catch(e){console.warn("CPPKIES: Found invalid save, creating new one..."),console.error(e),c()}var a=C(n);o(m,a),A()}function F(){return O(),i(JSON.stringify(m))}export{g as SAVE_VER,s as VANILLA_DRAGON_LEVEL_AMOUNT,G as applyModSave,C as applySave,F as exportSave,S as importSave,c as initSave,y as loadAchievement,A as loadAll,v as loadBuilding,j as loadDragon,w as loadMod,h as loadUpgrade,m as save,b as saveAchievement,O as saveAll,f as saveBuilding,k as saveMod,p as saveUpgrade};
