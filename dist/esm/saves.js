import"./tslib.es6-ac47674d.js";import{customBuildings as e,customUpgrades as n,customAchievements as o,mods as a}from"./vars.js";import{applyAllProps as r,hasOwnProperty as i}from"./helpers.js";import{decompressFromUTF16 as u,compressToUTF16 as t}from"./lz-string.js";var s=Game.dragonLevels.length+0,m=3;function g(e){switch(e){case"mod":return{custom:null};case"dragon":return{level:"sync",auras:["sync","sync"]};case"achievement":return{won:!1};case"upgrade":return{bought:!1,unlocked:!1};case"building":return{amount:0,bought:0,free:0,totalCookies:0,level:0,muted:0,minigameSave:""};default:throw new Error("Invalid fragment name!")}}function d(){return{mods:{},foreign:g("mod"),saveVer:3,dragon:g("dragon")}}var l=d();function v(){var e=d();r(l,e)}function f(e){var n,o=e.amount,a=e.bought,r=e.free,i=e.totalCookies,u=e.level,t=e.muted,s=e.minigameSave,m=e.name,g=e.owner;if(g){var d=l.mods[g.keyname].buildings;d?d[m]={amount:o,bought:a,free:r,totalCookies:i,level:u,muted:t,minigameSave:s}:l.mods[g.keyname].buildings=((n={})[m]={amount:o,bought:a,free:r,totalCookies:i,level:u,muted:t,minigameSave:s},n)}else l.foreign.buildings||(l.foreign.buildings={}),l.foreign.buildings[m]={amount:o,bought:a,free:r,totalCookies:i,level:u,muted:t,minigameSave:s}}function c(e){var n,o;return(null===(o=null===(n=e.owner?l.mods[e.owner.keyname]:l.foreign)||void 0===n?void 0:n.buildings)||void 0===o?void 0:o[e.name])||g("building")}function b(e){var n;if(e.owner){var o=l.mods[e.owner.keyname].upgrades;o?o[e.name]={unlocked:!!e.unlocked,bought:!!e.bought}:l.mods[e.owner.keyname].upgrades=((n={})[e.name]={unlocked:!!e.unlocked,bought:!!e.bought},n)}else l.foreign.upgrades||(l.foreign.upgrades={}),l.foreign.upgrades[e.name]={unlocked:!!e.unlocked,bought:!!e.bought}}function h(e){var n,o;return(null===(o=null===(n=e.owner?l.mods[e.owner.keyname]:l.foreign)||void 0===n?void 0:n.upgrades)||void 0===o?void 0:o[e.name])||g("upgrade")}function p(e){var n;if(e.owner){var o=l.mods[e.owner.keyname].achievements;o?o[e.name]={won:!!e.won}:l.mods[e.owner.keyname].achievements=((n={})[e.name]={won:!!e.won},n)}else l.foreign.achievements||(l.foreign.achievements={}),l.foreign.achievements[e.name]={won:!!e.won}}function y(e){var n,o;return(null===(o=null===(n=e.owner?l.mods[e.owner.keyname]:l.foreign)||void 0===n?void 0:n.achievements)||void 0===o?void 0:o[e.name])||g("achievement")}function k(){"sync"!==l.dragon.level&&l.dragon.level<=Game.dragonLevels.length-1&&(Game.dragonLevel=l.dragon.level),"sync"!==l.dragon.auras[0]&&l.dragon.auras[0]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura=l.dragon.auras[0]),"sync"!==l.dragon.auras[1]&&l.dragon.auras[1]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura2=l.dragon.auras[1])}function w(e){l.mods[e.keyname]?l.mods[e.keyname].custom=e.custom:l.mods[e.keyname]={custom:e.custom};for(var n=0,o=e.toggles;n<o.length;n++){var a=o[n];if(a.save){var r=l.mods[e.keyname].ui;r?r[a.keyname]=a.save():l.mods[e.keyname].ui={}}}}function j(e){return l.mods[e.keyname]||g("mod")}function G(e,n){if(e.custom=n.custom,n.ui)for(var o=0,a=e.toggles;o<a.length;o++){var r=a[o];r.load&&i(n.ui,r.keyname)&&r.load(n.ui[r.keyname])}}function A(){for(var i=0,u=e;i<u.length;i++){var t=u[i];r(t,c(t))}for(var s=0,m=n;s<m.length;s++){var g=m[s];r(g,h(g)),g.bought&&Game.CountsAsUpgradeOwned(g.pool)&&Game.UpgradesOwned++}for(var d=0,l=o;d<l.length;d++){var v=l[d];r(v,y(v)),v.won&&Game.CountsAsAchievementOwned(v.pool)&&Game.AchievementsOwned++}k();for(var f=0,b=a;f<b.length;f++){var p=b[f];G(p,j(p))}}function C(){for(var r=0,i=a;r<i.length;r++){w(i[r])}for(var u=0,t=e;u<t.length;u++){f(t[u])}for(var s=0,m=n;s<m.length;s++){b(m[s])}for(var g=0,d=o;g<d.length;g++){p(d[g])}}function O(e){var n=d();if("object"!=typeof e||null===e)return n;if(!i(e,"saveVer")||"number"!=typeof e.saveVer||e.saveVer>3)return n;function o(e){var n=g("mod");if("object"!=typeof e||null===e)return n;if(i(e,"buildings")&&"object"==typeof e.buildings&&null!==e.buildings&&(e.buildings,1))for(var o in n.buildings={},e.buildings){var a=e.buildings[o];"object"==typeof a&&null!==a&&(n.buildings[o]=g("building"),r(n.buildings[o],a))}if(i(e,"upgrades")&&"object"==typeof e.upgrades&&null!==e.upgrades&&(e.upgrades,1))for(var u in n.upgrades={},e.upgrades){var t=e.upgrades[u];"object"==typeof t&&null!==t&&(n.upgrades[u]=g("upgrade"),r(n.upgrades[u],t))}if(i(e,"achievements")&&"object"==typeof e.achievements&&null!==e.achievements&&(e.achievements,1))for(var s in n.achievements={},e.achievements){var m=e.achievements[s];"object"==typeof m&&null!==m&&(n.achievements[s]=g("achievement"),r(n.achievements[s],m))}if(i(e,"ui")&&"object"==typeof e.ui&&null!==e.ui&&(e.ui,1))for(var d in n.ui={},e.ui)n.ui[d]=e.ui[d];return i(e,"custom")&&"object"==typeof e.custom&&(n.custom=e.custom),n}if(i(e,"foreign")?n.foreign=o(e.foreign):n.foreign=g("mod"),i(e,"mods")&&"object"==typeof e.mods&&null!==e.mods&&(e.mods,1))for(var a in e.mods)n.mods[a]=o(e.mods[a]);if(i(e,"dragon")&&"object"==typeof e.dragon&&null!==e.dragon&&(!i(e.dragon,"level")||"number"!=typeof e.dragon.level&&"sync"!==e.dragon.level||(n.dragon.level=e.dragon.level),i(e.dragon,"auras")&&e.dragon.auras instanceof Array))for(var u in e.dragon.auras){var t=e.dragon.auras[u];"number"!=typeof t&&"sync"!==t||(n.dragon.auras[u]=t)}if(i(e,"minigames")&&"object"==typeof e.minigames&&null!==e.minigames&&(e.minigames,1))for(var s in n.minigames={},e.minigames){var m=e.minigames[s];"object"==typeof m&&null!==m&&(n.minigames[s]=m)}return n}function S(e){var n;if(""===e||"{}"===e)v();else try{var o=u(e);o||(o=e),n=JSON.parse(o)}catch(e){console.warn("CPPKIES: Found invalid save, creating new one..."),console.error(e),v()}var a=O(n);r(l,a),A()}function F(){return C(),t(JSON.stringify(l))}export{m as SAVE_VER,s as VANILLA_DRAGON_LEVEL_AMOUNT,G as applyModSave,O as applySave,F as exportSave,S as importSave,v as initSave,y as loadAchievement,A as loadAll,c as loadBuilding,k as loadDragon,j as loadMod,h as loadUpgrade,l as save,p as saveAchievement,C as saveAll,f as saveBuilding,w as saveMod,b as saveUpgrade};
