import{c as a}from"./tslib.es6-ac47674d.js";import{setUnitOwner as n}from"./vars.js";import{resolveIcon as r}from"./spritesheets.js";import{hasOwnProperty as e}from"./helpers.js";import"./lz-string.js";import{save as o,VANILLA_DRAGON_LEVEL_AMOUNT as s}from"./saves.js";import{shouldRunVersioned as i}from"./generic.js";import"./eventemitter.js";import"./buildings.js";import t from"./basegame.js";var g=function(a,s,i){this.name=a,this.desc=s,this.isCppkies=!0,n(this),"string"==typeof i&&(i=Game.Objects[i]),i instanceof Game.Object?this.pic=r([i.iconColumn,25,e(i,"iconLink")&&"string"==typeof i.iconLink?i.iconLink:void 0]):this.pic=i,Game.dragonAuras[Object.keys(Game.dragonAuras).length]=this,"sync"!==o.dragon.auras[0]&&Object.keys(Game.dragonAuras).length>=o.dragon.auras[0]&&(Game.dragonAura=o.dragon.auras[0]),"sync"!==o.dragon.auras[1]&&Object.keys(Game.dragonAuras).length>=o.dragon.auras[1]&&(Game.dragonAura2=o.dragon.auras[1])},c=function a(r,e,s,i,t,g,c){void 0===c&&(c=Game.dragonLevels.length-3),this.buy=t,this.isCppkies=!0,this.picY=0,n(this);var d=Game.dragonLevels[c-1];this.name=null!=r?r:d.name,this.action=e,this.costStr="string"==typeof s?function(){return s}:s,this.cost=i,g?(this.pic=g[0],this.picY=g[1],0!==this.picY&&console.warn("For now, all dragon levels must not use pic Y, sorry."),this.picLink=g[2]):(this.pic=d.pic,d instanceof a&&(this.picY=d.picY,this.picLink=d.picLink)),Game.dragonLevels.splice(c,0,this),"sync"!==o.dragon.level&&Game.dragonLevels.length>=o.dragon.level&&(Game.dragonLevel=o.dragon.level)},d=function(n){function r(a,r,e){var o="string"==typeof e?Game.Objects[e]:e;return n.call(this,null,"Train "+a+"<br/><small>Aura : "+r+"</small>","100 "+o.plural,(function(){return o.amount>=100}),(function(){return o.sacrifice(100)}))||this}return a(r,n),r}(c);i(1)&&(t.on("preSave",(function(){if(0!==Game.dragonAura&&(o.dragon.auras[0]="sync"),0!==Game.dragonAura2&&(o.dragon.auras[1]="sync"),Game.dragonAuras[Game.dragonAura]instanceof g&&(o.dragon.auras[0]=Game.dragonAura,Game.dragonAura=0),Game.dragonAuras[Game.dragonAura2]instanceof g&&(o.dragon.auras[1]=Game.dragonAura2,Game.dragonAura2=0),Game.dragonLevels[Game.dragonLevel]instanceof c||Game.dragonLevel>=s)for(o.dragon.level=Game.dragonLevel;Game.dragonLevels[Game.dragonLevel]instanceof c||Game.dragonLevel>=s;)Game.dragonLevel--})),t.on("postSave",(function(){"sync"!==o.dragon.auras[0]&&Game.dragonAuras[o.dragon.auras[0]]&&(Game.dragonAura=o.dragon.auras[0]),"sync"!==o.dragon.auras[1]&&Game.dragonAuras[o.dragon.auras[1]]&&(Game.dragonAura2=o.dragon.auras[1]),"sync"!==o.dragon.level&&Game.dragonLevels[o.dragon.level]&&(Game.dragonLevel=o.dragon.level)})),t.on("reset",(function(){o.dragon.auras=["sync","sync"],o.dragon.level="sync"})),t.on("specialPic",(function(a){var n,r=Game.dragonLevels[Game.dragonLevel];return"dragon"===a.tab&&r instanceof c&&(a.pic=null!==(n=r.picLink)&&void 0!==n?n:a.pic),a})));export{g as DragonAura,d as DragonAuraLevel,c as DragonLevel};
