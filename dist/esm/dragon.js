import{c as a}from"./tslib.es6-9a9d7607.js";import"./vars.js";import{resolveIcon as n}from"./spritesheets.js";import{hasOwnProperty as r}from"./helpers.js";import"./lz-string.js";import{save as e,VANILLA_DRAGON_LEVEL_AMOUNT as o}from"./saves.js";import{shouldRunVersioned as s}from"./generic.js";import"./eventemitter.js";import"./buildings.js";import i from"./basegame.js";var t=function(a,o,s){this.name=a,this.desc=o,this.isCppkies=!0,"string"==typeof s&&(s=Game.Objects[s]),s instanceof Game.Object?this.pic=n([s.iconColumn,25,r(s,"iconLink")&&"string"==typeof s.iconLink?s.iconLink:void 0]):this.pic=s,Game.dragonAuras[Object.keys(Game.dragonAuras).length]=this,"sync"!==e.dragon.auras[0]&&Object.keys(Game.dragonAuras).length>=e.dragon.auras[0]&&(Game.dragonAura=e.dragon.auras[0]),"sync"!==e.dragon.auras[1]&&Object.keys(Game.dragonAuras).length>=e.dragon.auras[1]&&(Game.dragonAura2=e.dragon.auras[1])},g=function a(n,r,o,s,i,t,g){void 0===g&&(g=Game.dragonLevels.length-3),this.buy=i,this.isCppkies=!0,this.picY=0;var d=Game.dragonLevels[g-1];this.name=null!=n?n:d.name,this.action=r,this.costStr="string"==typeof o?function(){return o}:o,this.cost=s,t?(this.pic=t[0],this.picY=t[1],0!==this.picY&&console.warn("For now, all dragon levels must not use pic Y, sorry."),this.picLink=t[2]):(this.pic=d.pic,d instanceof a&&(this.picY=d.picY,this.picLink=d.picLink)),Game.dragonLevels.splice(g,0,this),"sync"!==e.dragon.level&&Game.dragonLevels.length>=e.dragon.level&&(Game.dragonLevel=e.dragon.level)},d=function(n){function r(a,r,e){return"string"==typeof e&&(e=Game.Objects[e]),n.call(this,null,"Train "+a+"<br/><small>Aura : "+r+"</small>","100 "+e.plural,(function(){return e.amount>=100}),(function(){return e.sacrifice(100)}))||this}return a(r,n),r}(g);s(1)&&(i.on("preSave",(function(){if(0!==Game.dragonAura&&(e.dragon.auras[0]="sync"),0!==Game.dragonAura2&&(e.dragon.auras[1]="sync"),Game.dragonAuras[Game.dragonAura]instanceof t&&(e.dragon.auras[0]=Game.dragonAura,Game.dragonAura=0),Game.dragonAuras[Game.dragonAura2]instanceof t&&(e.dragon.auras[1]=Game.dragonAura2,Game.dragonAura2=0),Game.dragonLevels[Game.dragonLevel]instanceof g||Game.dragonLevel>=o)for(e.dragon.level=Game.dragonLevel;Game.dragonLevels[Game.dragonLevel]instanceof g||Game.dragonLevel>=o;)Game.dragonLevel--})),i.on("postSave",(function(){"sync"!==e.dragon.auras[0]&&Game.dragonAuras[e.dragon.auras[0]]&&(Game.dragonAura=e.dragon.auras[0]),"sync"!==e.dragon.auras[1]&&Game.dragonAuras[e.dragon.auras[1]]&&(Game.dragonAura2=e.dragon.auras[1]),"sync"!==e.dragon.level&&Game.dragonLevels[e.dragon.level]&&(Game.dragonLevel=e.dragon.level)})),i.on("reset",(function(){e.dragon.auras=["sync","sync"],e.dragon.level="sync"})),i.on("specialPic",(function(a){var n,r=Game.dragonLevels[Game.dragonLevel];return"dragon"===a.tab&&r instanceof g&&(a.pic=null!==(n=r.picLink)&&void 0!==n?n:a.pic),a})));export{t as DragonAura,d as DragonAuraLevel,g as DragonLevel};
