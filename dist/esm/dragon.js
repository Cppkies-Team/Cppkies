import{c as a}from"./tslib.es6-ac47674d.js";import{setUnitOwner as r}from"./vars.js";import{resolveIcon as n}from"./spritesheets.js";import{hasOwnProperty as e}from"./helpers.js";import"./lz-string.js";import{save as o,VANILLA_DRAGON_LEVEL_AMOUNT as s,customLoad as i}from"./saves.js";import{shouldRunVersioned as t}from"./generic.js";import"./eventemitter.js";import"./buildings.js";import g from"./basegame.js";var d=function(a,s,i){this.name=a,this.desc=s,this.isCppkies=!0,r(this),"string"==typeof i&&(i=Game.Objects[i]),i instanceof Game.Object?this.pic=n([i.iconColumn,25,e(i,"iconLink")&&"string"==typeof i.iconLink?i.iconLink:void 0]):this.pic=i,Game.dragonAuras[Object.keys(Game.dragonAuras).length]=this,"sync"!==o.dragon.auras[0]&&Object.keys(Game.dragonAuras).length>=o.dragon.auras[0]&&(Game.dragonAura=o.dragon.auras[0]),"sync"!==o.dragon.auras[1]&&Object.keys(Game.dragonAuras).length>=o.dragon.auras[1]&&(Game.dragonAura2=o.dragon.auras[1])},u=function a(n,e,s,i,t,g,d){void 0===d&&(d=Game.dragonLevels.length-3),this.buy=t,this.isCppkies=!0,this.picY=0,r(this);var u=Game.dragonLevels[d-1];this.name=null!=n?n:u.name,this.action=e,this.costStr="string"==typeof s?function(){return s}:s,this.cost=i,g?(this.pic=g[0],this.picY=g[1],0!==this.picY&&console.warn("For now, all dragon levels must not use pic Y, sorry."),this.picLink=g[2]):(this.pic=u.pic,u instanceof a&&(this.picY=u.picY,this.picLink=u.picLink)),Game.dragonLevels.splice(d,0,this),"sync"!==o.dragon.level&&Game.dragonLevels.length>=o.dragon.level&&(Game.dragonLevel=o.dragon.level)},c=function(r){function n(a,n,e){var o="string"==typeof e?Game.Objects[e]:e;return r.call(this,null,"Train "+a+"<br/><small>Aura : "+n+"</small>","100 "+o.plural,(function(){return o.amount>=100}),(function(){return o.sacrifice(100)}))||this}return a(n,r),n}(u);t(1)&&(g.on("preSave",(function(){if(0!==Game.dragonAura&&(o.dragon.auras[0]="sync"),0!==Game.dragonAura2&&(o.dragon.auras[1]="sync"),Game.dragonAuras[Game.dragonAura]instanceof d&&(o.dragon.auras[0]=Game.dragonAura,Game.dragonAura=0),Game.dragonAuras[Game.dragonAura2]instanceof d&&(o.dragon.auras[1]=Game.dragonAura2,Game.dragonAura2=0),Game.dragonLevels[Game.dragonLevel]instanceof u||Game.dragonLevel>=s)for(o.dragon.level=Game.dragonLevel;Game.dragonLevels[Game.dragonLevel]instanceof u||Game.dragonLevel>=s;)Game.dragonLevel--})),g.on("postSave",(function(){"sync"!==o.dragon.auras[0]&&Game.dragonAuras[o.dragon.auras[0]]&&(Game.dragonAura=o.dragon.auras[0]),"sync"!==o.dragon.auras[1]&&Game.dragonAuras[o.dragon.auras[1]]&&(Game.dragonAura2=o.dragon.auras[1]),"sync"!==o.dragon.level&&Game.dragonLevels[o.dragon.level]&&(Game.dragonLevel=o.dragon.level)})),g.on("reset",(function(){o.dragon.auras=["sync","sync"],o.dragon.level="sync"})),g.on("specialPic",(function(a){var r,n=Game.dragonLevels[Game.dragonLevel];return"dragon"===a.tab&&n instanceof u&&(a.pic=null!==(r=n.picLink)&&void 0!==r?r:a.pic),a})),i.push((function(){"sync"!==o.dragon.level&&o.dragon.level<=Game.dragonLevels.length-1&&(Game.dragonLevel=o.dragon.level),"sync"!==o.dragon.auras[0]&&o.dragon.auras[0]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura=o.dragon.auras[0]),"sync"!==o.dragon.auras[1]&&o.dragon.auras[1]<=Object.keys(Game.dragonAuras).length-1&&(Game.dragonAura2=o.dragon.auras[1])})));export{d as DragonAura,c as DragonAuraLevel,u as DragonLevel};
