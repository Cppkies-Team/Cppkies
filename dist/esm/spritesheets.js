import{_ as n,a as e,b as r}from"./_tslib-e6397ef4.js";import{miscValues as t}from"./vars.js";var i={},o=[];function a(n,e){i[n]=e}function c(n){delete a[n]}function s(n){if(o.includes(n))throw new Error("Recursive alias");return o.push(n),n in i?s(i[n]):(o=[],n)}function u(n){return new Promise((function(e){var r=new Image;r.addEventListener("load",(function(){e(r)})),r.crossOrigin="Anonymous",r.src=n}))}function v(n){return new Promise((function(e){n.canvas.toBlob((function(n){e(URL.createObjectURL(n))}))}))}function d(n,e,r,t,i,o){return new Promise((function(a){r[0]instanceof Array||(r=[r]),r=r;var c={};for(var s in r)for(var u in r[s])if(r[s][u]){if(r[s][u]=r[s][u].toString().toLowerCase(),!(r[s][u]in e))throw new Error("Invalid icon name");c[r[s][u]]=[parseInt(u),parseInt(s)]}var d=document.createElement("canvas").getContext("2d"),f=new Image;f.addEventListener("load",(function(){for(var n in d.canvas.width=i[0],d.canvas.height=i[1],c)d.drawImage(f,c[n][0]*t[0],c[n][1]*t[1],t[0],t[1],e[n][0]*t[0],e[n][1]*t[1],t[0],t[1]);var r,s=function(){v(d).then(a)};o&&(r=o(d)),r instanceof Promise?r.then(s):s()})),f.crossOrigin="Anonymous",f.src=n}))}var f={},l={"3d":[0,21],milestone1:[0,22],milestone2:[0,23],milestone3:[0,24],krumblor:[0,25],level1:[0,26],level2:[0,27]};function m(r,t,i,o){return void 0===o&&(o=!1),n(this,void 0,void 0,(function(){var n,c,u,v;return e(this,(function(e){switch(e.label){case 0:for(c in void 0===i&&(f[r]||(f[r]=0),i=f[r]++),n={},l)n[c]=[i,l[c][1]];for(c in Game.Tiers)n[Game.Tiers[c].name.toLowerCase()]=n[c.toString()]=[i,Game.Tiers[c].iconRow];return u=a,v=[r],[4,d(o?s(r):r,n,t,[48,48],[48*(i+1),48*(Object.values(n).reduce((function(n,e){return Math.max(n,e[1])}),-1/0)+1)],(function(n){return new Promise((function(e){if(s(r)!==r){var t=new Image;t.addEventListener("load",(function(){n.drawImage(t,0,0),e()})),t.src=s(r),t.crossOrigin="Anonymous"}else e()}))}))];case 1:return u.apply(void 0,v.concat([e.sent()])),[2]}}))}))}var h={},w={research:[9,0],cookie:[10,0],mouse:[11,0],multicursor:[12,0],kitten:[18,0]};function g(r,t,i,o){return void 0===o&&(o=!1),n(this,void 0,void 0,(function(){var n,c,u,v;return e(this,(function(e){switch(e.label){case 0:for(c in void 0===i&&(h[r]||(h[r]=0),i=h[r]++),n={},w)n[c]=[w[c][0],i];for(c in Game.ObjectsById)n[Game.ObjectsById[c].single.toLowerCase()]=n[c]=[Game.ObjectsById[c].iconColumn,i];return u=a,v=[r],[4,d(o?s(r):r,n,t,[48,48],[48*(Object.values(n).reduce((function(n,e){return Math.max(n,e[0])}),-1/0)+1),48*(i+1)],(function(n){return new Promise((function(e){if(s(r)!==r){var t=new Image;t.addEventListener("load",(function(){n.drawImage(t,0,0),e()})),t.src=s(r),t.crossOrigin="Anonymous"}else e()}))}))];case 1:return u.apply(void 0,v.concat([e.sent()])),[2]}}))}))}function b(r,i,o){var c;return void 0===o&&(o=!0),n(this,void 0,void 0,(function(){var n,d,f,l,m,h,w,g,b,I,p,y,L,O,j;return e(this,(function(e){switch(e.label){case 0:return n=document.createElement("canvas").getContext("2d"),[4,u(o?s(r):r)];case 1:for(d=e.sent(),f=[d.width,d.height],l=0,m=i;l<m.length;l++)48*(h=m[l])[0][0]>f[0]&&(f[0]=48*h[0][0]),48*h[0][1]>f[1]&&(f[1]=48*h[0][1]);n.canvas.width=f[0],n.canvas.height=f[1],n.drawImage(d,0,0),w={},g=0,b=i,e.label=2;case 2:return g<b.length?(I=b[g],p=s((null!==(c=I[1][2])&&void 0!==c?c:t.iconLink)||"img/icons.png"),w[p]?[3,4]:(y=w,L=p,[4,u(p)])):[3,6];case 3:y[L]=e.sent(),e.label=4;case 4:n.clearRect(48*I[0][0],48*I[0][1],48,48),n.drawImage(w[p],48*I[1][0],48*I[1][1],48,48,48*I[0][0],48*I[0][1],48,48),e.label=5;case 5:return g++,[3,2];case 6:return O=a,j=[r],[4,v(n)];case 7:return O.apply(void 0,j.concat([e.sent()])),[2]}}))}))}function I(n){return void 0===(n=r(n))[2]||null===n[2]?n[2]=s(t.iconLink):n[2]=s(n[2]),n}export{a as alias,i as aliases,l as extraColumnIcons,w as extraRowIcons,b as patchIconsheet,m as relinkColumn,g as relinkRow,s as resolveAlias,I as resolveIcon,c as unalias};
