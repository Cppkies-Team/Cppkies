import{_ as n,a as e,b as r}from"./tslib.es6-9a9d7607.js";import{miscValues as t}from"./vars.js";var i={},o=[];function a(n,e){i[n]=e}function s(n){delete a[n]}function c(n){if(o.includes(n))throw new Error("Recursive alias");return o.push(n),n in i?c(i[n]):(o=[],n)}function u(n){return new Promise((function(e){var r=new Image;r.addEventListener("load",(function(){e(r)})),r.crossOrigin="Anonymous",r.src=n}))}function d(n){return new Promise((function(e){n.canvas.toBlob((function(n){e(URL.createObjectURL(n))}))}))}function v(n,e,r,t,i,o){return new Promise((function(a){r[0]instanceof Array||(r=[r]),r=r;var s={};for(var c in r)for(var u in r[c])if(r[c][u]){if(r[c][u]=r[c][u].toString().toLowerCase(),!(r[c][u]in e))throw new Error("Invalid icon name");s[r[c][u]]=[parseInt(u),parseInt(c)]}var v=document.createElement("canvas").getContext("2d"),l=new Image;l.addEventListener("load",(function(){for(var n in v.canvas.width=i[0],v.canvas.height=i[1],s)v.drawImage(l,s[n][0]*t[0],s[n][1]*t[1],t[0],t[1],e[n][0]*t[0],e[n][1]*t[1],t[0],t[1]);var r,c=function(){d(v).then(a)};o&&(r=o(v)),r instanceof Promise?r.then(c):c()})),l.crossOrigin="Anonymous",l.src=n}))}var l={},f={"3d":[0,21],milestone1:[0,22],milestone2:[0,23],milestone3:[0,24],krumblor:[0,25],level1:[0,26],level2:[0,27]};function m(r,t,i,o){return void 0===o&&(o=!1),n(this,void 0,void 0,(function(){var n,s,u,d;return e(this,(function(e){switch(e.label){case 0:for(s in void 0===i&&(l[r]||(l[r]=0),i=l[r]++),n={},f)n[s]=[i,f[s][1]];for(s in Game.Tiers)n[Game.Tiers[s].name.toLowerCase()]=n[s.toString()]=[i,Game.Tiers[s].iconRow];return u=a,d=[r],[4,v(o?c(r):r,n,t,[48,48],[48*(i+1),48*(Object.values(n).reduce((function(n,e){return Math.max(n,e[1])}),-1/0)+1)],(function(n){return new Promise((function(e){if(c(r)!==r){var t=new Image;t.addEventListener("load",(function(){n.drawImage(t,0,0),e()})),t.src=c(r),t.crossOrigin="Anonymous"}else e()}))}))];case 1:return u.apply(void 0,d.concat([e.sent()])),[2]}}))}))}var h={},w={research:[9,0],cookie:[10,0],mouse:[11,0],multicursor:[12,0],kitten:[18,0]};function g(r,t,i,o){return void 0===o&&(o=!1),n(this,void 0,void 0,(function(){var n,s,u,d;return e(this,(function(e){switch(e.label){case 0:for(s in void 0===i&&(h[r]||(h[r]=0),i=h[r]++),n={},w)n[s]=[w[s][0],i];for(s in Game.ObjectsById)n[Game.ObjectsById[s].single.toLowerCase()]=n[s]=[Game.ObjectsById[s].iconColumn,i];return u=a,d=[r],[4,v(o?c(r):r,n,t,[48,48],[48*(Object.values(n).reduce((function(n,e){return Math.max(n,e[0])}),-1/0)+1),48*(i+1)],(function(n){return new Promise((function(e){if(c(r)!==r){var t=new Image;t.addEventListener("load",(function(){n.drawImage(t,0,0),e()})),t.src=c(r),t.crossOrigin="Anonymous"}else e()}))}))];case 1:return u.apply(void 0,d.concat([e.sent()])),[2]}}))}))}function b(r,i,o){var s;return void 0===o&&(o=!0),n(this,void 0,void 0,(function(){var n,v,l,f,m,h,w,g,b,I,p,y,L,O,j;return e(this,(function(e){switch(e.label){case 0:return n=document.createElement("canvas").getContext("2d"),[4,u(o?c(r):r)];case 1:for(v=e.sent(),l=[v.width,v.height],f=0,m=i;f<m.length;f++)48*(h=m[f])[0][0]>l[0]&&(l[0]=48*h[0][0]),48*h[0][1]>l[1]&&(l[1]=48*h[0][1]);n.canvas.width=l[0],n.canvas.height=l[1],n.drawImage(v,0,0),w={},g=0,b=i,e.label=2;case 2:return g<b.length?(I=b[g],p=c((null!==(s=I[1][2])&&void 0!==s?s:t.iconLink)||"img/icons.png"),w[p]?[3,4]:(y=w,L=p,[4,u(p)])):[3,6];case 3:y[L]=e.sent(),e.label=4;case 4:n.clearRect(48*I[0][0],48*I[0][1],48,48),n.drawImage(w[p],48*I[1][0],48*I[1][1],48,48,48*I[0][0],48*I[0][1],48,48),e.label=5;case 5:return g++,[3,2];case 6:return O=a,j=[r],[4,d(n)];case 7:return O.apply(void 0,j.concat([e.sent()])),[2]}}))}))}function I(n){return void 0===(n=r(n))[2]||null===n[2]?n[2]=c(t.iconLink):n[2]=c(n[2]),n}export{a as alias,i as aliases,f as extraColumnIcons,w as extraRowIcons,b as patchIconsheet,m as relinkColumn,g as relinkRow,c as resolveAlias,I as resolveIcon,s as unalias};
